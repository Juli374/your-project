<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="theme-color" content="#2d5016">
    <title>Survival Quiz - Test Your Preparedness</title>
    
    <!-- PWA Manifest -->
    <link rel="manifest" href="data:application/json;base64,eyJuYW1lIjoiU3Vydml2YWwgUHJlcGFyZWRuZXNzIFF1aXoiLCJzaG9ydF9uYW1lIjoiU3Vydml2YWwgUXVpeiIsImRlc2NyaXB0aW9uIjoiVGVzdCB5b3VyIHN1cnZpdmFsIHByZXBhcmVkbmVzcyIsInN0YXJ0X3VybCI6Ii8iLCJkaXNwbGF5Ijoic3RhbmRhbG9uZSIsImJhY2tncm91bmRfY29sb3IiOiIjMmQ1MDE2IiwidGhlbWVfY29sb3IiOiIjMmQ1MDE2IiwiaWNvbnMiOlt7InNyYyI6ImRhdGE6aW1hZ2Uvc3ZnK3htbDtiYXNlNjQsUEhOMlp5QjRiV3h1Y3owcFlXaDBlSEE2THk5M2QzY3Vjekl1YjNKbkx6SXdNREF2YzJkbklpQjNhV1IwYUQwaU1USXdJaUJvWldsbmFIUTlJakV5TUNJS1BFNWxkM05pY0dGalpYTWdhV1IlM0RJaUJoTFMxcklURXRhMGRMYTFGRE1VNXFiM2RyZUZaUWRHSnJkSGxaY0U0eWJrcHBWR051Y1VzclJ6WjJSaWQwVVZkUklpQm9SamxRSWlBQWV3PT0iLCJzaXplcyI6IjEyOHgxMjgiLCJ0eXBlIjoiaW1hZ2Uvc3ZnK3htbCJ9XX0=">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #2d5016 0%, #4a7c59 100%);
            min-height: 100vh;
            color: #333;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            min-height: 100vh;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            color: white;
        }

        .header h1 {
            font-size: 2.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .header p {
            font-size: 1.1rem;
            opacity: 0.9;
        }

        .main-menu {
            display: grid;
            gap: 20px;
            margin-bottom: 30px;
        }

        .book-card {
            background: white;
            border-radius: 16px;
            padding: 24px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            cursor: pointer;
            border: 3px solid transparent;
        }

        .book-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 40px rgba(0,0,0,0.15);
            border-color: #7dae42;
        }

        .book-card h3 {
            color: #2d5016;
            font-size: 1.4rem;
            margin-bottom: 12px;
        }

        .book-card p {
            color: #666;
            margin-bottom: 16px;
            line-height: 1.6;
        }

        .difficulty-indicator {
            display: flex;
            gap: 8px;
            margin-bottom: 16px;
        }

        .difficulty-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
            background: #e0e0e0;
        }

        .difficulty-dot.active {
            background: #7dae42;
        }

        .start-button {
            background: linear-gradient(135deg, #7dae42 0%, #5d8234 100%);
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            width: 100%;
        }

        .start-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(125, 174, 66, 0.4);
        }

        .quiz-container {
            display: none;
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
        }

        .quiz-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
            padding-bottom: 16px;
            border-bottom: 2px solid #f0f0f0;
        }

        .quiz-progress {
            background: #f0f0f0;
            height: 8px;
            border-radius: 4px;
            overflow: hidden;
            margin-bottom: 24px;
        }

        .progress-bar {
            background: linear-gradient(90deg, #7dae42, #5d8234);
            height: 100%;
            transition: width 0.3s ease;
        }

        .question-card {
            margin-bottom: 24px;
        }

        .question-text {
            font-size: 1.2rem;
            font-weight: 600;
            color: #2d5016;
            margin-bottom: 20px;
            line-height: 1.6;
        }

        .options {
            display: grid;
            gap: 12px;
        }

        .option {
            background: #f8f9fa;
            border: 2px solid #e9ecef;
            border-radius: 12px;
            padding: 16px;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 1rem;
        }

        .option:hover {
            border-color: #7dae42;
            background: #f0f8e8;
        }

        .option.selected {
            border-color: #7dae42;
            background: #e8f5e8;
        }

        .option.correct {
            border-color: #28a745;
            background: #d4edda;
            color: #155724;
        }

        .option.incorrect {
            border-color: #dc3545;
            background: #f8d7da;
            color: #721c24;
        }

        .quiz-controls {
            display: flex;
            gap: 16px;
            justify-content: space-between;
            margin-top: 24px;
        }

        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .btn-primary {
            background: linear-gradient(135deg, #7dae42 0%, #5d8234 100%);
            color: white;
        }

        .btn-secondary {
            background: #6c757d;
            color: white;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,0,0,0.2);
        }

        .btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
            box-shadow: none;
        }

        .results {
            display: none;
            text-align: center;
            background: white;
            border-radius: 16px;
            padding: 32px;
            box-shadow: 0 8px 32px rgba(0,0,0,0.1);
            margin: 20px;
        }

        .score-circle {
            width: 150px;
            height: 150px;
            border-radius: 50%;
            margin: 0 auto 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: bold;
            color: white;
        }

        .score-excellent { background: linear-gradient(135deg, #28a745, #20c997); }
        .score-good { background: linear-gradient(135deg, #17a2b8, #007bff); }
        .score-basic { background: linear-gradient(135deg, #ffc107, #fd7e14); }
        .score-critical { background: linear-gradient(135deg, #dc3545, #e83e8c); }

        .explanation {
            background: #f8f9fa;
            border-radius: 12px;
            padding: 20px;
            margin: 16px 0;
            border-left: 4px solid #7dae42;
        }

        .explanation h4 {
            color: #2d5016;
            margin-bottom: 8px;
        }

        .back-button {
            position: absolute;
            top: 20px;
            left: 20px;
            background: rgba(255,255,255,0.9);
            border: none;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.5rem;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: all 0.3s ease;
            color: #2d5016;
        }

        .back-button:hover {
            transform: scale(1.1);
            background: white;
        }

        @media (max-width: 768px) {
            .container {
                padding: 16px;
            }
            
            .header h1 {
                font-size: 2rem;
            }
            
            .quiz-container {
                padding: 20px;
            }
            
            .quiz-controls {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1><img src="./images/logo.png" alt="Survival Quiz Logo" style="width: 60px; height: 60px; vertical-align: middle; margin-right: 16px;">Survival Quiz</h1>
            <p>Test your survival preparedness</p>
        </div>

        <div id="mainMenu" class="main-menu">
            <div class="book-card" onclick="startQuiz('all')">
                <h3>🎯 Complete Preparedness Assessment</h3>
                <p>All 60 questions across three books. Comprehensive test of your knowledge.</p>
                <div class="difficulty-indicator">
                    <div class="difficulty-dot active"></div>
                    <div class="difficulty-dot active"></div>
                    <div class="difficulty-dot active"></div>
                    <span style="margin-left: 8px; color: #666;">All levels</span>
                </div>
                <button class="start-button">Start Full Test</button>
            </div>

            <div class="book-card" onclick="startQuiz('basic')">
                <h3>🎒 Basic Survival Skills</h3>
                <p>Fundamentals of preparedness: mindset, first aid, communication, fitness</p>
                <div class="difficulty-indicator">
                    <div class="difficulty-dot active"></div>
                    <div class="difficulty-dot active"></div>
                    <div class="difficulty-dot"></div>
                    <span style="margin-left: 8px; color: #666;">Easy-Medium</span>
                </div>
                <button class="start-button">20 Questions</button>
            </div>

            <div class="book-card" onclick="startQuiz('offgrid')">
                <h3>🔥 Life Without Electricity</h3>
                <p>Practical skills: shelter, fire, water, food, tools</p>
                <div class="difficulty-indicator">
                    <div class="difficulty-dot active"></div>
                    <div class="difficulty-dot active"></div>
                    <div class="difficulty-dot active"></div>
                    <span style="margin-left: 8px; color: #666;">Medium-Hard</span>
                </div>
                <button class="start-button">20 Questions</button>
            </div>

            <div class="book-card" onclick="startQuiz('medical')">
                <h3>🏥 Wilderness Medicine</h3>
                <p>First aid in extreme conditions without hospitals</p>
                <div class="difficulty-indicator">
                    <div class="difficulty-dot active"></div>
                    <div class="difficulty-dot active"></div>
                    <div class="difficulty-dot active"></div>
                    <span style="margin-left: 8px; color: #666;">Medium-Hard</span>
                </div>
                <button class="start-button">20 Questions</button>
            </div>
        </div>

        <div id="quizContainer" class="quiz-container">
            <button class="back-button" onclick="showMainMenu()">←</button>
            
            <div class="quiz-header">
                <h2 id="quizTitle">Test</h2>
                <span id="questionCounter">1/20</span>
            </div>

            <div class="quiz-progress">
                <div class="progress-bar" id="progressBar"></div>
            </div>

            <div class="question-card">
                <div class="question-text" id="questionText"></div>
                <div class="options" id="optionsContainer"></div>
                <div class="explanation" id="explanation" style="display: none;"></div>
            </div>

            <div class="quiz-controls">
                <button class="btn btn-secondary" onclick="showMainMenu()">Exit</button>
                <button class="btn btn-primary" id="nextButton" onclick="nextQuestion()" disabled>Next</button>
            </div>
        </div>

        <div id="resultsContainer" class="results">
            <button class="back-button" onclick="showMainMenu()">←</button>
            
            <div class="score-circle" id="scoreCircle">
                <span id="scoreText">0/20</span>
            </div>
            
            <h2 id="resultTitle" style="color: #2d5016; margin-bottom: 16px;">Results</h2>
            <p id="resultDescription" style="color: #666; font-size: 1.1rem; line-height: 1.6;"></p>
            
            <div style="margin: 24px 0;">
                <button class="btn btn-primary" onclick="showMainMenu()">Take Another Test</button>
            </div>
        </div>
    </div>

    <script>
        // Global region setting
        let currentRegion = 'usa';

        // Region configuration
        const regionConfig = {
            usa: {
                currency: '
        const questionsData = {
            basic: [
                {
                    question: "You're preparing an emergency kit and can only take one item. What would you choose for maximum functionality?",
                    options: ["A) Swiss knife with 15 tools", "B) Simple bandana", "C) Waterproof flashlight", "D) Portable charger"],
                    correct: 1,
                    explanation: "A bandana can serve as a bandage, tourniquet, water filter, signal flag, sun protection, fire starter material, and dozens of other functions.",
                    difficulty: "easy"
                },
                {
                    question: "A teammate has an open fracture with bright red pulsating blood. Direct pressure on the wound doesn't stop the bleeding. What's next?",
                    options: ["A) Apply a tourniquet above the wound", "B) Elevate the arm and continue pressure", "C) Find the pulse point on the arm and compress the artery", "D) Clean the wound and apply a tight bandage"],
                    correct: 2,
                    explanation: "For arterial bleeding when direct pressure is ineffective, the next step is compressing the feeding artery at the pulse point between the bicep and tricep.",
                    difficulty: "intermediate"
                },
                {
                    question: "How do you test readiness for a long hike with a backpack in extreme conditions?",
                    options: ["A) Run 5 km without a backpack", "B) Walk 3 miles with a backpack weighing 15% of your body weight", "C) Lift the backpack overhead 20 times", "D) Stand with the backpack for 30 minutes"],
                    correct: 1,
                    explanation: "The test with a backpack weighing 15% of body weight over 3 miles reveals real readiness for long hikes and identifies weaknesses in endurance.",
                    difficulty: "easy"
                },
                {
                    question: "You're lost and starting to panic. Heart beating fast, breathing rapid. Which technique quickly restores control?",
                    options: ["A) Hold breath for a minute", "B) Breathe using the pattern: 4 seconds in - 4 hold - 4 out - 4 hold", "C) Breathe as fast as possible for 30 seconds", "D) Lie down and relax"],
                    correct: 1,
                    explanation: "Tactical breathing 4-4-4-4 activates the parasympathetic nervous system and quickly reduces stress levels, restoring decision-making ability.",
                    difficulty: "easy"
                },
                {
                    question: "You have paracord. Why is it especially valuable in survival situations?",
                    options: ["A) Only because of high strength", "B) Waterproof coating", "C) Inner threads can be used separately for fishing and sewing", "D) Glows in the dark"],
                    correct: 2,
                    explanation: "Paracord contains inner fibers that can be used separately as fishing line, sewing thread, thin cord - multiplying functionality.",
                    difficulty: "intermediate"
                },
                {
                    question: "In critical situations, the brain narrows perception and impairs memory. How does this affect decision-making?",
                    options: ["A) Decisions become faster and more accurate", "B) Doesn't affect decision quality", "C) Decision quality drops sharply due to tunnel vision", "D) Superhuman analytical abilities appear"],
                    correct: 2,
                    explanation: "Stress causes tunnel vision, working memory disruption, and reversion to primitive reactions, seriously reducing decision quality.",
                    difficulty: "intermediate"
                },
                {
                    question: "A teammate is panicking and breathing fast and shallow. Which breathing technique would you recommend?",
                    options: ["A) 3-3-3-3 (in-hold-out-hold)", "B) 4-4-4-4 (in-hold-out-hold)", "C) 5-5-5-5 (in-hold-out-hold)", "D) Breathe into a bag"],
                    correct: 1,
                    explanation: "Tactical breathing using the 4-4-4-4 pattern (inhale 4 sec, hold 4 sec, exhale 4 sec, hold 4 sec) effectively restores control during panic.",
                    difficulty: "easy"
                },
                {
                    question: "What's the key principle of everyday carry (EDC) emergency items philosophy?",
                    options: ["A) Carry maximum useful items", "B) Only the most expensive items", "C) Items you actually carry every day", "D) Only military gear"],
                    correct: 2,
                    explanation: "The principle of constancy - true EDC includes only what you carry constantly. An item left at home due to inconvenience is useless in an emergency.",
                    difficulty: "intermediate"
                },
                {
                    question: "An earthquake starts while you're indoors. What are the correct actions?",
                    options: ["A) Run to the exit", "B) Stand in a doorway", "C) Drop, take cover under a table, hold on", "D) Jump out the window"],
                    correct: 2,
                    explanation: "Modern recommendation - 'Drop, Cover, Hold' - drop to knees, take cover under a sturdy table, protect head. Doorways in modern buildings don't provide special protection.",
                    difficulty: "intermediate"
                },
                {
                    question: "When planning family emergency communication, why do you need a contact in another city?",
                    options: ["A) To contact authorities", "B) Local communication works, distant doesn't", "C) Long-distance communication often works when local is disrupted", "D) It's a legal requirement"],
                    correct: 2,
                    explanation: "During local disasters, long-distance communication lines often remain operational when local towers and cables are damaged. The remote contact becomes a family information center.",
                    difficulty: "intermediate"
                },
                {
                    question: "You see signs of danger but think 'this can't be serious, everything will be fine.' What psychological trap is this?",
                    options: ["A) Panic attack", "B) Normalcy bias - underestimating threats", "C) Depression", "D) Excessive anxiety"],
                    correct: 1,
                    explanation: "Normalcy bias causes people to minimize threat severity and assume normal conditions will continue even with obvious danger signs. This leads to dangerous response delays.",
                    difficulty: "complex"
                },
                {
                    question: "How do you train multiple ways to perform critical survival tasks?",
                    options: ["A) Learn one method perfectly", "B) Practice primary tool, alternative method, and improvisation without tools", "C) Collect maximum tools", "D) Rely on intuition"],
                    correct: 1,
                    explanation: "'Tool triangulation' - practicing key tasks three ways: primary tool, alternative method, and improvisation without tools creates reliability.",
                    difficulty: "complex"
                },
                {
                    question: "A teammate got burned with boiling water. What should NOT be done?",
                    options: ["A) Cool with cold water", "B) Cover with clean cloth", "C) Apply oil or grease", "D) Give pain medication"],
                    correct: 2,
                    explanation: "Oil and greasy substances retain heat in tissues and worsen damage while creating perfect conditions for infection. This is an outdated and dangerous method.",
                    difficulty: "easy"
                },
                {
                    question: "What does the 'Turn Around, Don't Drown' rule mean during floods?",
                    options: ["A) Turn your back to water", "B) Never enter moving water", "C) Don't turn the car in water", "D) Only swim on your back"],
                    correct: 1,
                    explanation: "Just 6 inches of moving water can knock down an adult, and 12 inches can carry away a car. Better to turn around and find another route than risk life.",
                    difficulty: "intermediate"
                },
                {
                    question: "After many hours of decision-making in crisis, your decision quality deteriorates. What is this?",
                    options: ["A) Panic", "B) Decision fatigue - cognitive resource depletion", "C) Depression", "D) Loss of concentration"],
                    correct: 1,
                    explanation: "Decision fatigue occurs when cognitive resources are depleted after multiple choices. Decision quality drops even while maintaining physical strength.",
                    difficulty: "complex"
                },
                {
                    question: "Why is a metal container better than plastic for survival?",
                    options: ["A) It's lighter", "B) Can cook on fire and boil water", "C) More visible to rescuers", "D) Doesn't crack in cold"],
                    correct: 1,
                    explanation: "A metal container can be placed directly on fire for cooking and boiling water for disinfection - these are critically important survival functions.",
                    difficulty: "intermediate"
                },
                {
                    question: "How do you properly signal distress with sound or light?",
                    options: ["A) 3 short - 3 long - 3 short", "B) 3 long - 3 short - 3 long", "C) Continuous signal", "D) 5 short signals"],
                    correct: 0,
                    explanation: "SOS in Morse code: 3 short signals, 3 long, 3 short. This is the international distress signal recognized worldwide.",
                    difficulty: "easy"
                },
                {
                    question: "You've already walked 10 km on the wrong route but continue, thinking 'can't waste the distance covered.' What error is this?",
                    options: ["A) Correct strategy", "B) Sunk cost fallacy - continuing due to already invested resources", "C) Excessive caution", "D) Good planning"],
                    correct: 1,
                    explanation: "Sunk cost fallacy makes people continue ineffective actions due to already invested resources instead of evaluating prospects. In survival, this can be deadly.",
                    difficulty: "complex"
                },
                {
                    question: "Which natural object works best as exercise equipment for balance and strength?",
                    options: ["A) Only large rocks", "B) Fallen logs of different diameters", "C) Only water bodies", "D) Sand dunes"],
                    correct: 1,
                    explanation: "Fallen logs are ideal for balance training (log walking), jumping and climbing, developing skills for movement over complex terrain.",
                    difficulty: "intermediate"
                },
                {
                    question: "What is the foundation of all survival skills?",
                    options: ["A) Physical strength", "B) Expensive gear", "C) Technical knowledge", "D) Psychological resilience"],
                    correct: 3,
                    explanation: "The most sophisticated gear cannot save someone whose mind has already given up. Psychological resilience determines whether knowledge and skills will be applied or the person will surrender.",
                    difficulty: "easy"
                }
            ],
            
            offgrid: [
                {
                    question: "Lost in the forest and need urgent shelter, having only a knife and rope. Which construction gives basic protection with minimal time investment?",
                    options: ["A) Fully built A-frame with complete insulation", "B) Debris hut using a fallen tree as ridgepole", "C) Excavated earth shelter with wooden roof", "D) Teepee from bent saplings"],
                    correct: 1,
                    explanation: "A debris hut uses existing natural elements (fallen tree) as structural foundation, requires minimal time for frame construction and can be quickly insulated with available forest debris.",
                    difficulty: "easy"
                },
                {
                    question: "When using a hand drill for fire, tinder catches but flame quickly dies. Most likely cause?",
                    options: ["A) Insufficient downward pressure on spindle", "B) Tinder packed too tightly without sufficient airflow", "C) Fireboard wood too wet for proper friction", "D) Wrong angle of notch in fireboard"],
                    correct: 1,
                    explanation: "Tinder bundle must be built loosely like a bird's nest to ensure sufficient oxygen flow for sustained burning. Dense packing suffocates developing flame.",
                    difficulty: "medium"
                },
                {
                    question: "In arid terrain you need to find water sources. Which indicator most reliably points to underground water?",
                    options: ["A) Clusters of dark-colored rocks", "B) Broad-leafed vegetation growing in linear patterns", "C) Areas where different soil colors meet", "D) Presence of small animal burrows"],
                    correct: 1,
                    explanation: "Plants with broad, thin leaves require abundant water and often grow in lines following underground watercourses or seepage zones, making them reliable water indicators in desert conditions.",
                    difficulty: "medium"
                },
                {
                    question: "Building a bow drill set but consistently failing to produce an ember. Technique seems right. Which material combination most likely solves the problem?",
                    options: ["A) Harder wood for both spindle and fireboard", "B) Softer wood for spindle, harder for fireboard", "C) Harder wood for spindle, softer for fireboard", "D) Green wood for spindle, dry for fireboard"],
                    correct: 2,
                    explanation: "Optimal friction combination pairs harder wood (spindle) with softer wood (fireboard), creating proper friction without premature wear while generating sufficient heat for ember formation.",
                    difficulty: "medium"
                },
                {
                    question: "In survival situation, found cattails growing in marshy area. Which part of cattail provides highest caloric return for effort?",
                    options: ["A) Fluffy seed heads for direct consumption", "B) Young shoots collected in early spring", "C) Starchy roots/rhizomes dug from underwater", "D) Pollen collected during flowering"],
                    correct: 2,
                    explanation: "Cattail roots contain concentrated starches and provide highest caloric density. They're available year-round, and one collection session can yield substantial nutrition compared to other parts.",
                    difficulty: "easy"
                },
                {
                    question: "Building a solar still for water collection but getting minimal output. Which modification significantly improves water production?",
                    options: ["A) Dig pit deeper to increase soil surface area", "B) Add non-poisonous vegetation to increase moisture content", "C) Use darker colored plastic sheet as covering", "D) Create multiple small stills instead of one large"],
                    correct: 1,
                    explanation: "Adding vegetation dramatically increases moisture content inside still, providing more water vapor for condensation. Even dry vegetation contains extractable moisture that significantly boosts output.",
                    difficulty: "medium"
                },
                {
                    question: "When processing plant fibers for rope, material keeps breaking during twisting. Most effective solution?",
                    options: ["A) Twist fibers tighter to increase strength", "B) Use shorter fiber lengths to reduce stress points", "C) Slightly dampen fibers before working with them", "D) Add more individual fibers to increase bulk"],
                    correct: 2,
                    explanation: "Slightly moist fibers become more pliable and less prone to breaking during twisting process. Completely dry fibers are brittle, while overly wet fibers become weak and stretchy.",
                    difficulty: "medium"
                },
                {
                    question: "Building a lean-to but notice cold air flowing under sleeping area. Which ground insulation strategy provides most effective solution?",
                    options: ["A) Dig shallow depression to get below ground level", "B) Create thick layer of dry leaves with largest ones on bottom", "C) Lay flat rocks to create thermal mass base", "D) Use green pine boughs with needles pointing up"],
                    correct: 1,
                    explanation: "Minimum 6-8 inches of dry leaves with larger leaves as base layer creates effective dead air space insulation. This prevents conductive heat loss to cold ground.",
                    difficulty: "easy"
                },
                {
                    question: "Improvised water filter from sand, charcoal and cloth produces cloudy water with strange taste. Most likely problem with filtration system?",
                    options: ["A) Sand layer too thick, restricting flow", "B) Charcoal not properly prepared from hardwood", "C) Cloth too fine, creating excessive back pressure", "D) Filter materials in wrong order top to bottom"],
                    correct: 1,
                    explanation: "Proper activated charcoal for filtration must be made from hardwood, burned to white ash, then crushed to increase surface area. Poor charcoal preparation reduces both clarity and taste improvement.",
                    difficulty: "medium"
                },
                {
                    question: "In survival situation need to prioritize time and energy. Which project provides greatest 'force multiplication' for survival capabilities?",
                    options: ["A) Building complex water purification system", "B) Creating sharp, durable knife from stone or metal", "C) Constructing elaborate food storage container", "D) Weaving large basket for material collection"],
                    correct: 1,
                    explanation: "Quality cutting tool enables dozens of other survival tasks - shelter building, fire prep, food processing, tool making, and material processing. It multiplies ability to accomplish subsequent projects.",
                    difficulty: "easy"
                },
                {
                    question: "When smoking meat for preservation, fire produces too much heat and insufficient smoke. How to modify setup?",
                    options: ["A) Add green hardwood to increase smoke production", "B) Move meat closer to fire for faster processing", "C) Create longer smoke path between fire and meat", "D) Use only dry hardwood split into small pieces"],
                    correct: 2,
                    explanation: "Longer smoke path allows heat to dissipate while maintaining smoke density. Dakota fire pit method or offset fire pit achieves proper temperature control for preservative smoking.",
                    difficulty: "medium"
                },
                {
                    question: "Identifying edible plants using Universal Edibility Test. At which stage should you immediately stop testing?",
                    options: ["A) When plant creates mild burning on lip", "B) When plant sap leaves temporary stain on skin", "C) When you notice any bitter taste during tongue test", "D) When stomach feels mild upset after 8 hours"],
                    correct: 0,
                    explanation: "Any burning during contact tests indicates potentially harmful compounds. Test should be immediately stopped and plant marked as unsafe for consumption.",
                    difficulty: "easy"
                },
                {
                    question: "Debris hut completed but still experiencing condensation problems inside. Most effective solution?",
                    options: ["A) Add more debris to outer walls for thickness", "B) Create small ventilation gaps at top and bottom", "C) Line interior with large leaves as vapor barrier", "D) Dig drainage channels around shelter perimeter"],
                    correct: 1,
                    explanation: "Controlled ventilation allows moisture to escape while retaining heat. Small gaps at different heights create airflow that prevents condensation buildup without significant heat loss.",
                    difficulty: "medium"
                },
                {
                    question: "When creating deadfall trap, trigger mechanism keeps releasing prematurely. Which adjustment improves reliability?",
                    options: ["A) Make trigger stick longer for more stability", "B) Use heavier weight to increase trigger force", "C) Increase friction surface area between trigger components", "D) Position trigger deeper under crushing weight"],
                    correct: 2,
                    explanation: "Increasing friction between trigger components (through notches, roughening surfaces, or better fitting) creates more resistance to accidental triggering while maintaining sensitivity to intentional animal contact.",
                    difficulty: "medium"
                },
                {
                    question: "Using pine resin for waterproofing containers but it's too brittle when cooled. What to add for improved flexibility?",
                    options: ["A) Small amounts of charcoal powder as filler", "B) Heated animal fat or plant oils", "C) Fine sand to create more workable texture", "D) Additional heating to change resin consistency"],
                    correct: 1,
                    explanation: "Adding heated animal fat or plant oils to pine resin creates more flexible, less brittle sealant when cooled. This mixture maintains waterproofing while allowing material movement.",
                    difficulty: "medium"
                },
                {
                    question: "In cold conditions, fire keeps dying overnight despite using large hardwood logs. Most likely cause?",
                    options: ["A) Insufficient initial fire size to ignite large logs", "B) Logs positioned too far apart, losing mutual heating", "C) Wrong wood species that burns too quickly", "D) Lack of proper kindling gradation for sustained burning"],
                    correct: 1,
                    explanation: "Large logs must be positioned close enough for mutual thermal reinforcement. 'Star fire' configuration allows pushing logs inward as they burn, maintaining this critical distance.",
                    difficulty: "medium"
                },
                {
                    question: "Built simple lever for moving heavy logs for shelter construction. Despite proper positioning, can't generate sufficient force. What most improves leverage?",
                    options: ["A) Find harder, more solid fulcrum material", "B) Increase length of lever arm you're pushing on", "C) Position fulcrum closer to load being moved", "D) Apply force at steeper downward angle"],
                    correct: 2,
                    explanation: "Moving fulcrum closer to load increases mechanical advantage. The closer fulcrum is to load, the greater force multiplication, though this reduces distance load moves.",
                    difficulty: "medium"
                },
                {
                    question: "When preserving meat by salt curing, meat develops bad smell after few days. What was most likely done wrong?",
                    options: ["A) Used too little salt for proper preservation", "B) Storing meat at too high temperature", "C) Didn't remove all excess moisture before curing", "D) Used wrong type of salt for curing"],
                    correct: 1,
                    explanation: "Salt curing requires cool temperatures (below 50°F) to prevent spoilage bacteria growth. Warm temperatures allow harmful bacteria to multiply faster than salt can suppress them.",
                    difficulty: "medium"
                },
                {
                    question: "Natural rope keeps breaking at splice points where adding new material. How to improve splice strength?",
                    options: ["A) Overlap new fibers over greater distance during splicing", "B) Twist splice points tighter than rest", "C) Add new material only when previous section completely dry", "D) Use only thinnest fibers for splicing connections"],
                    correct: 0,
                    explanation: "Longer overlap distances distribute stress across more fiber-to-fiber contact points, preventing failure at splice. Minimum overlap should be 4-6 times individual fiber length.",
                    difficulty: "medium"
                },
                {
                    question: "In long-term survival situation need to make activities sustainable. Which approach best embodies 'energy return on investment' principle?",
                    options: ["A) Building multiple backup systems for each critical function", "B) Creating one high-quality tool that enables many other tasks", "C) Focusing only on immediate needs without long-term planning", "D) Using most complex available solution to ensure reliability"],
                    correct: 1,
                    explanation: "One high-quality, multi-purpose tool that enables multiple subsequent tasks provides best energy return. This 'force multiplier' approach maximizes capabilities gained per calorie invested in creation.",
                    difficulty: "hard"
                }
            ],

            medical: [
                {
                    question: "Leading group on hike when member falls and gets obvious leg fracture 8 miles from trail. Patient conscious, vitals stable, but can't bear weight. Evening approaching and temperature dropping. Your immediate priority?",
                    options: ["A) Splint fracture immediately with available materials", "B) First assess neurovascular status of injured limb", "C) Send fastest hiker ahead to organize evacuation", "D) Create shelter and wait for morning before moving"],
                    correct: 1,
                    explanation: "Assessing neurovascular status (pulse, sensation, movement, color) takes priority before any manipulation or splinting. Fracture with compromised circulation requires immediate intervention, while fracture with intact neurovascular function allows time for proper splinting and planning.",
                    difficulty: "medium"
                },
                {
                    question: "Team member found unconscious after climbing fall. No obvious external bleeding, but breathing 6 breaths/min and irregular. Using ABCDE assessment, what's your next action after ensuring scene safety?",
                    options: ["A) Check for spinal injuries by palpating neck", "B) Open airway with head tilt-chin lift maneuver", "C) Begin chest compressions immediately", "D) Use jaw thrust without head tilt to open airway"],
                    correct: 3,
                    explanation: "With potential head injury and altered consciousness, spinal injury must be assumed. Jaw thrust maneuver opens airway without moving neck, addressing life-threatening respiratory rate while protecting spine.",
                    difficulty: "medium"
                },
                {
                    question: "During winter camping, group member shows confusion, slurred speech, and stopped shivering despite continued cold exposure. Skin pale, and he's clumsily performing simple tasks. What hypothermia stage is he experiencing?",
                    options: ["A) Mild hypothermia - needs warm drinks and shelter", "B) Moderate hypothermia - serious emergency requiring immediate rewarming", "C) Severe hypothermia - shivering stopped indicating core temp below 90°F", "D) Normal cold response - these symptoms expected in cold weather"],
                    correct: 1,
                    explanation: "Combination of confusion, slurred speech, and clumsiness ('umbles') with continued shivering indicates moderate hypothermia. This is serious emergency requiring aggressive rewarming, but presence of shivering means they haven't progressed to severe hypothermia where shivering stops.",
                    difficulty: "medium"
                },
                {
                    question: "Treating deep laceration on forearm that's bleeding heavily. Direct pressure doesn't control bleeding. Next appropriate step in bleeding control algorithm?",
                    options: ["A) Apply tourniquet 2-3 inches above wound", "B) Elevate arm and apply pressure to brachial artery", "C) Pack wound tightly with clean gauze or cloth", "D) Apply ice to wound for vasoconstriction"],
                    correct: 2,
                    explanation: "For deep wounds with heavy bleeding not controlled by direct pressure, wound packing is next step. Wound should be tightly packed from bottom up with gauze, then direct pressure applied over packing. Tourniquets reserved for life-threatening bleeding when other methods fail.",
                    difficulty: "medium"
                },
                {
                    question: "Hiking partner stung by multiple wasps and develops facial swelling, difficulty breathing, and hives on chest. He's conscious but anxious. If epinephrine unavailable, your priority action?",
                    options: ["A) Give antihistamines and monitor closely", "B) Evacuate immediately while keeping them sitting upright", "C) Apply cold compresses to reduce swelling", "D) Lay them flat to improve circulation"],
                    correct: 1,
                    explanation: "This is anaphylaxis - life-threatening emergency. Without epinephrine, immediate evacuation is absolute priority. Keep patient upright to help breathing. While antihistamines may help, evacuation cannot be delayed for their administration.",
                    difficulty: "easy"
                },
                {
                    question: "You suspect team member consumed poisonous mushrooms 18 hours ago. They had initial nausea and vomiting that resolved, but now seem normal. What's most concerning about this picture?",
                    options: ["A) Delayed onset suggests serious neurological toxin", "B) Apparent recovery may be false improvement before liver failure", "C) Vomiting indicates poison was eliminated", "D) 18-hour delay means danger has passed"],
                    correct: 1,
                    explanation: "Classic pattern of amatoxin poisoning (death cap mushrooms) includes initial GI symptoms that resolve, creating false hope during asymptomatic period while liver-destroying toxins work. This is followed by potentially fatal liver failure 3-5 days later, making immediate evacuation critical.",
                    difficulty: "hard"
                },
                {
                    question: "Group encounters someone with suspected venomous snake bite on ankle. Bite occurred 30 minutes ago, progressive swelling to mid-calf, and person reports increasing pain. Best approach?",
                    options: ["A) Apply tourniquet above swelling to prevent venom spread", "B) Make small cuts over fang marks to drain venom", "C) Keep limb still below heart level and evacuate immediately", "D) Apply ice packs to slow venom absorption"],
                    correct: 2,
                    explanation: "Modern snakebite management focuses on immobilization below heart level to slow venom circulation and immediate evacuation. Tourniquets, cutting/suction, and ice are all contraindicated as they increase tissue damage without removing significant venom.",
                    difficulty: "medium"
                },
                {
                    question: "During winter expedition need to create improvised shelter for injured team member showing early hypothermia signs. Which principle most important for effective cold protection?",
                    options: ["A) Maximize wind protection above all other factors", "B) Create multiple insulation layers with air spaces between them", "C) Use reflective materials to bounce heat back to body", "D) Ensure shelter is maximum size for comfort"],
                    correct: 1,
                    explanation: "Effective insulation depends on trapping still air in layers. Multiple layers with air spaces provide superior insulation compared to single thick layers. While wind protection is important, proper insulation is foundation of heat retention.",
                    difficulty: "medium"
                },
                {
                    question: "Managing multiple casualties after rockfall. Using triage principles, which patient should receive immediate attention?",
                    options: ["A) Unconscious person with weak pulse and slow breathing", "B) Conscious person with obvious open leg fracture and controlled bleeding", "C) Walking person complaining of severe back pain", "D) Conscious person with rapid breathing and uncontrolled arm bleeding"],
                    correct: 3,
                    explanation: "In triage, 'Immediate' category patients have life-threatening injuries that are salvageable with intervention. Uncontrolled bleeding is immediately life-threatening but treatable. Unconscious person may be too severe (expectant category), while walking wounded and controlled bleeding have lower priority.",
                    difficulty: "hard"
                },
                {
                    question: "Team member falls into cold water (45°F) wearing heavy clothing. They manage to grab boat but can't climb in. What's most critical danger in first 3 minutes?",
                    options: ["A) Rapid onset of hypothermia", "B) Initial cold shock response causing drowning", "C) Clothing becoming waterlogged and pulling them under", "D) Panic leading to poor decision making"],
                    correct: 1,
                    explanation: "Initial cold shock response (0-3 minutes) causes involuntary gasping and hyperventilation, creating highest drowning risk. If this critical period is survived, there's meaningful time before hypothermia becomes life-threatening, even in very cold water.",
                    difficulty: "medium"
                },
                {
                    question: "Treating second-degree burn on hand from camping accident. After cooling with water, which improvised treatment shows best evidence for promoting healing?",
                    options: ["A) Apply oil or cooking fat to moisturize burn", "B) Pop any blisters to prevent infection", "C) Apply raw honey if available and cover with clean cloth", "D) Rub snow on burn to continue cooling"],
                    correct: 2,
                    explanation: "Raw honey has proven antimicrobial properties and creates moist healing environment. It's one of few natural remedies with clinical evidence for burn treatment. Oil/fat retains heat, popping blisters increases infection risk, and continued cooling with snow can cause cold injury.",
                    difficulty: "easy"
                },
                {
                    question: "During multi-day wilderness medical emergency, managing someone with infected wound showing infection signs. Antibiotic supply limited. Which approach best balances treatment with resource conservation?",
                    options: ["A) Use full standard antibiotic course immediately", "B) Give half doses to make supplies last longer", "C) Wait until infection becomes severe before starting antibiotics", "D) Use antibiotics 3 days, then reassess before continuing"],
                    correct: 0,
                    explanation: "Incomplete antibiotic courses risk creating resistant bacteria and treatment failure. While resource conservation important, proper antibiotic use with clear indications maximizes effectiveness. Half doses or shortened courses often fail to clear infections.",
                    difficulty: "hard"
                },
                {
                    question: "Team member reports severe abdominal pain that started around navel and now moved to right lower abdomen. They have fever and refuse to walk due to pain. You're 2 days from evacuation. Primary concern?",
                    options: ["A) Food poisoning from contaminated water", "B) Appendicitis requiring immediate evacuation attempt", "C) Kidney stones that will pass naturally", "D) Muscle strain from carrying heavy pack"],
                    correct: 1,
                    explanation: "Classic appendicitis presentation (periumbilical pain migrating to right lower quadrant with fever and inability to walk) requires immediate evacuation. Appendix can rupture within 48-72 hours, dramatically increasing mortality without surgical intervention.",
                    difficulty: "medium"
                },
                {
                    question: "When crossing fast stream, team member falls and appears to have shoulder dislocation. Arm in abnormal position and they can't move it. Evacuation timeline uncertain. Best approach?",
                    options: ["A) Attempt immediate reduction using gentle traction", "B) Immobilize in position found and arrange evacuation", "C) Give pain medication then attempt reduction", "D) Attempt reduction only if you have previous medical training"],
                    correct: 1,
                    explanation: "Without proper training and in uncertain evacuation circumstances, attempting joint reduction risks serious neurovascular damage. Immobilization in position found with rapid evacuation is safest. Pain control while maintaining immobilization appropriate.",
                    difficulty: "medium"
                },
                {
                    question: "Leading group through hot desert terrain when someone develops hot, dry skin, confusion, and rapid pulse. Their core temperature feels extremely elevated. Immediate priority?",
                    options: ["A) Give them cold water to drink immediately", "B) Move them to shade and begin aggressive cooling measures", "C) Continue slow hiking to reach help faster", "D) Give salt tablets to replace lost electrolytes"],
                    correct: 1,
                    explanation: "This is heat stroke - true medical emergency with high mortality. Aggressive cooling takes absolute priority over everything else, including evacuation preparation. Every minute of core temperature above 105°F increases organ damage risk.",
                    difficulty: "easy"
                },
                {
                    question: "Team member stepped on nail that penetrated through their boot. Nail went completely through sole into their foot. Nail no longer in wound. Primary concern with this injury?",
                    options: ["A) Stopping bleeding which is likely severe", "B) High infection risk from deep tissue inoculation", "C) Tetanus infection from rusty metal", "D) Possible broken bones in foot"],
                    correct: 1,
                    explanation: "Puncture wounds, especially through footwear, carry extremely high infection risk due to deep tissue inoculation with bacteria. Wound looks minor externally but creates perfect conditions for anaerobic infections. Bleeding usually minimal with puncture wounds.",
                    difficulty: "medium"
                },
                {
                    question: "When treating fracture in wilderness need to improvise splint. Which principle most important for effective splinting?",
                    options: ["A) Make splint as tight as possible to prevent movement", "B) Immobilize joints above and below fracture site", "C) Use only rigid materials for proper support", "D) Extend splint past fingers or toes"],
                    correct: 1,
                    explanation: "Effective splinting requires immobilizing joints above and below fracture to prevent movement at injury site. This principle applies regardless of materials used. Over-tightening can compromise circulation, and soft materials can be effective when properly applied.",
                    difficulty: "easy"
                },
                {
                    question: "Group caught in severe weather and must shelter for extended time. One member showing mild hypothermia symptoms. Which rewarming method most appropriate for field conditions?",
                    options: ["A) Place them directly by fire for rapid warming", "B) Give them alcohol for vasodilation and warmth", "C) Use skin-to-skin contact in shared sleeping system", "D) Make them exercise vigorously to generate heat"],
                    correct: 2,
                    explanation: "For mild hypothermia, gradual rewarming with shared body heat is safe and effective. Direct heat sources risk burns due to impaired sensation, alcohol accelerates heat loss, and vigorous exercise can worsen hypothermia by shunting warm blood to extremities.",
                    difficulty: "medium"
                },
                {
                    question: "Encounter unconscious person who appears to have no pulse or breathing. They're cold to touch and skin is blue-gray. In wilderness conditions, what should guide decision about starting CPR?",
                    options: ["A) Begin CPR immediately - time is critical", "B) Don't start CPR - they're obviously dead", "C) Check for signs of life up to 60 seconds before deciding", "D) Warm them first, then reassess for signs of life"],
                    correct: 2,
                    explanation: "In hypothermic patients, pulse and breathing may be so slow as undetectable. The saying applies: 'no one is dead until warm and dead.' Check for signs of life up to 60 seconds, as severely hypothermic patients have survived without detectable vital signs.",
                    difficulty: "hard"
                },
                {
                    question: "Team member reports tick bite 2 days ago. Tick was properly removed but now there's expanding red rash around bite site with clear center, resembling 'bull's eye' pattern. Primary concern?",
                    options: ["A) Local allergic reaction to tick bite", "B) Possible Lyme disease requiring antibiotic treatment", "C) Normal healing response to tick saliva", "D) Secondary bacterial infection from scratching"],
                    correct: 1,
                    explanation: "Expanding 'bull's eye' rash (erythema migrans) is pathognomonic for early Lyme disease. Early antibiotic treatment is highly effective, while delayed treatment can lead to serious complications including cardiac and neurological problems.",
                    difficulty: "easy"
                }
            ]
        };

        let currentQuiz = null;
        let currentQuestionIndex = 0;
        let selectedAnswer = null;
        let score = 0;
        let answeredQuestions = [];

        function startQuiz(quizType) {
            currentQuiz = [];
            currentQuestionIndex = 0;
            score = 0;
            answeredQuestions = [];
            
            // Collect questions based on type
            if (quizType === 'all') {
                currentQuiz = [...questionsData.basic, ...questionsData.offgrid, ...questionsData.medical];
                document.getElementById('quizTitle').textContent = 'Complete Preparedness Assessment';
            } else if (quizType === 'basic') {
                currentQuiz = [...questionsData.basic];
                document.getElementById('quizTitle').textContent = 'Basic Survival Skills';
            } else if (quizType === 'offgrid') {
                currentQuiz = [...questionsData.offgrid];
                document.getElementById('quizTitle').textContent = 'Life Without Electricity';
            } else if (quizType === 'medical') {
                currentQuiz = [...questionsData.medical];
                document.getElementById('quizTitle').textContent = 'Wilderness Medicine';
            }

            // Shuffle questions
            shuffleArray(currentQuiz);
            
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'block';
            document.getElementById('resultsContainer').style.display = 'none';
            
            showQuestion();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function showQuestion() {
            if (currentQuestionIndex >= currentQuiz.length) {
                showResults();
                return;
            }

            const question = currentQuiz[currentQuestionIndex];
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('questionCounter').textContent = `${currentQuestionIndex + 1}/${currentQuiz.length}`;
            
            const progressPercent = ((currentQuestionIndex) / currentQuiz.length) * 100;
            document.getElementById('progressBar').style.width = progressPercent + '%';

            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionDiv);
            });

            document.getElementById('explanation').style.display = 'none';
            document.getElementById('nextButton').disabled = true;
            selectedAnswer = null;
        }

        function selectOption(index) {
            selectedAnswer = index;
            
            const options = document.querySelectorAll('.option');
            options.forEach(option => option.classList.remove('selected'));
            options[index].classList.add('selected');
            
            document.getElementById('nextButton').disabled = false;
        }

        function nextQuestion() {
            const question = currentQuiz[currentQuestionIndex];
            const isCorrect = selectedAnswer === question.correct;
            
            if (isCorrect) {
                score++;
            }

            answeredQuestions.push({
                question: question.question,
                selectedAnswer: selectedAnswer,
                correctAnswer: question.correct,
                isCorrect: isCorrect,
                explanation: question.explanation,
                difficulty: question.difficulty
            });

            // Show correct answer
            const options = document.querySelectorAll('.option');
            options.forEach((option, index) => {
                if (index === question.correct) {
                    option.classList.add('correct');
                } else if (index === selectedAnswer && !isCorrect) {
                    option.classList.add('incorrect');
                }
                option.onclick = null; // Disable clicks
            });

            // Show explanation
            const explanationDiv = document.getElementById('explanation');
            explanationDiv.innerHTML = `
                <h4>${isCorrect ? '✅ Correct!' : '❌ Incorrect'}</h4>
                <p>${question.explanation}</p>
            `;
            explanationDiv.style.display = 'block';

            // Change button
            const nextButton = document.getElementById('nextButton');
            nextButton.textContent = currentQuestionIndex === currentQuiz.length - 1 ? 'Finish Test' : 'Next Question';
            nextButton.onclick = () => {
                currentQuestionIndex++;
                nextButton.textContent = 'Next';
                nextButton.onclick = nextQuestion;
                showQuestion();
            };
        }

        function showResults() {
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'block';

            const percentage = Math.round((score / currentQuiz.length) * 100);
            document.getElementById('scoreText').textContent = `${score}/${currentQuiz.length}`;

            const scoreCircle = document.getElementById('scoreCircle');
            const resultTitle = document.getElementById('resultTitle');
            const resultDescription = document.getElementById('resultDescription');

            if (percentage >= 90) {
                scoreCircle.className = 'score-circle score-excellent';
                resultTitle.textContent = 'Excellent Preparedness! 🏆';
                resultDescription.textContent = 'You have outstanding survival knowledge. You\'re ready for most extreme situations.';
            } else if (percentage >= 70) {
                scoreCircle.className = 'score-circle score-good';
                resultTitle.textContent = 'Good Preparedness 👍';
                resultDescription.textContent = 'Your knowledge is at a good level, but there are areas for improvement. Continue studying and practicing.';
            } else if (percentage >= 50) {
                scoreCircle.className = 'score-circle score-basic';
                resultTitle.textContent = 'Basic Knowledge ⚠️';
                resultDescription.textContent = 'You have the basics, but need to seriously improve preparation. We recommend studying books and taking training.';
            } else {
                scoreCircle.className = 'score-circle score-critical';
                resultTitle.textContent = 'Critical Gap! 🚨';
                resultDescription.textContent = 'Your knowledge is insufficient for safety. You urgently need to study survival basics.';
            }

            // Calculate category-specific scores for recommendations
            const categoryScores = calculateCategoryScores();
            
            // Add detailed statistics
            const difficultyStats = answeredQuestions.reduce((acc, q) => {
                if (!acc[q.difficulty]) acc[q.difficulty] = { correct: 0, total: 0 };
                acc[q.difficulty].total++;
                if (q.isCorrect) acc[q.difficulty].correct++;
                return acc;
            }, {});

            let statsHtml = '<div style="margin-top: 20px; text-align: left; background: #f8f9fa; padding: 20px; border-radius: 12px; border-left: 4px solid #7dae42;"><h3 style="color: #2d5016; margin-bottom: 16px;">Detailed Statistics:</h3>';
            
            Object.keys(difficultyStats).forEach(difficulty => {
                const stats = difficultyStats[difficulty];
                const percent = Math.round((stats.correct / stats.total) * 100);
                const difficultyNames = {
                    'easy': 'Easy',
                    'medium': 'Medium', 
                    'intermediate': 'Medium',
                    'hard': 'Hard',
                    'complex': 'Hard'
                };
                
                const color = percent >= 70 ? '#28a745' : percent >= 50 ? '#ffc107' : '#dc3545';
                statsHtml += `<p style="margin: 8px 0; color: #333;"><strong>${difficultyNames[difficulty] || difficulty}:</strong> <span style="color: ${color}; font-weight: bold;">${stats.correct}/${stats.total} (${percent}%)</span></p>`;
            });
            
            statsHtml += '</div>';
            
            // Add book recommendations
            const recommendations = generateBookRecommendations(percentage, categoryScores);
            statsHtml += recommendations;
            
            resultDescription.innerHTML += statsHtml;
        }

        function calculateCategoryScores() {
            // Get original question data to categorize answers
            const basicQuestions = questionsData.basic;
            const offgridQuestions = questionsData.offgrid;
            const medicalQuestions = questionsData.medical;
            
            const scores = {
                basic: { correct: 0, total: 0 },
                offgrid: { correct: 0, total: 0 },
                medical: { correct: 0, total: 0 }
            };
            
            answeredQuestions.forEach(answer => {
                // Find which category this question belongs to
                const questionText = answer.question;
                
                if (basicQuestions.some(q => q.question === questionText)) {
                    scores.basic.total++;
                    if (answer.isCorrect) scores.basic.correct++;
                } else if (offgridQuestions.some(q => q.question === questionText)) {
                    scores.offgrid.total++;
                    if (answer.isCorrect) scores.offgrid.correct++;
                } else if (medicalQuestions.some(q => q.question === questionText)) {
                    scores.medical.total++;
                    if (answer.isCorrect) scores.medical.correct++;
                }
            });
            
            return scores;
        }

        function generateBookRecommendations(overallPercentage, categoryScores) {
            let recommendationsHtml = '<div style="margin-top: 24px; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 12px; border: 2px solid #7dae42;">';
            
            // Perfect score - recommend author exploration
            if (overallPercentage === 100) {
                recommendationsHtml += `
                    <h3 style="color: #2d5016; margin-bottom: 16px; text-align: center;">🎯 Master Level Achieved!</h3>
                    <p style="color: #333; margin-bottom: 16px; text-align: center;">You've mastered all survival fundamentals! Ready to explore advanced topics?</p>
                    <div style="text-align: center;">
                        <button onclick="window.open('${bookLinks.author[currentRegion]}', '_blank')" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer; margin: 8px;">
                            📚 Explore More Books by Caleb North
                        </button>
                    </div>
                `;
            }
            // Excellent performance (90-99%) - recommend all books or specific areas
            else if (overallPercentage >= 90) {
                const weakestAreas = findWeakestAreas(categoryScores);
                recommendationsHtml += `
                    <h3 style="color: #2d5016; margin-bottom: 16px;">📖 Recommended Reading for Excellence</h3>
                    <p style="color: #333; margin-bottom: 16px;">You're almost there! Focus on these areas to reach mastery:</p>
                `;
                recommendationsHtml += generateSpecificBookRecommendations(weakestAreas);
            }
            // Good performance (70-89%) - recommend books based on weak areas
            else if (overallPercentage >= 70) {
                const weakestAreas = findWeakestAreas(categoryScores);
                recommendationsHtml += `
                    <h3 style="color: #2d5016; margin-bottom: 16px;">📚 Strengthen Your Knowledge</h3>
                    <p style="color: #333; margin-bottom: 16px;">Good foundation! These books will help you improve in key areas:</p>
                `;
                recommendationsHtml += generateSpecificBookRecommendations(weakestAreas);
            }
            // Basic or Critical - recommend comprehensive approach
            else {
                recommendationsHtml += `
                    <h3 style="color: #2d5016; margin-bottom: 16px;">🎯 Essential Learning Path</h3>
                    <p style="color: #333; margin-bottom: 20px;">Start with the fundamentals and build comprehensive survival skills:</p>
                    
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <div style="display: flex; gap: 20px; align-items: center;">
                            <div style="flex-shrink: 0;">
                                <img src="./images/basic-survival-cover.jpg" alt="Basic Survival Skills Book" style="width: 120px; height: 160px; object-fit: cover; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                            </div>
                            <div style="flex: 1;">
                                <h4 style="color: #2d5016; margin-bottom: 12px; font-size: 1.2rem;">🎒 Start Here: Basic Survival Skills</h4>
                                <p style="color: #666; margin-bottom: 16px; line-height: 1.5;">Perfect foundation for beginners. Master the essential mindset, first aid, communication, and fitness fundamentals.</p>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <button onclick="window.open('${bookLinks.basic[currentRegion]}', '_blank')" style="background: linear-gradient(135deg, #7dae42, #5d8234); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer;">
                                        📖 Get This Book
                                    </button>
                                    <span style="color: #28a745; font-weight: bold; font-size: 1.1rem;">${bookPrices.basic[currentRegion]}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%); border-radius: 12px; border: 2px solid #17a2b8;">
                        <h4 style="color: #2d5016; margin-bottom: 16px;">💡 Pro Tip: Complete Survival Mastery</h4>
                        <div style="display: flex; justify-content: center; gap: 16px; margin-bottom: 16px;">
                            <img src="./images/basic-survival-cover.jpg" alt="Basic Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                            <img src="./images/offgrid-survival-cover.jpg" alt="Off-Grid Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                            <img src="./images/medical-survival-cover.jpg" alt="Medical Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                        </div>
                        <p style="color: #666; margin-bottom: 16px;">Get all three books for complete survival knowledge!</p>
                        <button onclick="window.open('${bookLinks.collection[currentRegion]}', '_blank')" style="background: linear-gradient(135deg, #17a2b8, #007bff); color: white; border: none; padding: 16px 32px; border-radius: 8px; font-size: 1.1rem; cursor: pointer; box-shadow: 0 4px 16px rgba(23, 162, 184, 0.3);">
                            📚 Get Complete Collection
                        </button>
                    </div>
                `;
            }
            
            recommendationsHtml += '</div>';
            return recommendationsHtml;
        }

        function findWeakestAreas(categoryScores) {
            const areas = [];
            
            Object.keys(categoryScores).forEach(category => {
                const score = categoryScores[category];
                if (score.total > 0) {
                    const percentage = (score.correct / score.total) * 100;
                    areas.push({
                        category: category,
                        percentage: percentage,
                        score: score
                    });
                }
            });
            
            // Sort by percentage (worst first)
            areas.sort((a, b) => a.percentage - b.percentage);
            return areas;
        }

        function generateSpecificBookRecommendations(areas) {
            let html = '';
            
            areas.forEach((area, index) => {
                const bookInfo = getBookInfo(area.category);
                const percentage = Math.round(area.percentage);
                const color = percentage < 50 ? '#dc3545' : percentage < 70 ? '#ffc107' : '#28a745';
                
                html += `
                    <div style="margin-bottom: 20px; padding: 20px; background: white; border-radius: 12px; border-left: 4px solid ${color}; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <div style="display: flex; gap: 20px; align-items: flex-start;">
                            <div style="flex-shrink: 0;">
                                <img src="${bookInfo.coverImage}" alt="${bookInfo.title}" style="width: 120px; height: 160px; object-fit: cover; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                            </div>
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                    <h4 style="color: #2d5016; margin: 0; font-size: 1.2rem;">${bookInfo.emoji} ${bookInfo.title}</h4>
                                    <span style="color: ${color}; font-weight: bold; font-size: 1.1rem; background: ${color}20; padding: 4px 12px; border-radius: 20px;">${area.score.correct}/${area.score.total} (${percentage}%)</span>
                                </div>
                                <p style="color: #666; margin-bottom: 16px; font-size: 0.95rem; line-height: 1.5;">${bookInfo.description}</p>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <button onclick="window.open('${bookInfo.link}', '_blank')" style="background: linear-gradient(135deg, #7dae42, #5d8234); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; flex: 1; max-width: 200px;">
                                        📖 Get This Book
                                    </button>
                                    <span style="color: #28a745; font-weight: bold; font-size: 1.1rem;">${bookInfo.price}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            // Add bundle option if multiple books recommended
            if (areas.length > 1) {
                html += `
                    <div style="margin-top: 24px; padding: 24px; background: linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%); border-radius: 12px; border: 2px solid #17a2b8; text-align: center;">
                        <h4 style="color: #2d5016; margin-bottom: 16px;">📚 Complete Your Knowledge</h4>
                        <div style="display: flex; justify-content: center; gap: 16px; margin-bottom: 16px;">
                            <img src="./images/basic-survival-cover.jpg" alt="Basic Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                            <img src="./images/offgrid-survival-cover.jpg" alt="Off-Grid Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                            <img src="./images/medical-survival-cover.jpg" alt="Medical Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                        </div>
                        <p style="color: #666; margin-bottom: 16px;">Get all three books for complete survival knowledge across all scenarios!</p>
                        <button onclick="window.open('${bookLinks.collection[currentRegion]}', '_blank')" style="background: linear-gradient(135deg, #17a2b8, #007bff); color: white; border: none; padding: 16px 32px; border-radius: 8px; font-size: 1.1rem; cursor: pointer; box-shadow: 0 4px 16px rgba(23, 162, 184, 0.3);">
                            📚 Get Complete Collection
                        </button>
                    </div>
                `;
            }
            
            return html;
        }

        function getBookInfo(category) {
            const books = {
                basic: {
                    emoji: '🎒',
                    title: 'Basic Survival Skills',
                    shortTitle: 'Basic Survival Skills Book',
                    description: 'Master the fundamentals: mindset, first aid, communication, and physical preparedness for any emergency situation.',
                    link: bookLinks.basic[currentRegion],
                    coverImage: './images/basic-survival-cover.jpg',
                    price: bookPrices.basic[currentRegion]
                },
                offgrid: {
                    emoji: '🔥',
                    title: 'Off-Grid Survival',
                    shortTitle: 'Live Free Off The Grid',
                    description: 'Learn practical skills for living without electricity: shelter building, fire making, water purification, and food procurement.',
                    link: bookLinks.offgrid[currentRegion],
                    coverImage: './images/offgrid-survival-cover.jpg',
                    price: bookPrices.offgrid[currentRegion]
                },
                medical: {
                    emoji: '🏥',
                    title: 'Wilderness Medicine',
                    shortTitle: 'Off-Grid Medicine Handbook',
                    description: 'Essential first aid and medical skills for extreme conditions without hospitals or modern medical facilities.',
                    link: bookLinks.medical[currentRegion],
                    coverImage: './images/medical-survival-cover.jpg',
                    price: bookPrices.medical[currentRegion]
                }
            };
            
            return books[category] || books.basic;
        }

        function showMainMenu() {
            document.getElementById('mainMenu').style.display = 'grid';
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'none';
        }

        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'survival-quiz-v1';
                    const urlsToCache = ['/'];
                    
                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                        );
                    });
                    
                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => response || fetch(event.request))
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            });
        }
    </script>
</body>
</html>,
                flag: '🇺🇸',
                name: 'United States'
            },
            uk: {
                currency: '£',
                flag: '🇬🇧', 
                name: 'United Kingdom'
            },
            ca: {
                currency: 'CAD 
        const questionsData = {
            basic: [
                {
                    question: "You're preparing an emergency kit and can only take one item. What would you choose for maximum functionality?",
                    options: ["A) Swiss knife with 15 tools", "B) Simple bandana", "C) Waterproof flashlight", "D) Portable charger"],
                    correct: 1,
                    explanation: "A bandana can serve as a bandage, tourniquet, water filter, signal flag, sun protection, fire starter material, and dozens of other functions.",
                    difficulty: "easy"
                },
                {
                    question: "A teammate has an open fracture with bright red pulsating blood. Direct pressure on the wound doesn't stop the bleeding. What's next?",
                    options: ["A) Apply a tourniquet above the wound", "B) Elevate the arm and continue pressure", "C) Find the pulse point on the arm and compress the artery", "D) Clean the wound and apply a tight bandage"],
                    correct: 2,
                    explanation: "For arterial bleeding when direct pressure is ineffective, the next step is compressing the feeding artery at the pulse point between the bicep and tricep.",
                    difficulty: "intermediate"
                },
                {
                    question: "How do you test readiness for a long hike with a backpack in extreme conditions?",
                    options: ["A) Run 5 km without a backpack", "B) Walk 3 miles with a backpack weighing 15% of your body weight", "C) Lift the backpack overhead 20 times", "D) Stand with the backpack for 30 minutes"],
                    correct: 1,
                    explanation: "The test with a backpack weighing 15% of body weight over 3 miles reveals real readiness for long hikes and identifies weaknesses in endurance.",
                    difficulty: "easy"
                },
                {
                    question: "You're lost and starting to panic. Heart beating fast, breathing rapid. Which technique quickly restores control?",
                    options: ["A) Hold breath for a minute", "B) Breathe using the pattern: 4 seconds in - 4 hold - 4 out - 4 hold", "C) Breathe as fast as possible for 30 seconds", "D) Lie down and relax"],
                    correct: 1,
                    explanation: "Tactical breathing 4-4-4-4 activates the parasympathetic nervous system and quickly reduces stress levels, restoring decision-making ability.",
                    difficulty: "easy"
                },
                {
                    question: "You have paracord. Why is it especially valuable in survival situations?",
                    options: ["A) Only because of high strength", "B) Waterproof coating", "C) Inner threads can be used separately for fishing and sewing", "D) Glows in the dark"],
                    correct: 2,
                    explanation: "Paracord contains inner fibers that can be used separately as fishing line, sewing thread, thin cord - multiplying functionality.",
                    difficulty: "intermediate"
                },
                {
                    question: "In critical situations, the brain narrows perception and impairs memory. How does this affect decision-making?",
                    options: ["A) Decisions become faster and more accurate", "B) Doesn't affect decision quality", "C) Decision quality drops sharply due to tunnel vision", "D) Superhuman analytical abilities appear"],
                    correct: 2,
                    explanation: "Stress causes tunnel vision, working memory disruption, and reversion to primitive reactions, seriously reducing decision quality.",
                    difficulty: "intermediate"
                },
                {
                    question: "A teammate is panicking and breathing fast and shallow. Which breathing technique would you recommend?",
                    options: ["A) 3-3-3-3 (in-hold-out-hold)", "B) 4-4-4-4 (in-hold-out-hold)", "C) 5-5-5-5 (in-hold-out-hold)", "D) Breathe into a bag"],
                    correct: 1,
                    explanation: "Tactical breathing using the 4-4-4-4 pattern (inhale 4 sec, hold 4 sec, exhale 4 sec, hold 4 sec) effectively restores control during panic.",
                    difficulty: "easy"
                },
                {
                    question: "What's the key principle of everyday carry (EDC) emergency items philosophy?",
                    options: ["A) Carry maximum useful items", "B) Only the most expensive items", "C) Items you actually carry every day", "D) Only military gear"],
                    correct: 2,
                    explanation: "The principle of constancy - true EDC includes only what you carry constantly. An item left at home due to inconvenience is useless in an emergency.",
                    difficulty: "intermediate"
                },
                {
                    question: "An earthquake starts while you're indoors. What are the correct actions?",
                    options: ["A) Run to the exit", "B) Stand in a doorway", "C) Drop, take cover under a table, hold on", "D) Jump out the window"],
                    correct: 2,
                    explanation: "Modern recommendation - 'Drop, Cover, Hold' - drop to knees, take cover under a sturdy table, protect head. Doorways in modern buildings don't provide special protection.",
                    difficulty: "intermediate"
                },
                {
                    question: "When planning family emergency communication, why do you need a contact in another city?",
                    options: ["A) To contact authorities", "B) Local communication works, distant doesn't", "C) Long-distance communication often works when local is disrupted", "D) It's a legal requirement"],
                    correct: 2,
                    explanation: "During local disasters, long-distance communication lines often remain operational when local towers and cables are damaged. The remote contact becomes a family information center.",
                    difficulty: "intermediate"
                },
                {
                    question: "You see signs of danger but think 'this can't be serious, everything will be fine.' What psychological trap is this?",
                    options: ["A) Panic attack", "B) Normalcy bias - underestimating threats", "C) Depression", "D) Excessive anxiety"],
                    correct: 1,
                    explanation: "Normalcy bias causes people to minimize threat severity and assume normal conditions will continue even with obvious danger signs. This leads to dangerous response delays.",
                    difficulty: "complex"
                },
                {
                    question: "How do you train multiple ways to perform critical survival tasks?",
                    options: ["A) Learn one method perfectly", "B) Practice primary tool, alternative method, and improvisation without tools", "C) Collect maximum tools", "D) Rely on intuition"],
                    correct: 1,
                    explanation: "'Tool triangulation' - practicing key tasks three ways: primary tool, alternative method, and improvisation without tools creates reliability.",
                    difficulty: "complex"
                },
                {
                    question: "A teammate got burned with boiling water. What should NOT be done?",
                    options: ["A) Cool with cold water", "B) Cover with clean cloth", "C) Apply oil or grease", "D) Give pain medication"],
                    correct: 2,
                    explanation: "Oil and greasy substances retain heat in tissues and worsen damage while creating perfect conditions for infection. This is an outdated and dangerous method.",
                    difficulty: "easy"
                },
                {
                    question: "What does the 'Turn Around, Don't Drown' rule mean during floods?",
                    options: ["A) Turn your back to water", "B) Never enter moving water", "C) Don't turn the car in water", "D) Only swim on your back"],
                    correct: 1,
                    explanation: "Just 6 inches of moving water can knock down an adult, and 12 inches can carry away a car. Better to turn around and find another route than risk life.",
                    difficulty: "intermediate"
                },
                {
                    question: "After many hours of decision-making in crisis, your decision quality deteriorates. What is this?",
                    options: ["A) Panic", "B) Decision fatigue - cognitive resource depletion", "C) Depression", "D) Loss of concentration"],
                    correct: 1,
                    explanation: "Decision fatigue occurs when cognitive resources are depleted after multiple choices. Decision quality drops even while maintaining physical strength.",
                    difficulty: "complex"
                },
                {
                    question: "Why is a metal container better than plastic for survival?",
                    options: ["A) It's lighter", "B) Can cook on fire and boil water", "C) More visible to rescuers", "D) Doesn't crack in cold"],
                    correct: 1,
                    explanation: "A metal container can be placed directly on fire for cooking and boiling water for disinfection - these are critically important survival functions.",
                    difficulty: "intermediate"
                },
                {
                    question: "How do you properly signal distress with sound or light?",
                    options: ["A) 3 short - 3 long - 3 short", "B) 3 long - 3 short - 3 long", "C) Continuous signal", "D) 5 short signals"],
                    correct: 0,
                    explanation: "SOS in Morse code: 3 short signals, 3 long, 3 short. This is the international distress signal recognized worldwide.",
                    difficulty: "easy"
                },
                {
                    question: "You've already walked 10 km on the wrong route but continue, thinking 'can't waste the distance covered.' What error is this?",
                    options: ["A) Correct strategy", "B) Sunk cost fallacy - continuing due to already invested resources", "C) Excessive caution", "D) Good planning"],
                    correct: 1,
                    explanation: "Sunk cost fallacy makes people continue ineffective actions due to already invested resources instead of evaluating prospects. In survival, this can be deadly.",
                    difficulty: "complex"
                },
                {
                    question: "Which natural object works best as exercise equipment for balance and strength?",
                    options: ["A) Only large rocks", "B) Fallen logs of different diameters", "C) Only water bodies", "D) Sand dunes"],
                    correct: 1,
                    explanation: "Fallen logs are ideal for balance training (log walking), jumping and climbing, developing skills for movement over complex terrain.",
                    difficulty: "intermediate"
                },
                {
                    question: "What is the foundation of all survival skills?",
                    options: ["A) Physical strength", "B) Expensive gear", "C) Technical knowledge", "D) Psychological resilience"],
                    correct: 3,
                    explanation: "The most sophisticated gear cannot save someone whose mind has already given up. Psychological resilience determines whether knowledge and skills will be applied or the person will surrender.",
                    difficulty: "easy"
                }
            ],
            
            offgrid: [
                {
                    question: "Lost in the forest and need urgent shelter, having only a knife and rope. Which construction gives basic protection with minimal time investment?",
                    options: ["A) Fully built A-frame with complete insulation", "B) Debris hut using a fallen tree as ridgepole", "C) Excavated earth shelter with wooden roof", "D) Teepee from bent saplings"],
                    correct: 1,
                    explanation: "A debris hut uses existing natural elements (fallen tree) as structural foundation, requires minimal time for frame construction and can be quickly insulated with available forest debris.",
                    difficulty: "easy"
                },
                {
                    question: "When using a hand drill for fire, tinder catches but flame quickly dies. Most likely cause?",
                    options: ["A) Insufficient downward pressure on spindle", "B) Tinder packed too tightly without sufficient airflow", "C) Fireboard wood too wet for proper friction", "D) Wrong angle of notch in fireboard"],
                    correct: 1,
                    explanation: "Tinder bundle must be built loosely like a bird's nest to ensure sufficient oxygen flow for sustained burning. Dense packing suffocates developing flame.",
                    difficulty: "medium"
                },
                {
                    question: "In arid terrain you need to find water sources. Which indicator most reliably points to underground water?",
                    options: ["A) Clusters of dark-colored rocks", "B) Broad-leafed vegetation growing in linear patterns", "C) Areas where different soil colors meet", "D) Presence of small animal burrows"],
                    correct: 1,
                    explanation: "Plants with broad, thin leaves require abundant water and often grow in lines following underground watercourses or seepage zones, making them reliable water indicators in desert conditions.",
                    difficulty: "medium"
                },
                {
                    question: "Building a bow drill set but consistently failing to produce an ember. Technique seems right. Which material combination most likely solves the problem?",
                    options: ["A) Harder wood for both spindle and fireboard", "B) Softer wood for spindle, harder for fireboard", "C) Harder wood for spindle, softer for fireboard", "D) Green wood for spindle, dry for fireboard"],
                    correct: 2,
                    explanation: "Optimal friction combination pairs harder wood (spindle) with softer wood (fireboard), creating proper friction without premature wear while generating sufficient heat for ember formation.",
                    difficulty: "medium"
                },
                {
                    question: "In survival situation, found cattails growing in marshy area. Which part of cattail provides highest caloric return for effort?",
                    options: ["A) Fluffy seed heads for direct consumption", "B) Young shoots collected in early spring", "C) Starchy roots/rhizomes dug from underwater", "D) Pollen collected during flowering"],
                    correct: 2,
                    explanation: "Cattail roots contain concentrated starches and provide highest caloric density. They're available year-round, and one collection session can yield substantial nutrition compared to other parts.",
                    difficulty: "easy"
                },
                {
                    question: "Building a solar still for water collection but getting minimal output. Which modification significantly improves water production?",
                    options: ["A) Dig pit deeper to increase soil surface area", "B) Add non-poisonous vegetation to increase moisture content", "C) Use darker colored plastic sheet as covering", "D) Create multiple small stills instead of one large"],
                    correct: 1,
                    explanation: "Adding vegetation dramatically increases moisture content inside still, providing more water vapor for condensation. Even dry vegetation contains extractable moisture that significantly boosts output.",
                    difficulty: "medium"
                },
                {
                    question: "When processing plant fibers for rope, material keeps breaking during twisting. Most effective solution?",
                    options: ["A) Twist fibers tighter to increase strength", "B) Use shorter fiber lengths to reduce stress points", "C) Slightly dampen fibers before working with them", "D) Add more individual fibers to increase bulk"],
                    correct: 2,
                    explanation: "Slightly moist fibers become more pliable and less prone to breaking during twisting process. Completely dry fibers are brittle, while overly wet fibers become weak and stretchy.",
                    difficulty: "medium"
                },
                {
                    question: "Building a lean-to but notice cold air flowing under sleeping area. Which ground insulation strategy provides most effective solution?",
                    options: ["A) Dig shallow depression to get below ground level", "B) Create thick layer of dry leaves with largest ones on bottom", "C) Lay flat rocks to create thermal mass base", "D) Use green pine boughs with needles pointing up"],
                    correct: 1,
                    explanation: "Minimum 6-8 inches of dry leaves with larger leaves as base layer creates effective dead air space insulation. This prevents conductive heat loss to cold ground.",
                    difficulty: "easy"
                },
                {
                    question: "Improvised water filter from sand, charcoal and cloth produces cloudy water with strange taste. Most likely problem with filtration system?",
                    options: ["A) Sand layer too thick, restricting flow", "B) Charcoal not properly prepared from hardwood", "C) Cloth too fine, creating excessive back pressure", "D) Filter materials in wrong order top to bottom"],
                    correct: 1,
                    explanation: "Proper activated charcoal for filtration must be made from hardwood, burned to white ash, then crushed to increase surface area. Poor charcoal preparation reduces both clarity and taste improvement.",
                    difficulty: "medium"
                },
                {
                    question: "In survival situation need to prioritize time and energy. Which project provides greatest 'force multiplication' for survival capabilities?",
                    options: ["A) Building complex water purification system", "B) Creating sharp, durable knife from stone or metal", "C) Constructing elaborate food storage container", "D) Weaving large basket for material collection"],
                    correct: 1,
                    explanation: "Quality cutting tool enables dozens of other survival tasks - shelter building, fire prep, food processing, tool making, and material processing. It multiplies ability to accomplish subsequent projects.",
                    difficulty: "easy"
                },
                {
                    question: "When smoking meat for preservation, fire produces too much heat and insufficient smoke. How to modify setup?",
                    options: ["A) Add green hardwood to increase smoke production", "B) Move meat closer to fire for faster processing", "C) Create longer smoke path between fire and meat", "D) Use only dry hardwood split into small pieces"],
                    correct: 2,
                    explanation: "Longer smoke path allows heat to dissipate while maintaining smoke density. Dakota fire pit method or offset fire pit achieves proper temperature control for preservative smoking.",
                    difficulty: "medium"
                },
                {
                    question: "Identifying edible plants using Universal Edibility Test. At which stage should you immediately stop testing?",
                    options: ["A) When plant creates mild burning on lip", "B) When plant sap leaves temporary stain on skin", "C) When you notice any bitter taste during tongue test", "D) When stomach feels mild upset after 8 hours"],
                    correct: 0,
                    explanation: "Any burning during contact tests indicates potentially harmful compounds. Test should be immediately stopped and plant marked as unsafe for consumption.",
                    difficulty: "easy"
                },
                {
                    question: "Debris hut completed but still experiencing condensation problems inside. Most effective solution?",
                    options: ["A) Add more debris to outer walls for thickness", "B) Create small ventilation gaps at top and bottom", "C) Line interior with large leaves as vapor barrier", "D) Dig drainage channels around shelter perimeter"],
                    correct: 1,
                    explanation: "Controlled ventilation allows moisture to escape while retaining heat. Small gaps at different heights create airflow that prevents condensation buildup without significant heat loss.",
                    difficulty: "medium"
                },
                {
                    question: "When creating deadfall trap, trigger mechanism keeps releasing prematurely. Which adjustment improves reliability?",
                    options: ["A) Make trigger stick longer for more stability", "B) Use heavier weight to increase trigger force", "C) Increase friction surface area between trigger components", "D) Position trigger deeper under crushing weight"],
                    correct: 2,
                    explanation: "Increasing friction between trigger components (through notches, roughening surfaces, or better fitting) creates more resistance to accidental triggering while maintaining sensitivity to intentional animal contact.",
                    difficulty: "medium"
                },
                {
                    question: "Using pine resin for waterproofing containers but it's too brittle when cooled. What to add for improved flexibility?",
                    options: ["A) Small amounts of charcoal powder as filler", "B) Heated animal fat or plant oils", "C) Fine sand to create more workable texture", "D) Additional heating to change resin consistency"],
                    correct: 1,
                    explanation: "Adding heated animal fat or plant oils to pine resin creates more flexible, less brittle sealant when cooled. This mixture maintains waterproofing while allowing material movement.",
                    difficulty: "medium"
                },
                {
                    question: "In cold conditions, fire keeps dying overnight despite using large hardwood logs. Most likely cause?",
                    options: ["A) Insufficient initial fire size to ignite large logs", "B) Logs positioned too far apart, losing mutual heating", "C) Wrong wood species that burns too quickly", "D) Lack of proper kindling gradation for sustained burning"],
                    correct: 1,
                    explanation: "Large logs must be positioned close enough for mutual thermal reinforcement. 'Star fire' configuration allows pushing logs inward as they burn, maintaining this critical distance.",
                    difficulty: "medium"
                },
                {
                    question: "Built simple lever for moving heavy logs for shelter construction. Despite proper positioning, can't generate sufficient force. What most improves leverage?",
                    options: ["A) Find harder, more solid fulcrum material", "B) Increase length of lever arm you're pushing on", "C) Position fulcrum closer to load being moved", "D) Apply force at steeper downward angle"],
                    correct: 2,
                    explanation: "Moving fulcrum closer to load increases mechanical advantage. The closer fulcrum is to load, the greater force multiplication, though this reduces distance load moves.",
                    difficulty: "medium"
                },
                {
                    question: "When preserving meat by salt curing, meat develops bad smell after few days. What was most likely done wrong?",
                    options: ["A) Used too little salt for proper preservation", "B) Storing meat at too high temperature", "C) Didn't remove all excess moisture before curing", "D) Used wrong type of salt for curing"],
                    correct: 1,
                    explanation: "Salt curing requires cool temperatures (below 50°F) to prevent spoilage bacteria growth. Warm temperatures allow harmful bacteria to multiply faster than salt can suppress them.",
                    difficulty: "medium"
                },
                {
                    question: "Natural rope keeps breaking at splice points where adding new material. How to improve splice strength?",
                    options: ["A) Overlap new fibers over greater distance during splicing", "B) Twist splice points tighter than rest", "C) Add new material only when previous section completely dry", "D) Use only thinnest fibers for splicing connections"],
                    correct: 0,
                    explanation: "Longer overlap distances distribute stress across more fiber-to-fiber contact points, preventing failure at splice. Minimum overlap should be 4-6 times individual fiber length.",
                    difficulty: "medium"
                },
                {
                    question: "In long-term survival situation need to make activities sustainable. Which approach best embodies 'energy return on investment' principle?",
                    options: ["A) Building multiple backup systems for each critical function", "B) Creating one high-quality tool that enables many other tasks", "C) Focusing only on immediate needs without long-term planning", "D) Using most complex available solution to ensure reliability"],
                    correct: 1,
                    explanation: "One high-quality, multi-purpose tool that enables multiple subsequent tasks provides best energy return. This 'force multiplier' approach maximizes capabilities gained per calorie invested in creation.",
                    difficulty: "hard"
                }
            ],

            medical: [
                {
                    question: "Leading group on hike when member falls and gets obvious leg fracture 8 miles from trail. Patient conscious, vitals stable, but can't bear weight. Evening approaching and temperature dropping. Your immediate priority?",
                    options: ["A) Splint fracture immediately with available materials", "B) First assess neurovascular status of injured limb", "C) Send fastest hiker ahead to organize evacuation", "D) Create shelter and wait for morning before moving"],
                    correct: 1,
                    explanation: "Assessing neurovascular status (pulse, sensation, movement, color) takes priority before any manipulation or splinting. Fracture with compromised circulation requires immediate intervention, while fracture with intact neurovascular function allows time for proper splinting and planning.",
                    difficulty: "medium"
                },
                {
                    question: "Team member found unconscious after climbing fall. No obvious external bleeding, but breathing 6 breaths/min and irregular. Using ABCDE assessment, what's your next action after ensuring scene safety?",
                    options: ["A) Check for spinal injuries by palpating neck", "B) Open airway with head tilt-chin lift maneuver", "C) Begin chest compressions immediately", "D) Use jaw thrust without head tilt to open airway"],
                    correct: 3,
                    explanation: "With potential head injury and altered consciousness, spinal injury must be assumed. Jaw thrust maneuver opens airway without moving neck, addressing life-threatening respiratory rate while protecting spine.",
                    difficulty: "medium"
                },
                {
                    question: "During winter camping, group member shows confusion, slurred speech, and stopped shivering despite continued cold exposure. Skin pale, and he's clumsily performing simple tasks. What hypothermia stage is he experiencing?",
                    options: ["A) Mild hypothermia - needs warm drinks and shelter", "B) Moderate hypothermia - serious emergency requiring immediate rewarming", "C) Severe hypothermia - shivering stopped indicating core temp below 90°F", "D) Normal cold response - these symptoms expected in cold weather"],
                    correct: 1,
                    explanation: "Combination of confusion, slurred speech, and clumsiness ('umbles') with continued shivering indicates moderate hypothermia. This is serious emergency requiring aggressive rewarming, but presence of shivering means they haven't progressed to severe hypothermia where shivering stops.",
                    difficulty: "medium"
                },
                {
                    question: "Treating deep laceration on forearm that's bleeding heavily. Direct pressure doesn't control bleeding. Next appropriate step in bleeding control algorithm?",
                    options: ["A) Apply tourniquet 2-3 inches above wound", "B) Elevate arm and apply pressure to brachial artery", "C) Pack wound tightly with clean gauze or cloth", "D) Apply ice to wound for vasoconstriction"],
                    correct: 2,
                    explanation: "For deep wounds with heavy bleeding not controlled by direct pressure, wound packing is next step. Wound should be tightly packed from bottom up with gauze, then direct pressure applied over packing. Tourniquets reserved for life-threatening bleeding when other methods fail.",
                    difficulty: "medium"
                },
                {
                    question: "Hiking partner stung by multiple wasps and develops facial swelling, difficulty breathing, and hives on chest. He's conscious but anxious. If epinephrine unavailable, your priority action?",
                    options: ["A) Give antihistamines and monitor closely", "B) Evacuate immediately while keeping them sitting upright", "C) Apply cold compresses to reduce swelling", "D) Lay them flat to improve circulation"],
                    correct: 1,
                    explanation: "This is anaphylaxis - life-threatening emergency. Without epinephrine, immediate evacuation is absolute priority. Keep patient upright to help breathing. While antihistamines may help, evacuation cannot be delayed for their administration.",
                    difficulty: "easy"
                },
                {
                    question: "You suspect team member consumed poisonous mushrooms 18 hours ago. They had initial nausea and vomiting that resolved, but now seem normal. What's most concerning about this picture?",
                    options: ["A) Delayed onset suggests serious neurological toxin", "B) Apparent recovery may be false improvement before liver failure", "C) Vomiting indicates poison was eliminated", "D) 18-hour delay means danger has passed"],
                    correct: 1,
                    explanation: "Classic pattern of amatoxin poisoning (death cap mushrooms) includes initial GI symptoms that resolve, creating false hope during asymptomatic period while liver-destroying toxins work. This is followed by potentially fatal liver failure 3-5 days later, making immediate evacuation critical.",
                    difficulty: "hard"
                },
                {
                    question: "Group encounters someone with suspected venomous snake bite on ankle. Bite occurred 30 minutes ago, progressive swelling to mid-calf, and person reports increasing pain. Best approach?",
                    options: ["A) Apply tourniquet above swelling to prevent venom spread", "B) Make small cuts over fang marks to drain venom", "C) Keep limb still below heart level and evacuate immediately", "D) Apply ice packs to slow venom absorption"],
                    correct: 2,
                    explanation: "Modern snakebite management focuses on immobilization below heart level to slow venom circulation and immediate evacuation. Tourniquets, cutting/suction, and ice are all contraindicated as they increase tissue damage without removing significant venom.",
                    difficulty: "medium"
                },
                {
                    question: "During winter expedition need to create improvised shelter for injured team member showing early hypothermia signs. Which principle most important for effective cold protection?",
                    options: ["A) Maximize wind protection above all other factors", "B) Create multiple insulation layers with air spaces between them", "C) Use reflective materials to bounce heat back to body", "D) Ensure shelter is maximum size for comfort"],
                    correct: 1,
                    explanation: "Effective insulation depends on trapping still air in layers. Multiple layers with air spaces provide superior insulation compared to single thick layers. While wind protection is important, proper insulation is foundation of heat retention.",
                    difficulty: "medium"
                },
                {
                    question: "Managing multiple casualties after rockfall. Using triage principles, which patient should receive immediate attention?",
                    options: ["A) Unconscious person with weak pulse and slow breathing", "B) Conscious person with obvious open leg fracture and controlled bleeding", "C) Walking person complaining of severe back pain", "D) Conscious person with rapid breathing and uncontrolled arm bleeding"],
                    correct: 3,
                    explanation: "In triage, 'Immediate' category patients have life-threatening injuries that are salvageable with intervention. Uncontrolled bleeding is immediately life-threatening but treatable. Unconscious person may be too severe (expectant category), while walking wounded and controlled bleeding have lower priority.",
                    difficulty: "hard"
                },
                {
                    question: "Team member falls into cold water (45°F) wearing heavy clothing. They manage to grab boat but can't climb in. What's most critical danger in first 3 minutes?",
                    options: ["A) Rapid onset of hypothermia", "B) Initial cold shock response causing drowning", "C) Clothing becoming waterlogged and pulling them under", "D) Panic leading to poor decision making"],
                    correct: 1,
                    explanation: "Initial cold shock response (0-3 minutes) causes involuntary gasping and hyperventilation, creating highest drowning risk. If this critical period is survived, there's meaningful time before hypothermia becomes life-threatening, even in very cold water.",
                    difficulty: "medium"
                },
                {
                    question: "Treating second-degree burn on hand from camping accident. After cooling with water, which improvised treatment shows best evidence for promoting healing?",
                    options: ["A) Apply oil or cooking fat to moisturize burn", "B) Pop any blisters to prevent infection", "C) Apply raw honey if available and cover with clean cloth", "D) Rub snow on burn to continue cooling"],
                    correct: 2,
                    explanation: "Raw honey has proven antimicrobial properties and creates moist healing environment. It's one of few natural remedies with clinical evidence for burn treatment. Oil/fat retains heat, popping blisters increases infection risk, and continued cooling with snow can cause cold injury.",
                    difficulty: "easy"
                },
                {
                    question: "During multi-day wilderness medical emergency, managing someone with infected wound showing infection signs. Antibiotic supply limited. Which approach best balances treatment with resource conservation?",
                    options: ["A) Use full standard antibiotic course immediately", "B) Give half doses to make supplies last longer", "C) Wait until infection becomes severe before starting antibiotics", "D) Use antibiotics 3 days, then reassess before continuing"],
                    correct: 0,
                    explanation: "Incomplete antibiotic courses risk creating resistant bacteria and treatment failure. While resource conservation important, proper antibiotic use with clear indications maximizes effectiveness. Half doses or shortened courses often fail to clear infections.",
                    difficulty: "hard"
                },
                {
                    question: "Team member reports severe abdominal pain that started around navel and now moved to right lower abdomen. They have fever and refuse to walk due to pain. You're 2 days from evacuation. Primary concern?",
                    options: ["A) Food poisoning from contaminated water", "B) Appendicitis requiring immediate evacuation attempt", "C) Kidney stones that will pass naturally", "D) Muscle strain from carrying heavy pack"],
                    correct: 1,
                    explanation: "Classic appendicitis presentation (periumbilical pain migrating to right lower quadrant with fever and inability to walk) requires immediate evacuation. Appendix can rupture within 48-72 hours, dramatically increasing mortality without surgical intervention.",
                    difficulty: "medium"
                },
                {
                    question: "When crossing fast stream, team member falls and appears to have shoulder dislocation. Arm in abnormal position and they can't move it. Evacuation timeline uncertain. Best approach?",
                    options: ["A) Attempt immediate reduction using gentle traction", "B) Immobilize in position found and arrange evacuation", "C) Give pain medication then attempt reduction", "D) Attempt reduction only if you have previous medical training"],
                    correct: 1,
                    explanation: "Without proper training and in uncertain evacuation circumstances, attempting joint reduction risks serious neurovascular damage. Immobilization in position found with rapid evacuation is safest. Pain control while maintaining immobilization appropriate.",
                    difficulty: "medium"
                },
                {
                    question: "Leading group through hot desert terrain when someone develops hot, dry skin, confusion, and rapid pulse. Their core temperature feels extremely elevated. Immediate priority?",
                    options: ["A) Give them cold water to drink immediately", "B) Move them to shade and begin aggressive cooling measures", "C) Continue slow hiking to reach help faster", "D) Give salt tablets to replace lost electrolytes"],
                    correct: 1,
                    explanation: "This is heat stroke - true medical emergency with high mortality. Aggressive cooling takes absolute priority over everything else, including evacuation preparation. Every minute of core temperature above 105°F increases organ damage risk.",
                    difficulty: "easy"
                },
                {
                    question: "Team member stepped on nail that penetrated through their boot. Nail went completely through sole into their foot. Nail no longer in wound. Primary concern with this injury?",
                    options: ["A) Stopping bleeding which is likely severe", "B) High infection risk from deep tissue inoculation", "C) Tetanus infection from rusty metal", "D) Possible broken bones in foot"],
                    correct: 1,
                    explanation: "Puncture wounds, especially through footwear, carry extremely high infection risk due to deep tissue inoculation with bacteria. Wound looks minor externally but creates perfect conditions for anaerobic infections. Bleeding usually minimal with puncture wounds.",
                    difficulty: "medium"
                },
                {
                    question: "When treating fracture in wilderness need to improvise splint. Which principle most important for effective splinting?",
                    options: ["A) Make splint as tight as possible to prevent movement", "B) Immobilize joints above and below fracture site", "C) Use only rigid materials for proper support", "D) Extend splint past fingers or toes"],
                    correct: 1,
                    explanation: "Effective splinting requires immobilizing joints above and below fracture to prevent movement at injury site. This principle applies regardless of materials used. Over-tightening can compromise circulation, and soft materials can be effective when properly applied.",
                    difficulty: "easy"
                },
                {
                    question: "Group caught in severe weather and must shelter for extended time. One member showing mild hypothermia symptoms. Which rewarming method most appropriate for field conditions?",
                    options: ["A) Place them directly by fire for rapid warming", "B) Give them alcohol for vasodilation and warmth", "C) Use skin-to-skin contact in shared sleeping system", "D) Make them exercise vigorously to generate heat"],
                    correct: 2,
                    explanation: "For mild hypothermia, gradual rewarming with shared body heat is safe and effective. Direct heat sources risk burns due to impaired sensation, alcohol accelerates heat loss, and vigorous exercise can worsen hypothermia by shunting warm blood to extremities.",
                    difficulty: "medium"
                },
                {
                    question: "Encounter unconscious person who appears to have no pulse or breathing. They're cold to touch and skin is blue-gray. In wilderness conditions, what should guide decision about starting CPR?",
                    options: ["A) Begin CPR immediately - time is critical", "B) Don't start CPR - they're obviously dead", "C) Check for signs of life up to 60 seconds before deciding", "D) Warm them first, then reassess for signs of life"],
                    correct: 2,
                    explanation: "In hypothermic patients, pulse and breathing may be so slow as undetectable. The saying applies: 'no one is dead until warm and dead.' Check for signs of life up to 60 seconds, as severely hypothermic patients have survived without detectable vital signs.",
                    difficulty: "hard"
                },
                {
                    question: "Team member reports tick bite 2 days ago. Tick was properly removed but now there's expanding red rash around bite site with clear center, resembling 'bull's eye' pattern. Primary concern?",
                    options: ["A) Local allergic reaction to tick bite", "B) Possible Lyme disease requiring antibiotic treatment", "C) Normal healing response to tick saliva", "D) Secondary bacterial infection from scratching"],
                    correct: 1,
                    explanation: "Expanding 'bull's eye' rash (erythema migrans) is pathognomonic for early Lyme disease. Early antibiotic treatment is highly effective, while delayed treatment can lead to serious complications including cardiac and neurological problems.",
                    difficulty: "easy"
                }
            ]
        };

        let currentQuiz = null;
        let currentQuestionIndex = 0;
        let selectedAnswer = null;
        let score = 0;
        let answeredQuestions = [];

        function startQuiz(quizType) {
            currentQuiz = [];
            currentQuestionIndex = 0;
            score = 0;
            answeredQuestions = [];
            
            // Collect questions based on type
            if (quizType === 'all') {
                currentQuiz = [...questionsData.basic, ...questionsData.offgrid, ...questionsData.medical];
                document.getElementById('quizTitle').textContent = 'Complete Preparedness Assessment';
            } else if (quizType === 'basic') {
                currentQuiz = [...questionsData.basic];
                document.getElementById('quizTitle').textContent = 'Basic Survival Skills';
            } else if (quizType === 'offgrid') {
                currentQuiz = [...questionsData.offgrid];
                document.getElementById('quizTitle').textContent = 'Life Without Electricity';
            } else if (quizType === 'medical') {
                currentQuiz = [...questionsData.medical];
                document.getElementById('quizTitle').textContent = 'Wilderness Medicine';
            }

            // Shuffle questions
            shuffleArray(currentQuiz);
            
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'block';
            document.getElementById('resultsContainer').style.display = 'none';
            
            showQuestion();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function showQuestion() {
            if (currentQuestionIndex >= currentQuiz.length) {
                showResults();
                return;
            }

            const question = currentQuiz[currentQuestionIndex];
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('questionCounter').textContent = `${currentQuestionIndex + 1}/${currentQuiz.length}`;
            
            const progressPercent = ((currentQuestionIndex) / currentQuiz.length) * 100;
            document.getElementById('progressBar').style.width = progressPercent + '%';

            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionDiv);
            });

            document.getElementById('explanation').style.display = 'none';
            document.getElementById('nextButton').disabled = true;
            selectedAnswer = null;
        }

        function selectOption(index) {
            selectedAnswer = index;
            
            const options = document.querySelectorAll('.option');
            options.forEach(option => option.classList.remove('selected'));
            options[index].classList.add('selected');
            
            document.getElementById('nextButton').disabled = false;
        }

        function nextQuestion() {
            const question = currentQuiz[currentQuestionIndex];
            const isCorrect = selectedAnswer === question.correct;
            
            if (isCorrect) {
                score++;
            }

            answeredQuestions.push({
                question: question.question,
                selectedAnswer: selectedAnswer,
                correctAnswer: question.correct,
                isCorrect: isCorrect,
                explanation: question.explanation,
                difficulty: question.difficulty
            });

            // Show correct answer
            const options = document.querySelectorAll('.option');
            options.forEach((option, index) => {
                if (index === question.correct) {
                    option.classList.add('correct');
                } else if (index === selectedAnswer && !isCorrect) {
                    option.classList.add('incorrect');
                }
                option.onclick = null; // Disable clicks
            });

            // Show explanation
            const explanationDiv = document.getElementById('explanation');
            explanationDiv.innerHTML = `
                <h4>${isCorrect ? '✅ Correct!' : '❌ Incorrect'}</h4>
                <p>${question.explanation}</p>
            `;
            explanationDiv.style.display = 'block';

            // Change button
            const nextButton = document.getElementById('nextButton');
            nextButton.textContent = currentQuestionIndex === currentQuiz.length - 1 ? 'Finish Test' : 'Next Question';
            nextButton.onclick = () => {
                currentQuestionIndex++;
                nextButton.textContent = 'Next';
                nextButton.onclick = nextQuestion;
                showQuestion();
            };
        }

        function showResults() {
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'block';

            const percentage = Math.round((score / currentQuiz.length) * 100);
            document.getElementById('scoreText').textContent = `${score}/${currentQuiz.length}`;

            const scoreCircle = document.getElementById('scoreCircle');
            const resultTitle = document.getElementById('resultTitle');
            const resultDescription = document.getElementById('resultDescription');

            if (percentage >= 90) {
                scoreCircle.className = 'score-circle score-excellent';
                resultTitle.textContent = 'Excellent Preparedness! 🏆';
                resultDescription.textContent = 'You have outstanding survival knowledge. You\'re ready for most extreme situations.';
            } else if (percentage >= 70) {
                scoreCircle.className = 'score-circle score-good';
                resultTitle.textContent = 'Good Preparedness 👍';
                resultDescription.textContent = 'Your knowledge is at a good level, but there are areas for improvement. Continue studying and practicing.';
            } else if (percentage >= 50) {
                scoreCircle.className = 'score-circle score-basic';
                resultTitle.textContent = 'Basic Knowledge ⚠️';
                resultDescription.textContent = 'You have the basics, but need to seriously improve preparation. We recommend studying books and taking training.';
            } else {
                scoreCircle.className = 'score-circle score-critical';
                resultTitle.textContent = 'Critical Gap! 🚨';
                resultDescription.textContent = 'Your knowledge is insufficient for safety. You urgently need to study survival basics.';
            }

            // Calculate category-specific scores for recommendations
            const categoryScores = calculateCategoryScores();
            
            // Add detailed statistics
            const difficultyStats = answeredQuestions.reduce((acc, q) => {
                if (!acc[q.difficulty]) acc[q.difficulty] = { correct: 0, total: 0 };
                acc[q.difficulty].total++;
                if (q.isCorrect) acc[q.difficulty].correct++;
                return acc;
            }, {});

            let statsHtml = '<div style="margin-top: 20px; text-align: left; background: #f8f9fa; padding: 20px; border-radius: 12px; border-left: 4px solid #7dae42;"><h3 style="color: #2d5016; margin-bottom: 16px;">Detailed Statistics:</h3>';
            
            Object.keys(difficultyStats).forEach(difficulty => {
                const stats = difficultyStats[difficulty];
                const percent = Math.round((stats.correct / stats.total) * 100);
                const difficultyNames = {
                    'easy': 'Easy',
                    'medium': 'Medium', 
                    'intermediate': 'Medium',
                    'hard': 'Hard',
                    'complex': 'Hard'
                };
                
                const color = percent >= 70 ? '#28a745' : percent >= 50 ? '#ffc107' : '#dc3545';
                statsHtml += `<p style="margin: 8px 0; color: #333;"><strong>${difficultyNames[difficulty] || difficulty}:</strong> <span style="color: ${color}; font-weight: bold;">${stats.correct}/${stats.total} (${percent}%)</span></p>`;
            });
            
            statsHtml += '</div>';
            
            // Add book recommendations
            const recommendations = generateBookRecommendations(percentage, categoryScores);
            statsHtml += recommendations;
            
            resultDescription.innerHTML += statsHtml;
        }

        function calculateCategoryScores() {
            // Get original question data to categorize answers
            const basicQuestions = questionsData.basic;
            const offgridQuestions = questionsData.offgrid;
            const medicalQuestions = questionsData.medical;
            
            const scores = {
                basic: { correct: 0, total: 0 },
                offgrid: { correct: 0, total: 0 },
                medical: { correct: 0, total: 0 }
            };
            
            answeredQuestions.forEach(answer => {
                // Find which category this question belongs to
                const questionText = answer.question;
                
                if (basicQuestions.some(q => q.question === questionText)) {
                    scores.basic.total++;
                    if (answer.isCorrect) scores.basic.correct++;
                } else if (offgridQuestions.some(q => q.question === questionText)) {
                    scores.offgrid.total++;
                    if (answer.isCorrect) scores.offgrid.correct++;
                } else if (medicalQuestions.some(q => q.question === questionText)) {
                    scores.medical.total++;
                    if (answer.isCorrect) scores.medical.correct++;
                }
            });
            
            return scores;
        }

        function generateBookRecommendations(overallPercentage, categoryScores) {
            let recommendationsHtml = '<div style="margin-top: 24px; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 12px; border: 2px solid #7dae42;">';
            
            // Perfect score - recommend author exploration
            if (overallPercentage === 100) {
                recommendationsHtml += `
                    <h3 style="color: #2d5016; margin-bottom: 16px; text-align: center;">🎯 Master Level Achieved!</h3>
                    <p style="color: #333; margin-bottom: 16px; text-align: center;">You've mastered all survival fundamentals! Ready to explore advanced topics?</p>
                    <div style="text-align: center;">
                        <button onclick="window.open('AUTHOR_LINK_PLACEHOLDER', '_blank')" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer; margin: 8px;">
                            📚 Explore More Books by Caleb North
                        </button>
                    </div>
                `;
            }
            // Excellent performance (90-99%) - recommend all books or specific areas
            else if (overallPercentage >= 90) {
                const weakestAreas = findWeakestAreas(categoryScores);
                recommendationsHtml += `
                    <h3 style="color: #2d5016; margin-bottom: 16px;">📖 Recommended Reading for Excellence</h3>
                    <p style="color: #333; margin-bottom: 16px;">You're almost there! Focus on these areas to reach mastery:</p>
                `;
                recommendationsHtml += generateSpecificBookRecommendations(weakestAreas);
            }
            // Good performance (70-89%) - recommend books based on weak areas
            else if (overallPercentage >= 70) {
                const weakestAreas = findWeakestAreas(categoryScores);
                recommendationsHtml += `
                    <h3 style="color: #2d5016; margin-bottom: 16px;">📚 Strengthen Your Knowledge</h3>
                    <p style="color: #333; margin-bottom: 16px;">Good foundation! These books will help you improve in key areas:</p>
                `;
                recommendationsHtml += generateSpecificBookRecommendations(weakestAreas);
            }
            // Basic or Critical - recommend comprehensive approach
            else {
                recommendationsHtml += `
                    <h3 style="color: #2d5016; margin-bottom: 16px;">🎯 Essential Learning Path</h3>
                    <p style="color: #333; margin-bottom: 20px;">Start with the fundamentals and build comprehensive survival skills:</p>
                    
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <div style="display: flex; gap: 20px; align-items: center;">
                            <div style="flex-shrink: 0;">
                                <img src="./images/basic-survival-cover.jpg" alt="Basic Survival Skills Book" style="width: 120px; height: 160px; object-fit: cover; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                            </div>
                            <div style="flex: 1;">
                                <h4 style="color: #2d5016; margin-bottom: 12px; font-size: 1.2rem;">🎒 Start Here: Basic Survival Skills</h4>
                                <p style="color: #666; margin-bottom: 16px; line-height: 1.5;">Perfect foundation for beginners. Master the essential mindset, first aid, communication, and fitness fundamentals.</p>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <button onclick="window.open('BASIC_BOOK_LINK_PLACEHOLDER', '_blank')" style="background: linear-gradient(135deg, #7dae42, #5d8234); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer;">
                                        📖 Get This Book
                                    </button>
                                    <span style="color: #28a745; font-weight: bold; font-size: 1.1rem;">$19.99</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%); border-radius: 12px; border: 2px solid #17a2b8;">
                        <h4 style="color: #2d5016; margin-bottom: 16px;">💡 Pro Tip: Complete Survival Mastery</h4>
                        <div style="display: flex; justify-content: center; gap: 16px; margin-bottom: 16px;">
                            <img src="./images/basic-survival-cover.jpg" alt="Basic Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                            <img src="./images/offgrid-survival-cover.jpg" alt="Off-Grid Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                            <img src="./images/medical-survival-cover.jpg" alt="Medical Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                        </div>
                        <p style="color: #666; margin-bottom: 16px;">Get all three books for complete survival knowledge!</p>
                        <button onclick="window.open('ALL_BOOKS_LINK_PLACEHOLDER', '_blank')" style="background: linear-gradient(135deg, #17a2b8, #007bff); color: white; border: none; padding: 16px 32px; border-radius: 8px; font-size: 1.1rem; cursor: pointer; box-shadow: 0 4px 16px rgba(23, 162, 184, 0.3);">
                            📚 Get Complete Collection
                        </button>
                    </div>
                `;
            }
            
            recommendationsHtml += '</div>';
            return recommendationsHtml;
        }

        function findWeakestAreas(categoryScores) {
            const areas = [];
            
            Object.keys(categoryScores).forEach(category => {
                const score = categoryScores[category];
                if (score.total > 0) {
                    const percentage = (score.correct / score.total) * 100;
                    areas.push({
                        category: category,
                        percentage: percentage,
                        score: score
                    });
                }
            });
            
            // Sort by percentage (worst first)
            areas.sort((a, b) => a.percentage - b.percentage);
            return areas;
        }

        function generateSpecificBookRecommendations(areas) {
            let html = '';
            
            areas.forEach((area, index) => {
                const bookInfo = getBookInfo(area.category);
                const percentage = Math.round(area.percentage);
                const color = percentage < 50 ? '#dc3545' : percentage < 70 ? '#ffc107' : '#28a745';
                
                html += `
                    <div style="margin-bottom: 20px; padding: 20px; background: white; border-radius: 12px; border-left: 4px solid ${color}; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <div style="display: flex; gap: 20px; align-items: flex-start;">
                            <div style="flex-shrink: 0;">
                                <img src="${bookInfo.coverImage}" alt="${bookInfo.title}" style="width: 120px; height: 160px; object-fit: cover; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                            </div>
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                    <h4 style="color: #2d5016; margin: 0; font-size: 1.2rem;">${bookInfo.emoji} ${bookInfo.title}</h4>
                                    <span style="color: ${color}; font-weight: bold; font-size: 1.1rem; background: ${color}20; padding: 4px 12px; border-radius: 20px;">${area.score.correct}/${area.score.total} (${percentage}%)</span>
                                </div>
                                <p style="color: #666; margin-bottom: 16px; font-size: 0.95rem; line-height: 1.5;">${bookInfo.description}</p>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <button onclick="window.open('${bookInfo.link}', '_blank')" style="background: linear-gradient(135deg, #7dae42, #5d8234); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; flex: 1; max-width: 200px;">
                                        📖 Get This Book
                                    </button>
                                    <span style="color: #28a745; font-weight: bold; font-size: 1.1rem;">${bookInfo.price}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            // Add bundle option if multiple books recommended
            if (areas.length > 1) {
                html += `
                    <div style="margin-top: 24px; padding: 24px; background: linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%); border-radius: 12px; border: 2px solid #17a2b8; text-align: center;">
                        <h4 style="color: #2d5016; margin-bottom: 16px;">📚 Complete Your Knowledge</h4>
                        <div style="display: flex; justify-content: center; gap: 16px; margin-bottom: 16px;">
                            <img src="./images/basic-survival-cover.jpg" alt="Basic Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                            <img src="./images/offgrid-survival-cover.jpg" alt="Off-Grid Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                            <img src="./images/medical-survival-cover.jpg" alt="Medical Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                        </div>
                        <p style="color: #666; margin-bottom: 16px;">Get all three books for complete survival knowledge across all scenarios!</p>
                        <button onclick="window.open('ALL_BOOKS_LINK_PLACEHOLDER', '_blank')" style="background: linear-gradient(135deg, #17a2b8, #007bff); color: white; border: none; padding: 16px 32px; border-radius: 8px; font-size: 1.1rem; cursor: pointer; box-shadow: 0 4px 16px rgba(23, 162, 184, 0.3);">
                            📚 Get Complete Collection
                        </button>
                    </div>
                `;
            }
            
            return html;
        }

        function getBookInfo(category) {
            const books = {
                basic: {
                    emoji: '🎒',
                    title: 'Basic Survival Skills',
                    shortTitle: 'Basic Survival Skills Book',
                    description: 'Master the fundamentals: mindset, first aid, communication, and physical preparedness for any emergency situation.',
                    link: 'BASIC_BOOK_LINK_PLACEHOLDER',
                    coverImage: './images/basic-survival-cover.jpg',
                    price: '$19.99'
                },
                offgrid: {
                    emoji: '🔥',
                    title: 'Off-Grid Survival',
                    shortTitle: 'Live Free Off The Grid',
                    description: 'Learn practical skills for living without electricity: shelter building, fire making, water purification, and food procurement.',
                    link: 'OFFGRID_BOOK_LINK_PLACEHOLDER',
                    coverImage: './images/offgrid-survival-cover.jpg',
                    price: '$22.99'
                },
                medical: {
                    emoji: '🏥',
                    title: 'Wilderness Medicine',
                    shortTitle: 'Off-Grid Medicine Handbook',
                    description: 'Essential first aid and medical skills for extreme conditions without hospitals or modern medical facilities.',
                    link: 'MEDICAL_BOOK_LINK_PLACEHOLDER',
                    coverImage: './images/medical-survival-cover.jpg',
                    price: '$24.99'
                }
            };
            
            return books[category] || books.basic;
        }

        function showMainMenu() {
            document.getElementById('mainMenu').style.display = 'grid';
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'none';
        }

        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'survival-quiz-v1';
                    const urlsToCache = ['/'];
                    
                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                        );
                    });
                    
                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => response || fetch(event.request))
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            });
        }
    </script>
</body>
</html>,
                flag: '🇨🇦',
                name: 'Canada'
            },
            au: {
                currency: 'AUD 
        const questionsData = {
            basic: [
                {
                    question: "You're preparing an emergency kit and can only take one item. What would you choose for maximum functionality?",
                    options: ["A) Swiss knife with 15 tools", "B) Simple bandana", "C) Waterproof flashlight", "D) Portable charger"],
                    correct: 1,
                    explanation: "A bandana can serve as a bandage, tourniquet, water filter, signal flag, sun protection, fire starter material, and dozens of other functions.",
                    difficulty: "easy"
                },
                {
                    question: "A teammate has an open fracture with bright red pulsating blood. Direct pressure on the wound doesn't stop the bleeding. What's next?",
                    options: ["A) Apply a tourniquet above the wound", "B) Elevate the arm and continue pressure", "C) Find the pulse point on the arm and compress the artery", "D) Clean the wound and apply a tight bandage"],
                    correct: 2,
                    explanation: "For arterial bleeding when direct pressure is ineffective, the next step is compressing the feeding artery at the pulse point between the bicep and tricep.",
                    difficulty: "intermediate"
                },
                {
                    question: "How do you test readiness for a long hike with a backpack in extreme conditions?",
                    options: ["A) Run 5 km without a backpack", "B) Walk 3 miles with a backpack weighing 15% of your body weight", "C) Lift the backpack overhead 20 times", "D) Stand with the backpack for 30 minutes"],
                    correct: 1,
                    explanation: "The test with a backpack weighing 15% of body weight over 3 miles reveals real readiness for long hikes and identifies weaknesses in endurance.",
                    difficulty: "easy"
                },
                {
                    question: "You're lost and starting to panic. Heart beating fast, breathing rapid. Which technique quickly restores control?",
                    options: ["A) Hold breath for a minute", "B) Breathe using the pattern: 4 seconds in - 4 hold - 4 out - 4 hold", "C) Breathe as fast as possible for 30 seconds", "D) Lie down and relax"],
                    correct: 1,
                    explanation: "Tactical breathing 4-4-4-4 activates the parasympathetic nervous system and quickly reduces stress levels, restoring decision-making ability.",
                    difficulty: "easy"
                },
                {
                    question: "You have paracord. Why is it especially valuable in survival situations?",
                    options: ["A) Only because of high strength", "B) Waterproof coating", "C) Inner threads can be used separately for fishing and sewing", "D) Glows in the dark"],
                    correct: 2,
                    explanation: "Paracord contains inner fibers that can be used separately as fishing line, sewing thread, thin cord - multiplying functionality.",
                    difficulty: "intermediate"
                },
                {
                    question: "In critical situations, the brain narrows perception and impairs memory. How does this affect decision-making?",
                    options: ["A) Decisions become faster and more accurate", "B) Doesn't affect decision quality", "C) Decision quality drops sharply due to tunnel vision", "D) Superhuman analytical abilities appear"],
                    correct: 2,
                    explanation: "Stress causes tunnel vision, working memory disruption, and reversion to primitive reactions, seriously reducing decision quality.",
                    difficulty: "intermediate"
                },
                {
                    question: "A teammate is panicking and breathing fast and shallow. Which breathing technique would you recommend?",
                    options: ["A) 3-3-3-3 (in-hold-out-hold)", "B) 4-4-4-4 (in-hold-out-hold)", "C) 5-5-5-5 (in-hold-out-hold)", "D) Breathe into a bag"],
                    correct: 1,
                    explanation: "Tactical breathing using the 4-4-4-4 pattern (inhale 4 sec, hold 4 sec, exhale 4 sec, hold 4 sec) effectively restores control during panic.",
                    difficulty: "easy"
                },
                {
                    question: "What's the key principle of everyday carry (EDC) emergency items philosophy?",
                    options: ["A) Carry maximum useful items", "B) Only the most expensive items", "C) Items you actually carry every day", "D) Only military gear"],
                    correct: 2,
                    explanation: "The principle of constancy - true EDC includes only what you carry constantly. An item left at home due to inconvenience is useless in an emergency.",
                    difficulty: "intermediate"
                },
                {
                    question: "An earthquake starts while you're indoors. What are the correct actions?",
                    options: ["A) Run to the exit", "B) Stand in a doorway", "C) Drop, take cover under a table, hold on", "D) Jump out the window"],
                    correct: 2,
                    explanation: "Modern recommendation - 'Drop, Cover, Hold' - drop to knees, take cover under a sturdy table, protect head. Doorways in modern buildings don't provide special protection.",
                    difficulty: "intermediate"
                },
                {
                    question: "When planning family emergency communication, why do you need a contact in another city?",
                    options: ["A) To contact authorities", "B) Local communication works, distant doesn't", "C) Long-distance communication often works when local is disrupted", "D) It's a legal requirement"],
                    correct: 2,
                    explanation: "During local disasters, long-distance communication lines often remain operational when local towers and cables are damaged. The remote contact becomes a family information center.",
                    difficulty: "intermediate"
                },
                {
                    question: "You see signs of danger but think 'this can't be serious, everything will be fine.' What psychological trap is this?",
                    options: ["A) Panic attack", "B) Normalcy bias - underestimating threats", "C) Depression", "D) Excessive anxiety"],
                    correct: 1,
                    explanation: "Normalcy bias causes people to minimize threat severity and assume normal conditions will continue even with obvious danger signs. This leads to dangerous response delays.",
                    difficulty: "complex"
                },
                {
                    question: "How do you train multiple ways to perform critical survival tasks?",
                    options: ["A) Learn one method perfectly", "B) Practice primary tool, alternative method, and improvisation without tools", "C) Collect maximum tools", "D) Rely on intuition"],
                    correct: 1,
                    explanation: "'Tool triangulation' - practicing key tasks three ways: primary tool, alternative method, and improvisation without tools creates reliability.",
                    difficulty: "complex"
                },
                {
                    question: "A teammate got burned with boiling water. What should NOT be done?",
                    options: ["A) Cool with cold water", "B) Cover with clean cloth", "C) Apply oil or grease", "D) Give pain medication"],
                    correct: 2,
                    explanation: "Oil and greasy substances retain heat in tissues and worsen damage while creating perfect conditions for infection. This is an outdated and dangerous method.",
                    difficulty: "easy"
                },
                {
                    question: "What does the 'Turn Around, Don't Drown' rule mean during floods?",
                    options: ["A) Turn your back to water", "B) Never enter moving water", "C) Don't turn the car in water", "D) Only swim on your back"],
                    correct: 1,
                    explanation: "Just 6 inches of moving water can knock down an adult, and 12 inches can carry away a car. Better to turn around and find another route than risk life.",
                    difficulty: "intermediate"
                },
                {
                    question: "After many hours of decision-making in crisis, your decision quality deteriorates. What is this?",
                    options: ["A) Panic", "B) Decision fatigue - cognitive resource depletion", "C) Depression", "D) Loss of concentration"],
                    correct: 1,
                    explanation: "Decision fatigue occurs when cognitive resources are depleted after multiple choices. Decision quality drops even while maintaining physical strength.",
                    difficulty: "complex"
                },
                {
                    question: "Why is a metal container better than plastic for survival?",
                    options: ["A) It's lighter", "B) Can cook on fire and boil water", "C) More visible to rescuers", "D) Doesn't crack in cold"],
                    correct: 1,
                    explanation: "A metal container can be placed directly on fire for cooking and boiling water for disinfection - these are critically important survival functions.",
                    difficulty: "intermediate"
                },
                {
                    question: "How do you properly signal distress with sound or light?",
                    options: ["A) 3 short - 3 long - 3 short", "B) 3 long - 3 short - 3 long", "C) Continuous signal", "D) 5 short signals"],
                    correct: 0,
                    explanation: "SOS in Morse code: 3 short signals, 3 long, 3 short. This is the international distress signal recognized worldwide.",
                    difficulty: "easy"
                },
                {
                    question: "You've already walked 10 km on the wrong route but continue, thinking 'can't waste the distance covered.' What error is this?",
                    options: ["A) Correct strategy", "B) Sunk cost fallacy - continuing due to already invested resources", "C) Excessive caution", "D) Good planning"],
                    correct: 1,
                    explanation: "Sunk cost fallacy makes people continue ineffective actions due to already invested resources instead of evaluating prospects. In survival, this can be deadly.",
                    difficulty: "complex"
                },
                {
                    question: "Which natural object works best as exercise equipment for balance and strength?",
                    options: ["A) Only large rocks", "B) Fallen logs of different diameters", "C) Only water bodies", "D) Sand dunes"],
                    correct: 1,
                    explanation: "Fallen logs are ideal for balance training (log walking), jumping and climbing, developing skills for movement over complex terrain.",
                    difficulty: "intermediate"
                },
                {
                    question: "What is the foundation of all survival skills?",
                    options: ["A) Physical strength", "B) Expensive gear", "C) Technical knowledge", "D) Psychological resilience"],
                    correct: 3,
                    explanation: "The most sophisticated gear cannot save someone whose mind has already given up. Psychological resilience determines whether knowledge and skills will be applied or the person will surrender.",
                    difficulty: "easy"
                }
            ],
            
            offgrid: [
                {
                    question: "Lost in the forest and need urgent shelter, having only a knife and rope. Which construction gives basic protection with minimal time investment?",
                    options: ["A) Fully built A-frame with complete insulation", "B) Debris hut using a fallen tree as ridgepole", "C) Excavated earth shelter with wooden roof", "D) Teepee from bent saplings"],
                    correct: 1,
                    explanation: "A debris hut uses existing natural elements (fallen tree) as structural foundation, requires minimal time for frame construction and can be quickly insulated with available forest debris.",
                    difficulty: "easy"
                },
                {
                    question: "When using a hand drill for fire, tinder catches but flame quickly dies. Most likely cause?",
                    options: ["A) Insufficient downward pressure on spindle", "B) Tinder packed too tightly without sufficient airflow", "C) Fireboard wood too wet for proper friction", "D) Wrong angle of notch in fireboard"],
                    correct: 1,
                    explanation: "Tinder bundle must be built loosely like a bird's nest to ensure sufficient oxygen flow for sustained burning. Dense packing suffocates developing flame.",
                    difficulty: "medium"
                },
                {
                    question: "In arid terrain you need to find water sources. Which indicator most reliably points to underground water?",
                    options: ["A) Clusters of dark-colored rocks", "B) Broad-leafed vegetation growing in linear patterns", "C) Areas where different soil colors meet", "D) Presence of small animal burrows"],
                    correct: 1,
                    explanation: "Plants with broad, thin leaves require abundant water and often grow in lines following underground watercourses or seepage zones, making them reliable water indicators in desert conditions.",
                    difficulty: "medium"
                },
                {
                    question: "Building a bow drill set but consistently failing to produce an ember. Technique seems right. Which material combination most likely solves the problem?",
                    options: ["A) Harder wood for both spindle and fireboard", "B) Softer wood for spindle, harder for fireboard", "C) Harder wood for spindle, softer for fireboard", "D) Green wood for spindle, dry for fireboard"],
                    correct: 2,
                    explanation: "Optimal friction combination pairs harder wood (spindle) with softer wood (fireboard), creating proper friction without premature wear while generating sufficient heat for ember formation.",
                    difficulty: "medium"
                },
                {
                    question: "In survival situation, found cattails growing in marshy area. Which part of cattail provides highest caloric return for effort?",
                    options: ["A) Fluffy seed heads for direct consumption", "B) Young shoots collected in early spring", "C) Starchy roots/rhizomes dug from underwater", "D) Pollen collected during flowering"],
                    correct: 2,
                    explanation: "Cattail roots contain concentrated starches and provide highest caloric density. They're available year-round, and one collection session can yield substantial nutrition compared to other parts.",
                    difficulty: "easy"
                },
                {
                    question: "Building a solar still for water collection but getting minimal output. Which modification significantly improves water production?",
                    options: ["A) Dig pit deeper to increase soil surface area", "B) Add non-poisonous vegetation to increase moisture content", "C) Use darker colored plastic sheet as covering", "D) Create multiple small stills instead of one large"],
                    correct: 1,
                    explanation: "Adding vegetation dramatically increases moisture content inside still, providing more water vapor for condensation. Even dry vegetation contains extractable moisture that significantly boosts output.",
                    difficulty: "medium"
                },
                {
                    question: "When processing plant fibers for rope, material keeps breaking during twisting. Most effective solution?",
                    options: ["A) Twist fibers tighter to increase strength", "B) Use shorter fiber lengths to reduce stress points", "C) Slightly dampen fibers before working with them", "D) Add more individual fibers to increase bulk"],
                    correct: 2,
                    explanation: "Slightly moist fibers become more pliable and less prone to breaking during twisting process. Completely dry fibers are brittle, while overly wet fibers become weak and stretchy.",
                    difficulty: "medium"
                },
                {
                    question: "Building a lean-to but notice cold air flowing under sleeping area. Which ground insulation strategy provides most effective solution?",
                    options: ["A) Dig shallow depression to get below ground level", "B) Create thick layer of dry leaves with largest ones on bottom", "C) Lay flat rocks to create thermal mass base", "D) Use green pine boughs with needles pointing up"],
                    correct: 1,
                    explanation: "Minimum 6-8 inches of dry leaves with larger leaves as base layer creates effective dead air space insulation. This prevents conductive heat loss to cold ground.",
                    difficulty: "easy"
                },
                {
                    question: "Improvised water filter from sand, charcoal and cloth produces cloudy water with strange taste. Most likely problem with filtration system?",
                    options: ["A) Sand layer too thick, restricting flow", "B) Charcoal not properly prepared from hardwood", "C) Cloth too fine, creating excessive back pressure", "D) Filter materials in wrong order top to bottom"],
                    correct: 1,
                    explanation: "Proper activated charcoal for filtration must be made from hardwood, burned to white ash, then crushed to increase surface area. Poor charcoal preparation reduces both clarity and taste improvement.",
                    difficulty: "medium"
                },
                {
                    question: "In survival situation need to prioritize time and energy. Which project provides greatest 'force multiplication' for survival capabilities?",
                    options: ["A) Building complex water purification system", "B) Creating sharp, durable knife from stone or metal", "C) Constructing elaborate food storage container", "D) Weaving large basket for material collection"],
                    correct: 1,
                    explanation: "Quality cutting tool enables dozens of other survival tasks - shelter building, fire prep, food processing, tool making, and material processing. It multiplies ability to accomplish subsequent projects.",
                    difficulty: "easy"
                },
                {
                    question: "When smoking meat for preservation, fire produces too much heat and insufficient smoke. How to modify setup?",
                    options: ["A) Add green hardwood to increase smoke production", "B) Move meat closer to fire for faster processing", "C) Create longer smoke path between fire and meat", "D) Use only dry hardwood split into small pieces"],
                    correct: 2,
                    explanation: "Longer smoke path allows heat to dissipate while maintaining smoke density. Dakota fire pit method or offset fire pit achieves proper temperature control for preservative smoking.",
                    difficulty: "medium"
                },
                {
                    question: "Identifying edible plants using Universal Edibility Test. At which stage should you immediately stop testing?",
                    options: ["A) When plant creates mild burning on lip", "B) When plant sap leaves temporary stain on skin", "C) When you notice any bitter taste during tongue test", "D) When stomach feels mild upset after 8 hours"],
                    correct: 0,
                    explanation: "Any burning during contact tests indicates potentially harmful compounds. Test should be immediately stopped and plant marked as unsafe for consumption.",
                    difficulty: "easy"
                },
                {
                    question: "Debris hut completed but still experiencing condensation problems inside. Most effective solution?",
                    options: ["A) Add more debris to outer walls for thickness", "B) Create small ventilation gaps at top and bottom", "C) Line interior with large leaves as vapor barrier", "D) Dig drainage channels around shelter perimeter"],
                    correct: 1,
                    explanation: "Controlled ventilation allows moisture to escape while retaining heat. Small gaps at different heights create airflow that prevents condensation buildup without significant heat loss.",
                    difficulty: "medium"
                },
                {
                    question: "When creating deadfall trap, trigger mechanism keeps releasing prematurely. Which adjustment improves reliability?",
                    options: ["A) Make trigger stick longer for more stability", "B) Use heavier weight to increase trigger force", "C) Increase friction surface area between trigger components", "D) Position trigger deeper under crushing weight"],
                    correct: 2,
                    explanation: "Increasing friction between trigger components (through notches, roughening surfaces, or better fitting) creates more resistance to accidental triggering while maintaining sensitivity to intentional animal contact.",
                    difficulty: "medium"
                },
                {
                    question: "Using pine resin for waterproofing containers but it's too brittle when cooled. What to add for improved flexibility?",
                    options: ["A) Small amounts of charcoal powder as filler", "B) Heated animal fat or plant oils", "C) Fine sand to create more workable texture", "D) Additional heating to change resin consistency"],
                    correct: 1,
                    explanation: "Adding heated animal fat or plant oils to pine resin creates more flexible, less brittle sealant when cooled. This mixture maintains waterproofing while allowing material movement.",
                    difficulty: "medium"
                },
                {
                    question: "In cold conditions, fire keeps dying overnight despite using large hardwood logs. Most likely cause?",
                    options: ["A) Insufficient initial fire size to ignite large logs", "B) Logs positioned too far apart, losing mutual heating", "C) Wrong wood species that burns too quickly", "D) Lack of proper kindling gradation for sustained burning"],
                    correct: 1,
                    explanation: "Large logs must be positioned close enough for mutual thermal reinforcement. 'Star fire' configuration allows pushing logs inward as they burn, maintaining this critical distance.",
                    difficulty: "medium"
                },
                {
                    question: "Built simple lever for moving heavy logs for shelter construction. Despite proper positioning, can't generate sufficient force. What most improves leverage?",
                    options: ["A) Find harder, more solid fulcrum material", "B) Increase length of lever arm you're pushing on", "C) Position fulcrum closer to load being moved", "D) Apply force at steeper downward angle"],
                    correct: 2,
                    explanation: "Moving fulcrum closer to load increases mechanical advantage. The closer fulcrum is to load, the greater force multiplication, though this reduces distance load moves.",
                    difficulty: "medium"
                },
                {
                    question: "When preserving meat by salt curing, meat develops bad smell after few days. What was most likely done wrong?",
                    options: ["A) Used too little salt for proper preservation", "B) Storing meat at too high temperature", "C) Didn't remove all excess moisture before curing", "D) Used wrong type of salt for curing"],
                    correct: 1,
                    explanation: "Salt curing requires cool temperatures (below 50°F) to prevent spoilage bacteria growth. Warm temperatures allow harmful bacteria to multiply faster than salt can suppress them.",
                    difficulty: "medium"
                },
                {
                    question: "Natural rope keeps breaking at splice points where adding new material. How to improve splice strength?",
                    options: ["A) Overlap new fibers over greater distance during splicing", "B) Twist splice points tighter than rest", "C) Add new material only when previous section completely dry", "D) Use only thinnest fibers for splicing connections"],
                    correct: 0,
                    explanation: "Longer overlap distances distribute stress across more fiber-to-fiber contact points, preventing failure at splice. Minimum overlap should be 4-6 times individual fiber length.",
                    difficulty: "medium"
                },
                {
                    question: "In long-term survival situation need to make activities sustainable. Which approach best embodies 'energy return on investment' principle?",
                    options: ["A) Building multiple backup systems for each critical function", "B) Creating one high-quality tool that enables many other tasks", "C) Focusing only on immediate needs without long-term planning", "D) Using most complex available solution to ensure reliability"],
                    correct: 1,
                    explanation: "One high-quality, multi-purpose tool that enables multiple subsequent tasks provides best energy return. This 'force multiplier' approach maximizes capabilities gained per calorie invested in creation.",
                    difficulty: "hard"
                }
            ],

            medical: [
                {
                    question: "Leading group on hike when member falls and gets obvious leg fracture 8 miles from trail. Patient conscious, vitals stable, but can't bear weight. Evening approaching and temperature dropping. Your immediate priority?",
                    options: ["A) Splint fracture immediately with available materials", "B) First assess neurovascular status of injured limb", "C) Send fastest hiker ahead to organize evacuation", "D) Create shelter and wait for morning before moving"],
                    correct: 1,
                    explanation: "Assessing neurovascular status (pulse, sensation, movement, color) takes priority before any manipulation or splinting. Fracture with compromised circulation requires immediate intervention, while fracture with intact neurovascular function allows time for proper splinting and planning.",
                    difficulty: "medium"
                },
                {
                    question: "Team member found unconscious after climbing fall. No obvious external bleeding, but breathing 6 breaths/min and irregular. Using ABCDE assessment, what's your next action after ensuring scene safety?",
                    options: ["A) Check for spinal injuries by palpating neck", "B) Open airway with head tilt-chin lift maneuver", "C) Begin chest compressions immediately", "D) Use jaw thrust without head tilt to open airway"],
                    correct: 3,
                    explanation: "With potential head injury and altered consciousness, spinal injury must be assumed. Jaw thrust maneuver opens airway without moving neck, addressing life-threatening respiratory rate while protecting spine.",
                    difficulty: "medium"
                },
                {
                    question: "During winter camping, group member shows confusion, slurred speech, and stopped shivering despite continued cold exposure. Skin pale, and he's clumsily performing simple tasks. What hypothermia stage is he experiencing?",
                    options: ["A) Mild hypothermia - needs warm drinks and shelter", "B) Moderate hypothermia - serious emergency requiring immediate rewarming", "C) Severe hypothermia - shivering stopped indicating core temp below 90°F", "D) Normal cold response - these symptoms expected in cold weather"],
                    correct: 1,
                    explanation: "Combination of confusion, slurred speech, and clumsiness ('umbles') with continued shivering indicates moderate hypothermia. This is serious emergency requiring aggressive rewarming, but presence of shivering means they haven't progressed to severe hypothermia where shivering stops.",
                    difficulty: "medium"
                },
                {
                    question: "Treating deep laceration on forearm that's bleeding heavily. Direct pressure doesn't control bleeding. Next appropriate step in bleeding control algorithm?",
                    options: ["A) Apply tourniquet 2-3 inches above wound", "B) Elevate arm and apply pressure to brachial artery", "C) Pack wound tightly with clean gauze or cloth", "D) Apply ice to wound for vasoconstriction"],
                    correct: 2,
                    explanation: "For deep wounds with heavy bleeding not controlled by direct pressure, wound packing is next step. Wound should be tightly packed from bottom up with gauze, then direct pressure applied over packing. Tourniquets reserved for life-threatening bleeding when other methods fail.",
                    difficulty: "medium"
                },
                {
                    question: "Hiking partner stung by multiple wasps and develops facial swelling, difficulty breathing, and hives on chest. He's conscious but anxious. If epinephrine unavailable, your priority action?",
                    options: ["A) Give antihistamines and monitor closely", "B) Evacuate immediately while keeping them sitting upright", "C) Apply cold compresses to reduce swelling", "D) Lay them flat to improve circulation"],
                    correct: 1,
                    explanation: "This is anaphylaxis - life-threatening emergency. Without epinephrine, immediate evacuation is absolute priority. Keep patient upright to help breathing. While antihistamines may help, evacuation cannot be delayed for their administration.",
                    difficulty: "easy"
                },
                {
                    question: "You suspect team member consumed poisonous mushrooms 18 hours ago. They had initial nausea and vomiting that resolved, but now seem normal. What's most concerning about this picture?",
                    options: ["A) Delayed onset suggests serious neurological toxin", "B) Apparent recovery may be false improvement before liver failure", "C) Vomiting indicates poison was eliminated", "D) 18-hour delay means danger has passed"],
                    correct: 1,
                    explanation: "Classic pattern of amatoxin poisoning (death cap mushrooms) includes initial GI symptoms that resolve, creating false hope during asymptomatic period while liver-destroying toxins work. This is followed by potentially fatal liver failure 3-5 days later, making immediate evacuation critical.",
                    difficulty: "hard"
                },
                {
                    question: "Group encounters someone with suspected venomous snake bite on ankle. Bite occurred 30 minutes ago, progressive swelling to mid-calf, and person reports increasing pain. Best approach?",
                    options: ["A) Apply tourniquet above swelling to prevent venom spread", "B) Make small cuts over fang marks to drain venom", "C) Keep limb still below heart level and evacuate immediately", "D) Apply ice packs to slow venom absorption"],
                    correct: 2,
                    explanation: "Modern snakebite management focuses on immobilization below heart level to slow venom circulation and immediate evacuation. Tourniquets, cutting/suction, and ice are all contraindicated as they increase tissue damage without removing significant venom.",
                    difficulty: "medium"
                },
                {
                    question: "During winter expedition need to create improvised shelter for injured team member showing early hypothermia signs. Which principle most important for effective cold protection?",
                    options: ["A) Maximize wind protection above all other factors", "B) Create multiple insulation layers with air spaces between them", "C) Use reflective materials to bounce heat back to body", "D) Ensure shelter is maximum size for comfort"],
                    correct: 1,
                    explanation: "Effective insulation depends on trapping still air in layers. Multiple layers with air spaces provide superior insulation compared to single thick layers. While wind protection is important, proper insulation is foundation of heat retention.",
                    difficulty: "medium"
                },
                {
                    question: "Managing multiple casualties after rockfall. Using triage principles, which patient should receive immediate attention?",
                    options: ["A) Unconscious person with weak pulse and slow breathing", "B) Conscious person with obvious open leg fracture and controlled bleeding", "C) Walking person complaining of severe back pain", "D) Conscious person with rapid breathing and uncontrolled arm bleeding"],
                    correct: 3,
                    explanation: "In triage, 'Immediate' category patients have life-threatening injuries that are salvageable with intervention. Uncontrolled bleeding is immediately life-threatening but treatable. Unconscious person may be too severe (expectant category), while walking wounded and controlled bleeding have lower priority.",
                    difficulty: "hard"
                },
                {
                    question: "Team member falls into cold water (45°F) wearing heavy clothing. They manage to grab boat but can't climb in. What's most critical danger in first 3 minutes?",
                    options: ["A) Rapid onset of hypothermia", "B) Initial cold shock response causing drowning", "C) Clothing becoming waterlogged and pulling them under", "D) Panic leading to poor decision making"],
                    correct: 1,
                    explanation: "Initial cold shock response (0-3 minutes) causes involuntary gasping and hyperventilation, creating highest drowning risk. If this critical period is survived, there's meaningful time before hypothermia becomes life-threatening, even in very cold water.",
                    difficulty: "medium"
                },
                {
                    question: "Treating second-degree burn on hand from camping accident. After cooling with water, which improvised treatment shows best evidence for promoting healing?",
                    options: ["A) Apply oil or cooking fat to moisturize burn", "B) Pop any blisters to prevent infection", "C) Apply raw honey if available and cover with clean cloth", "D) Rub snow on burn to continue cooling"],
                    correct: 2,
                    explanation: "Raw honey has proven antimicrobial properties and creates moist healing environment. It's one of few natural remedies with clinical evidence for burn treatment. Oil/fat retains heat, popping blisters increases infection risk, and continued cooling with snow can cause cold injury.",
                    difficulty: "easy"
                },
                {
                    question: "During multi-day wilderness medical emergency, managing someone with infected wound showing infection signs. Antibiotic supply limited. Which approach best balances treatment with resource conservation?",
                    options: ["A) Use full standard antibiotic course immediately", "B) Give half doses to make supplies last longer", "C) Wait until infection becomes severe before starting antibiotics", "D) Use antibiotics 3 days, then reassess before continuing"],
                    correct: 0,
                    explanation: "Incomplete antibiotic courses risk creating resistant bacteria and treatment failure. While resource conservation important, proper antibiotic use with clear indications maximizes effectiveness. Half doses or shortened courses often fail to clear infections.",
                    difficulty: "hard"
                },
                {
                    question: "Team member reports severe abdominal pain that started around navel and now moved to right lower abdomen. They have fever and refuse to walk due to pain. You're 2 days from evacuation. Primary concern?",
                    options: ["A) Food poisoning from contaminated water", "B) Appendicitis requiring immediate evacuation attempt", "C) Kidney stones that will pass naturally", "D) Muscle strain from carrying heavy pack"],
                    correct: 1,
                    explanation: "Classic appendicitis presentation (periumbilical pain migrating to right lower quadrant with fever and inability to walk) requires immediate evacuation. Appendix can rupture within 48-72 hours, dramatically increasing mortality without surgical intervention.",
                    difficulty: "medium"
                },
                {
                    question: "When crossing fast stream, team member falls and appears to have shoulder dislocation. Arm in abnormal position and they can't move it. Evacuation timeline uncertain. Best approach?",
                    options: ["A) Attempt immediate reduction using gentle traction", "B) Immobilize in position found and arrange evacuation", "C) Give pain medication then attempt reduction", "D) Attempt reduction only if you have previous medical training"],
                    correct: 1,
                    explanation: "Without proper training and in uncertain evacuation circumstances, attempting joint reduction risks serious neurovascular damage. Immobilization in position found with rapid evacuation is safest. Pain control while maintaining immobilization appropriate.",
                    difficulty: "medium"
                },
                {
                    question: "Leading group through hot desert terrain when someone develops hot, dry skin, confusion, and rapid pulse. Their core temperature feels extremely elevated. Immediate priority?",
                    options: ["A) Give them cold water to drink immediately", "B) Move them to shade and begin aggressive cooling measures", "C) Continue slow hiking to reach help faster", "D) Give salt tablets to replace lost electrolytes"],
                    correct: 1,
                    explanation: "This is heat stroke - true medical emergency with high mortality. Aggressive cooling takes absolute priority over everything else, including evacuation preparation. Every minute of core temperature above 105°F increases organ damage risk.",
                    difficulty: "easy"
                },
                {
                    question: "Team member stepped on nail that penetrated through their boot. Nail went completely through sole into their foot. Nail no longer in wound. Primary concern with this injury?",
                    options: ["A) Stopping bleeding which is likely severe", "B) High infection risk from deep tissue inoculation", "C) Tetanus infection from rusty metal", "D) Possible broken bones in foot"],
                    correct: 1,
                    explanation: "Puncture wounds, especially through footwear, carry extremely high infection risk due to deep tissue inoculation with bacteria. Wound looks minor externally but creates perfect conditions for anaerobic infections. Bleeding usually minimal with puncture wounds.",
                    difficulty: "medium"
                },
                {
                    question: "When treating fracture in wilderness need to improvise splint. Which principle most important for effective splinting?",
                    options: ["A) Make splint as tight as possible to prevent movement", "B) Immobilize joints above and below fracture site", "C) Use only rigid materials for proper support", "D) Extend splint past fingers or toes"],
                    correct: 1,
                    explanation: "Effective splinting requires immobilizing joints above and below fracture to prevent movement at injury site. This principle applies regardless of materials used. Over-tightening can compromise circulation, and soft materials can be effective when properly applied.",
                    difficulty: "easy"
                },
                {
                    question: "Group caught in severe weather and must shelter for extended time. One member showing mild hypothermia symptoms. Which rewarming method most appropriate for field conditions?",
                    options: ["A) Place them directly by fire for rapid warming", "B) Give them alcohol for vasodilation and warmth", "C) Use skin-to-skin contact in shared sleeping system", "D) Make them exercise vigorously to generate heat"],
                    correct: 2,
                    explanation: "For mild hypothermia, gradual rewarming with shared body heat is safe and effective. Direct heat sources risk burns due to impaired sensation, alcohol accelerates heat loss, and vigorous exercise can worsen hypothermia by shunting warm blood to extremities.",
                    difficulty: "medium"
                },
                {
                    question: "Encounter unconscious person who appears to have no pulse or breathing. They're cold to touch and skin is blue-gray. In wilderness conditions, what should guide decision about starting CPR?",
                    options: ["A) Begin CPR immediately - time is critical", "B) Don't start CPR - they're obviously dead", "C) Check for signs of life up to 60 seconds before deciding", "D) Warm them first, then reassess for signs of life"],
                    correct: 2,
                    explanation: "In hypothermic patients, pulse and breathing may be so slow as undetectable. The saying applies: 'no one is dead until warm and dead.' Check for signs of life up to 60 seconds, as severely hypothermic patients have survived without detectable vital signs.",
                    difficulty: "hard"
                },
                {
                    question: "Team member reports tick bite 2 days ago. Tick was properly removed but now there's expanding red rash around bite site with clear center, resembling 'bull's eye' pattern. Primary concern?",
                    options: ["A) Local allergic reaction to tick bite", "B) Possible Lyme disease requiring antibiotic treatment", "C) Normal healing response to tick saliva", "D) Secondary bacterial infection from scratching"],
                    correct: 1,
                    explanation: "Expanding 'bull's eye' rash (erythema migrans) is pathognomonic for early Lyme disease. Early antibiotic treatment is highly effective, while delayed treatment can lead to serious complications including cardiac and neurological problems.",
                    difficulty: "easy"
                }
            ]
        };

        let currentQuiz = null;
        let currentQuestionIndex = 0;
        let selectedAnswer = null;
        let score = 0;
        let answeredQuestions = [];

        function startQuiz(quizType) {
            currentQuiz = [];
            currentQuestionIndex = 0;
            score = 0;
            answeredQuestions = [];
            
            // Collect questions based on type
            if (quizType === 'all') {
                currentQuiz = [...questionsData.basic, ...questionsData.offgrid, ...questionsData.medical];
                document.getElementById('quizTitle').textContent = 'Complete Preparedness Assessment';
            } else if (quizType === 'basic') {
                currentQuiz = [...questionsData.basic];
                document.getElementById('quizTitle').textContent = 'Basic Survival Skills';
            } else if (quizType === 'offgrid') {
                currentQuiz = [...questionsData.offgrid];
                document.getElementById('quizTitle').textContent = 'Life Without Electricity';
            } else if (quizType === 'medical') {
                currentQuiz = [...questionsData.medical];
                document.getElementById('quizTitle').textContent = 'Wilderness Medicine';
            }

            // Shuffle questions
            shuffleArray(currentQuiz);
            
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'block';
            document.getElementById('resultsContainer').style.display = 'none';
            
            showQuestion();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function showQuestion() {
            if (currentQuestionIndex >= currentQuiz.length) {
                showResults();
                return;
            }

            const question = currentQuiz[currentQuestionIndex];
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('questionCounter').textContent = `${currentQuestionIndex + 1}/${currentQuiz.length}`;
            
            const progressPercent = ((currentQuestionIndex) / currentQuiz.length) * 100;
            document.getElementById('progressBar').style.width = progressPercent + '%';

            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionDiv);
            });

            document.getElementById('explanation').style.display = 'none';
            document.getElementById('nextButton').disabled = true;
            selectedAnswer = null;
        }

        function selectOption(index) {
            selectedAnswer = index;
            
            const options = document.querySelectorAll('.option');
            options.forEach(option => option.classList.remove('selected'));
            options[index].classList.add('selected');
            
            document.getElementById('nextButton').disabled = false;
        }

        function nextQuestion() {
            const question = currentQuiz[currentQuestionIndex];
            const isCorrect = selectedAnswer === question.correct;
            
            if (isCorrect) {
                score++;
            }

            answeredQuestions.push({
                question: question.question,
                selectedAnswer: selectedAnswer,
                correctAnswer: question.correct,
                isCorrect: isCorrect,
                explanation: question.explanation,
                difficulty: question.difficulty
            });

            // Show correct answer
            const options = document.querySelectorAll('.option');
            options.forEach((option, index) => {
                if (index === question.correct) {
                    option.classList.add('correct');
                } else if (index === selectedAnswer && !isCorrect) {
                    option.classList.add('incorrect');
                }
                option.onclick = null; // Disable clicks
            });

            // Show explanation
            const explanationDiv = document.getElementById('explanation');
            explanationDiv.innerHTML = `
                <h4>${isCorrect ? '✅ Correct!' : '❌ Incorrect'}</h4>
                <p>${question.explanation}</p>
            `;
            explanationDiv.style.display = 'block';

            // Change button
            const nextButton = document.getElementById('nextButton');
            nextButton.textContent = currentQuestionIndex === currentQuiz.length - 1 ? 'Finish Test' : 'Next Question';
            nextButton.onclick = () => {
                currentQuestionIndex++;
                nextButton.textContent = 'Next';
                nextButton.onclick = nextQuestion;
                showQuestion();
            };
        }

        function showResults() {
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'block';

            const percentage = Math.round((score / currentQuiz.length) * 100);
            document.getElementById('scoreText').textContent = `${score}/${currentQuiz.length}`;

            const scoreCircle = document.getElementById('scoreCircle');
            const resultTitle = document.getElementById('resultTitle');
            const resultDescription = document.getElementById('resultDescription');

            if (percentage >= 90) {
                scoreCircle.className = 'score-circle score-excellent';
                resultTitle.textContent = 'Excellent Preparedness! 🏆';
                resultDescription.textContent = 'You have outstanding survival knowledge. You\'re ready for most extreme situations.';
            } else if (percentage >= 70) {
                scoreCircle.className = 'score-circle score-good';
                resultTitle.textContent = 'Good Preparedness 👍';
                resultDescription.textContent = 'Your knowledge is at a good level, but there are areas for improvement. Continue studying and practicing.';
            } else if (percentage >= 50) {
                scoreCircle.className = 'score-circle score-basic';
                resultTitle.textContent = 'Basic Knowledge ⚠️';
                resultDescription.textContent = 'You have the basics, but need to seriously improve preparation. We recommend studying books and taking training.';
            } else {
                scoreCircle.className = 'score-circle score-critical';
                resultTitle.textContent = 'Critical Gap! 🚨';
                resultDescription.textContent = 'Your knowledge is insufficient for safety. You urgently need to study survival basics.';
            }

            // Calculate category-specific scores for recommendations
            const categoryScores = calculateCategoryScores();
            
            // Add detailed statistics
            const difficultyStats = answeredQuestions.reduce((acc, q) => {
                if (!acc[q.difficulty]) acc[q.difficulty] = { correct: 0, total: 0 };
                acc[q.difficulty].total++;
                if (q.isCorrect) acc[q.difficulty].correct++;
                return acc;
            }, {});

            let statsHtml = '<div style="margin-top: 20px; text-align: left; background: #f8f9fa; padding: 20px; border-radius: 12px; border-left: 4px solid #7dae42;"><h3 style="color: #2d5016; margin-bottom: 16px;">Detailed Statistics:</h3>';
            
            Object.keys(difficultyStats).forEach(difficulty => {
                const stats = difficultyStats[difficulty];
                const percent = Math.round((stats.correct / stats.total) * 100);
                const difficultyNames = {
                    'easy': 'Easy',
                    'medium': 'Medium', 
                    'intermediate': 'Medium',
                    'hard': 'Hard',
                    'complex': 'Hard'
                };
                
                const color = percent >= 70 ? '#28a745' : percent >= 50 ? '#ffc107' : '#dc3545';
                statsHtml += `<p style="margin: 8px 0; color: #333;"><strong>${difficultyNames[difficulty] || difficulty}:</strong> <span style="color: ${color}; font-weight: bold;">${stats.correct}/${stats.total} (${percent}%)</span></p>`;
            });
            
            statsHtml += '</div>';
            
            // Add book recommendations
            const recommendations = generateBookRecommendations(percentage, categoryScores);
            statsHtml += recommendations;
            
            resultDescription.innerHTML += statsHtml;
        }

        function calculateCategoryScores() {
            // Get original question data to categorize answers
            const basicQuestions = questionsData.basic;
            const offgridQuestions = questionsData.offgrid;
            const medicalQuestions = questionsData.medical;
            
            const scores = {
                basic: { correct: 0, total: 0 },
                offgrid: { correct: 0, total: 0 },
                medical: { correct: 0, total: 0 }
            };
            
            answeredQuestions.forEach(answer => {
                // Find which category this question belongs to
                const questionText = answer.question;
                
                if (basicQuestions.some(q => q.question === questionText)) {
                    scores.basic.total++;
                    if (answer.isCorrect) scores.basic.correct++;
                } else if (offgridQuestions.some(q => q.question === questionText)) {
                    scores.offgrid.total++;
                    if (answer.isCorrect) scores.offgrid.correct++;
                } else if (medicalQuestions.some(q => q.question === questionText)) {
                    scores.medical.total++;
                    if (answer.isCorrect) scores.medical.correct++;
                }
            });
            
            return scores;
        }

        function generateBookRecommendations(overallPercentage, categoryScores) {
            let recommendationsHtml = '<div style="margin-top: 24px; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 12px; border: 2px solid #7dae42;">';
            
            // Perfect score - recommend author exploration
            if (overallPercentage === 100) {
                recommendationsHtml += `
                    <h3 style="color: #2d5016; margin-bottom: 16px; text-align: center;">🎯 Master Level Achieved!</h3>
                    <p style="color: #333; margin-bottom: 16px; text-align: center;">You've mastered all survival fundamentals! Ready to explore advanced topics?</p>
                    <div style="text-align: center;">
                        <button onclick="window.open('AUTHOR_LINK_PLACEHOLDER', '_blank')" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer; margin: 8px;">
                            📚 Explore More Books by Caleb North
                        </button>
                    </div>
                `;
            }
            // Excellent performance (90-99%) - recommend all books or specific areas
            else if (overallPercentage >= 90) {
                const weakestAreas = findWeakestAreas(categoryScores);
                recommendationsHtml += `
                    <h3 style="color: #2d5016; margin-bottom: 16px;">📖 Recommended Reading for Excellence</h3>
                    <p style="color: #333; margin-bottom: 16px;">You're almost there! Focus on these areas to reach mastery:</p>
                `;
                recommendationsHtml += generateSpecificBookRecommendations(weakestAreas);
            }
            // Good performance (70-89%) - recommend books based on weak areas
            else if (overallPercentage >= 70) {
                const weakestAreas = findWeakestAreas(categoryScores);
                recommendationsHtml += `
                    <h3 style="color: #2d5016; margin-bottom: 16px;">📚 Strengthen Your Knowledge</h3>
                    <p style="color: #333; margin-bottom: 16px;">Good foundation! These books will help you improve in key areas:</p>
                `;
                recommendationsHtml += generateSpecificBookRecommendations(weakestAreas);
            }
            // Basic or Critical - recommend comprehensive approach
            else {
                recommendationsHtml += `
                    <h3 style="color: #2d5016; margin-bottom: 16px;">🎯 Essential Learning Path</h3>
                    <p style="color: #333; margin-bottom: 20px;">Start with the fundamentals and build comprehensive survival skills:</p>
                    
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <div style="display: flex; gap: 20px; align-items: center;">
                            <div style="flex-shrink: 0;">
                                <img src="./images/basic-survival-cover.jpg" alt="Basic Survival Skills Book" style="width: 120px; height: 160px; object-fit: cover; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                            </div>
                            <div style="flex: 1;">
                                <h4 style="color: #2d5016; margin-bottom: 12px; font-size: 1.2rem;">🎒 Start Here: Basic Survival Skills</h4>
                                <p style="color: #666; margin-bottom: 16px; line-height: 1.5;">Perfect foundation for beginners. Master the essential mindset, first aid, communication, and fitness fundamentals.</p>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <button onclick="window.open('BASIC_BOOK_LINK_PLACEHOLDER', '_blank')" style="background: linear-gradient(135deg, #7dae42, #5d8234); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer;">
                                        📖 Get This Book
                                    </button>
                                    <span style="color: #28a745; font-weight: bold; font-size: 1.1rem;">$19.99</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%); border-radius: 12px; border: 2px solid #17a2b8;">
                        <h4 style="color: #2d5016; margin-bottom: 16px;">💡 Pro Tip: Complete Survival Mastery</h4>
                        <div style="display: flex; justify-content: center; gap: 16px; margin-bottom: 16px;">
                            <img src="./images/basic-survival-cover.jpg" alt="Basic Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                            <img src="./images/offgrid-survival-cover.jpg" alt="Off-Grid Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                            <img src="./images/medical-survival-cover.jpg" alt="Medical Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                        </div>
                        <p style="color: #666; margin-bottom: 16px;">Get all three books for complete survival knowledge!</p>
                        <button onclick="window.open('ALL_BOOKS_LINK_PLACEHOLDER', '_blank')" style="background: linear-gradient(135deg, #17a2b8, #007bff); color: white; border: none; padding: 16px 32px; border-radius: 8px; font-size: 1.1rem; cursor: pointer; box-shadow: 0 4px 16px rgba(23, 162, 184, 0.3);">
                            📚 Get Complete Collection
                        </button>
                    </div>
                `;
            }
            
            recommendationsHtml += '</div>';
            return recommendationsHtml;
        }

        function findWeakestAreas(categoryScores) {
            const areas = [];
            
            Object.keys(categoryScores).forEach(category => {
                const score = categoryScores[category];
                if (score.total > 0) {
                    const percentage = (score.correct / score.total) * 100;
                    areas.push({
                        category: category,
                        percentage: percentage,
                        score: score
                    });
                }
            });
            
            // Sort by percentage (worst first)
            areas.sort((a, b) => a.percentage - b.percentage);
            return areas;
        }

        function generateSpecificBookRecommendations(areas) {
            let html = '';
            
            areas.forEach((area, index) => {
                const bookInfo = getBookInfo(area.category);
                const percentage = Math.round(area.percentage);
                const color = percentage < 50 ? '#dc3545' : percentage < 70 ? '#ffc107' : '#28a745';
                
                html += `
                    <div style="margin-bottom: 20px; padding: 20px; background: white; border-radius: 12px; border-left: 4px solid ${color}; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <div style="display: flex; gap: 20px; align-items: flex-start;">
                            <div style="flex-shrink: 0;">
                                <img src="${bookInfo.coverImage}" alt="${bookInfo.title}" style="width: 120px; height: 160px; object-fit: cover; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                            </div>
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                    <h4 style="color: #2d5016; margin: 0; font-size: 1.2rem;">${bookInfo.emoji} ${bookInfo.title}</h4>
                                    <span style="color: ${color}; font-weight: bold; font-size: 1.1rem; background: ${color}20; padding: 4px 12px; border-radius: 20px;">${area.score.correct}/${area.score.total} (${percentage}%)</span>
                                </div>
                                <p style="color: #666; margin-bottom: 16px; font-size: 0.95rem; line-height: 1.5;">${bookInfo.description}</p>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <button onclick="window.open('${bookInfo.link}', '_blank')" style="background: linear-gradient(135deg, #7dae42, #5d8234); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; flex: 1; max-width: 200px;">
                                        📖 Get This Book
                                    </button>
                                    <span style="color: #28a745; font-weight: bold; font-size: 1.1rem;">${bookInfo.price}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            // Add bundle option if multiple books recommended
            if (areas.length > 1) {
                html += `
                    <div style="margin-top: 24px; padding: 24px; background: linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%); border-radius: 12px; border: 2px solid #17a2b8; text-align: center;">
                        <h4 style="color: #2d5016; margin-bottom: 16px;">📚 Complete Your Knowledge</h4>
                        <div style="display: flex; justify-content: center; gap: 16px; margin-bottom: 16px;">
                            <img src="./images/basic-survival-cover.jpg" alt="Basic Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                            <img src="./images/offgrid-survival-cover.jpg" alt="Off-Grid Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                            <img src="./images/medical-survival-cover.jpg" alt="Medical Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                        </div>
                        <p style="color: #666; margin-bottom: 16px;">Get all three books for complete survival knowledge across all scenarios!</p>
                        <button onclick="window.open('ALL_BOOKS_LINK_PLACEHOLDER', '_blank')" style="background: linear-gradient(135deg, #17a2b8, #007bff); color: white; border: none; padding: 16px 32px; border-radius: 8px; font-size: 1.1rem; cursor: pointer; box-shadow: 0 4px 16px rgba(23, 162, 184, 0.3);">
                            📚 Get Complete Collection
                        </button>
                    </div>
                `;
            }
            
            return html;
        }

        function getBookInfo(category) {
            const books = {
                basic: {
                    emoji: '🎒',
                    title: 'Basic Survival Skills',
                    shortTitle: 'Basic Survival Skills Book',
                    description: 'Master the fundamentals: mindset, first aid, communication, and physical preparedness for any emergency situation.',
                    link: 'BASIC_BOOK_LINK_PLACEHOLDER',
                    coverImage: './images/basic-survival-cover.jpg',
                    price: '$19.99'
                },
                offgrid: {
                    emoji: '🔥',
                    title: 'Off-Grid Survival',
                    shortTitle: 'Live Free Off The Grid',
                    description: 'Learn practical skills for living without electricity: shelter building, fire making, water purification, and food procurement.',
                    link: 'OFFGRID_BOOK_LINK_PLACEHOLDER',
                    coverImage: './images/offgrid-survival-cover.jpg',
                    price: '$22.99'
                },
                medical: {
                    emoji: '🏥',
                    title: 'Wilderness Medicine',
                    shortTitle: 'Off-Grid Medicine Handbook',
                    description: 'Essential first aid and medical skills for extreme conditions without hospitals or modern medical facilities.',
                    link: 'MEDICAL_BOOK_LINK_PLACEHOLDER',
                    coverImage: './images/medical-survival-cover.jpg',
                    price: '$24.99'
                }
            };
            
            return books[category] || books.basic;
        }

        function showMainMenu() {
            document.getElementById('mainMenu').style.display = 'grid';
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'none';
        }

        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'survival-quiz-v1';
                    const urlsToCache = ['/'];
                    
                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                        );
                    });
                    
                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => response || fetch(event.request))
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            });
        }
    </script>
</body>
</html>,
                flag: '🇦🇺',
                name: 'Australia'
            }
        };

        // Book links for different regions
        const bookLinks = {
            basic: {
                usa: 'USA_BASIC_BOOK_LINK_PLACEHOLDER',
                uk: 'UK_BASIC_BOOK_LINK_PLACEHOLDER',
                ca: 'CA_BASIC_BOOK_LINK_PLACEHOLDER',
                au: 'AU_BASIC_BOOK_LINK_PLACEHOLDER'
            },
            offgrid: {
                usa: 'USA_OFFGRID_BOOK_LINK_PLACEHOLDER',
                uk: 'UK_OFFGRID_BOOK_LINK_PLACEHOLDER',
                ca: 'CA_OFFGRID_BOOK_LINK_PLACEHOLDER',
                au: 'AU_OFFGRID_BOOK_LINK_PLACEHOLDER'
            },
            medical: {
                usa: 'USA_MEDICAL_BOOK_LINK_PLACEHOLDER',
                uk: 'UK_MEDICAL_BOOK_LINK_PLACEHOLDER',
                ca: 'CA_MEDICAL_BOOK_LINK_PLACEHOLDER',
                au: 'AU_MEDICAL_BOOK_LINK_PLACEHOLDER'
            },
            collection: {
                usa: 'USA_ALL_BOOKS_LINK_PLACEHOLDER',
                uk: 'UK_ALL_BOOKS_LINK_PLACEHOLDER',
                ca: 'CA_ALL_BOOKS_LINK_PLACEHOLDER',
                au: 'AU_ALL_BOOKS_LINK_PLACEHOLDER'
            },
            author: {
                usa: 'USA_AUTHOR_LINK_PLACEHOLDER',
                uk: 'UK_AUTHOR_LINK_PLACEHOLDER',
                ca: 'CA_AUTHOR_LINK_PLACEHOLDER',
                au: 'AU_AUTHOR_LINK_PLACEHOLDER'
            }
        };

        // Book prices for different regions
        const bookPrices = {
            basic: {
                usa: '$19.99',
                uk: '£15.99',
                ca: 'CAD $24.99',
                au: 'AUD $29.99'
            },
            offgrid: {
                usa: '$22.99',
                uk: '£18.99',
                ca: 'CAD $27.99',
                au: 'AUD $32.99'
            },
            medical: {
                usa: '$24.99',
                uk: '£19.99',
                ca: 'CAD $29.99',
                au: 'AUD $34.99'
            }
        };

        function updateRegion() {
            currentRegion = document.getElementById('regionSelector').value;
            // If results are currently showing, refresh them to update prices and links
            if (document.getElementById('resultsContainer').style.display === 'block') {
                showResults();
            }
        }

        // Questions data
        const questionsData = {
            basic: [
                {
                    question: "You're preparing an emergency kit and can only take one item. What would you choose for maximum functionality?",
                    options: ["A) Swiss knife with 15 tools", "B) Simple bandana", "C) Waterproof flashlight", "D) Portable charger"],
                    correct: 1,
                    explanation: "A bandana can serve as a bandage, tourniquet, water filter, signal flag, sun protection, fire starter material, and dozens of other functions.",
                    difficulty: "easy"
                },
                {
                    question: "A teammate has an open fracture with bright red pulsating blood. Direct pressure on the wound doesn't stop the bleeding. What's next?",
                    options: ["A) Apply a tourniquet above the wound", "B) Elevate the arm and continue pressure", "C) Find the pulse point on the arm and compress the artery", "D) Clean the wound and apply a tight bandage"],
                    correct: 2,
                    explanation: "For arterial bleeding when direct pressure is ineffective, the next step is compressing the feeding artery at the pulse point between the bicep and tricep.",
                    difficulty: "intermediate"
                },
                {
                    question: "How do you test readiness for a long hike with a backpack in extreme conditions?",
                    options: ["A) Run 5 km without a backpack", "B) Walk 3 miles with a backpack weighing 15% of your body weight", "C) Lift the backpack overhead 20 times", "D) Stand with the backpack for 30 minutes"],
                    correct: 1,
                    explanation: "The test with a backpack weighing 15% of body weight over 3 miles reveals real readiness for long hikes and identifies weaknesses in endurance.",
                    difficulty: "easy"
                },
                {
                    question: "You're lost and starting to panic. Heart beating fast, breathing rapid. Which technique quickly restores control?",
                    options: ["A) Hold breath for a minute", "B) Breathe using the pattern: 4 seconds in - 4 hold - 4 out - 4 hold", "C) Breathe as fast as possible for 30 seconds", "D) Lie down and relax"],
                    correct: 1,
                    explanation: "Tactical breathing 4-4-4-4 activates the parasympathetic nervous system and quickly reduces stress levels, restoring decision-making ability.",
                    difficulty: "easy"
                },
                {
                    question: "You have paracord. Why is it especially valuable in survival situations?",
                    options: ["A) Only because of high strength", "B) Waterproof coating", "C) Inner threads can be used separately for fishing and sewing", "D) Glows in the dark"],
                    correct: 2,
                    explanation: "Paracord contains inner fibers that can be used separately as fishing line, sewing thread, thin cord - multiplying functionality.",
                    difficulty: "intermediate"
                },
                {
                    question: "In critical situations, the brain narrows perception and impairs memory. How does this affect decision-making?",
                    options: ["A) Decisions become faster and more accurate", "B) Doesn't affect decision quality", "C) Decision quality drops sharply due to tunnel vision", "D) Superhuman analytical abilities appear"],
                    correct: 2,
                    explanation: "Stress causes tunnel vision, working memory disruption, and reversion to primitive reactions, seriously reducing decision quality.",
                    difficulty: "intermediate"
                },
                {
                    question: "A teammate is panicking and breathing fast and shallow. Which breathing technique would you recommend?",
                    options: ["A) 3-3-3-3 (in-hold-out-hold)", "B) 4-4-4-4 (in-hold-out-hold)", "C) 5-5-5-5 (in-hold-out-hold)", "D) Breathe into a bag"],
                    correct: 1,
                    explanation: "Tactical breathing using the 4-4-4-4 pattern (inhale 4 sec, hold 4 sec, exhale 4 sec, hold 4 sec) effectively restores control during panic.",
                    difficulty: "easy"
                },
                {
                    question: "What's the key principle of everyday carry (EDC) emergency items philosophy?",
                    options: ["A) Carry maximum useful items", "B) Only the most expensive items", "C) Items you actually carry every day", "D) Only military gear"],
                    correct: 2,
                    explanation: "The principle of constancy - true EDC includes only what you carry constantly. An item left at home due to inconvenience is useless in an emergency.",
                    difficulty: "intermediate"
                },
                {
                    question: "An earthquake starts while you're indoors. What are the correct actions?",
                    options: ["A) Run to the exit", "B) Stand in a doorway", "C) Drop, take cover under a table, hold on", "D) Jump out the window"],
                    correct: 2,
                    explanation: "Modern recommendation - 'Drop, Cover, Hold' - drop to knees, take cover under a sturdy table, protect head. Doorways in modern buildings don't provide special protection.",
                    difficulty: "intermediate"
                },
                {
                    question: "When planning family emergency communication, why do you need a contact in another city?",
                    options: ["A) To contact authorities", "B) Local communication works, distant doesn't", "C) Long-distance communication often works when local is disrupted", "D) It's a legal requirement"],
                    correct: 2,
                    explanation: "During local disasters, long-distance communication lines often remain operational when local towers and cables are damaged. The remote contact becomes a family information center.",
                    difficulty: "intermediate"
                },
                {
                    question: "You see signs of danger but think 'this can't be serious, everything will be fine.' What psychological trap is this?",
                    options: ["A) Panic attack", "B) Normalcy bias - underestimating threats", "C) Depression", "D) Excessive anxiety"],
                    correct: 1,
                    explanation: "Normalcy bias causes people to minimize threat severity and assume normal conditions will continue even with obvious danger signs. This leads to dangerous response delays.",
                    difficulty: "complex"
                },
                {
                    question: "How do you train multiple ways to perform critical survival tasks?",
                    options: ["A) Learn one method perfectly", "B) Practice primary tool, alternative method, and improvisation without tools", "C) Collect maximum tools", "D) Rely on intuition"],
                    correct: 1,
                    explanation: "'Tool triangulation' - practicing key tasks three ways: primary tool, alternative method, and improvisation without tools creates reliability.",
                    difficulty: "complex"
                },
                {
                    question: "A teammate got burned with boiling water. What should NOT be done?",
                    options: ["A) Cool with cold water", "B) Cover with clean cloth", "C) Apply oil or grease", "D) Give pain medication"],
                    correct: 2,
                    explanation: "Oil and greasy substances retain heat in tissues and worsen damage while creating perfect conditions for infection. This is an outdated and dangerous method.",
                    difficulty: "easy"
                },
                {
                    question: "What does the 'Turn Around, Don't Drown' rule mean during floods?",
                    options: ["A) Turn your back to water", "B) Never enter moving water", "C) Don't turn the car in water", "D) Only swim on your back"],
                    correct: 1,
                    explanation: "Just 6 inches of moving water can knock down an adult, and 12 inches can carry away a car. Better to turn around and find another route than risk life.",
                    difficulty: "intermediate"
                },
                {
                    question: "After many hours of decision-making in crisis, your decision quality deteriorates. What is this?",
                    options: ["A) Panic", "B) Decision fatigue - cognitive resource depletion", "C) Depression", "D) Loss of concentration"],
                    correct: 1,
                    explanation: "Decision fatigue occurs when cognitive resources are depleted after multiple choices. Decision quality drops even while maintaining physical strength.",
                    difficulty: "complex"
                },
                {
                    question: "Why is a metal container better than plastic for survival?",
                    options: ["A) It's lighter", "B) Can cook on fire and boil water", "C) More visible to rescuers", "D) Doesn't crack in cold"],
                    correct: 1,
                    explanation: "A metal container can be placed directly on fire for cooking and boiling water for disinfection - these are critically important survival functions.",
                    difficulty: "intermediate"
                },
                {
                    question: "How do you properly signal distress with sound or light?",
                    options: ["A) 3 short - 3 long - 3 short", "B) 3 long - 3 short - 3 long", "C) Continuous signal", "D) 5 short signals"],
                    correct: 0,
                    explanation: "SOS in Morse code: 3 short signals, 3 long, 3 short. This is the international distress signal recognized worldwide.",
                    difficulty: "easy"
                },
                {
                    question: "You've already walked 10 km on the wrong route but continue, thinking 'can't waste the distance covered.' What error is this?",
                    options: ["A) Correct strategy", "B) Sunk cost fallacy - continuing due to already invested resources", "C) Excessive caution", "D) Good planning"],
                    correct: 1,
                    explanation: "Sunk cost fallacy makes people continue ineffective actions due to already invested resources instead of evaluating prospects. In survival, this can be deadly.",
                    difficulty: "complex"
                },
                {
                    question: "Which natural object works best as exercise equipment for balance and strength?",
                    options: ["A) Only large rocks", "B) Fallen logs of different diameters", "C) Only water bodies", "D) Sand dunes"],
                    correct: 1,
                    explanation: "Fallen logs are ideal for balance training (log walking), jumping and climbing, developing skills for movement over complex terrain.",
                    difficulty: "intermediate"
                },
                {
                    question: "What is the foundation of all survival skills?",
                    options: ["A) Physical strength", "B) Expensive gear", "C) Technical knowledge", "D) Psychological resilience"],
                    correct: 3,
                    explanation: "The most sophisticated gear cannot save someone whose mind has already given up. Psychological resilience determines whether knowledge and skills will be applied or the person will surrender.",
                    difficulty: "easy"
                }
            ],
            
            offgrid: [
                {
                    question: "Lost in the forest and need urgent shelter, having only a knife and rope. Which construction gives basic protection with minimal time investment?",
                    options: ["A) Fully built A-frame with complete insulation", "B) Debris hut using a fallen tree as ridgepole", "C) Excavated earth shelter with wooden roof", "D) Teepee from bent saplings"],
                    correct: 1,
                    explanation: "A debris hut uses existing natural elements (fallen tree) as structural foundation, requires minimal time for frame construction and can be quickly insulated with available forest debris.",
                    difficulty: "easy"
                },
                {
                    question: "When using a hand drill for fire, tinder catches but flame quickly dies. Most likely cause?",
                    options: ["A) Insufficient downward pressure on spindle", "B) Tinder packed too tightly without sufficient airflow", "C) Fireboard wood too wet for proper friction", "D) Wrong angle of notch in fireboard"],
                    correct: 1,
                    explanation: "Tinder bundle must be built loosely like a bird's nest to ensure sufficient oxygen flow for sustained burning. Dense packing suffocates developing flame.",
                    difficulty: "medium"
                },
                {
                    question: "In arid terrain you need to find water sources. Which indicator most reliably points to underground water?",
                    options: ["A) Clusters of dark-colored rocks", "B) Broad-leafed vegetation growing in linear patterns", "C) Areas where different soil colors meet", "D) Presence of small animal burrows"],
                    correct: 1,
                    explanation: "Plants with broad, thin leaves require abundant water and often grow in lines following underground watercourses or seepage zones, making them reliable water indicators in desert conditions.",
                    difficulty: "medium"
                },
                {
                    question: "Building a bow drill set but consistently failing to produce an ember. Technique seems right. Which material combination most likely solves the problem?",
                    options: ["A) Harder wood for both spindle and fireboard", "B) Softer wood for spindle, harder for fireboard", "C) Harder wood for spindle, softer for fireboard", "D) Green wood for spindle, dry for fireboard"],
                    correct: 2,
                    explanation: "Optimal friction combination pairs harder wood (spindle) with softer wood (fireboard), creating proper friction without premature wear while generating sufficient heat for ember formation.",
                    difficulty: "medium"
                },
                {
                    question: "In survival situation, found cattails growing in marshy area. Which part of cattail provides highest caloric return for effort?",
                    options: ["A) Fluffy seed heads for direct consumption", "B) Young shoots collected in early spring", "C) Starchy roots/rhizomes dug from underwater", "D) Pollen collected during flowering"],
                    correct: 2,
                    explanation: "Cattail roots contain concentrated starches and provide highest caloric density. They're available year-round, and one collection session can yield substantial nutrition compared to other parts.",
                    difficulty: "easy"
                },
                {
                    question: "Building a solar still for water collection but getting minimal output. Which modification significantly improves water production?",
                    options: ["A) Dig pit deeper to increase soil surface area", "B) Add non-poisonous vegetation to increase moisture content", "C) Use darker colored plastic sheet as covering", "D) Create multiple small stills instead of one large"],
                    correct: 1,
                    explanation: "Adding vegetation dramatically increases moisture content inside still, providing more water vapor for condensation. Even dry vegetation contains extractable moisture that significantly boosts output.",
                    difficulty: "medium"
                },
                {
                    question: "When processing plant fibers for rope, material keeps breaking during twisting. Most effective solution?",
                    options: ["A) Twist fibers tighter to increase strength", "B) Use shorter fiber lengths to reduce stress points", "C) Slightly dampen fibers before working with them", "D) Add more individual fibers to increase bulk"],
                    correct: 2,
                    explanation: "Slightly moist fibers become more pliable and less prone to breaking during twisting process. Completely dry fibers are brittle, while overly wet fibers become weak and stretchy.",
                    difficulty: "medium"
                },
                {
                    question: "Building a lean-to but notice cold air flowing under sleeping area. Which ground insulation strategy provides most effective solution?",
                    options: ["A) Dig shallow depression to get below ground level", "B) Create thick layer of dry leaves with largest ones on bottom", "C) Lay flat rocks to create thermal mass base", "D) Use green pine boughs with needles pointing up"],
                    correct: 1,
                    explanation: "Minimum 6-8 inches of dry leaves with larger leaves as base layer creates effective dead air space insulation. This prevents conductive heat loss to cold ground.",
                    difficulty: "easy"
                },
                {
                    question: "Improvised water filter from sand, charcoal and cloth produces cloudy water with strange taste. Most likely problem with filtration system?",
                    options: ["A) Sand layer too thick, restricting flow", "B) Charcoal not properly prepared from hardwood", "C) Cloth too fine, creating excessive back pressure", "D) Filter materials in wrong order top to bottom"],
                    correct: 1,
                    explanation: "Proper activated charcoal for filtration must be made from hardwood, burned to white ash, then crushed to increase surface area. Poor charcoal preparation reduces both clarity and taste improvement.",
                    difficulty: "medium"
                },
                {
                    question: "In survival situation need to prioritize time and energy. Which project provides greatest 'force multiplication' for survival capabilities?",
                    options: ["A) Building complex water purification system", "B) Creating sharp, durable knife from stone or metal", "C) Constructing elaborate food storage container", "D) Weaving large basket for material collection"],
                    correct: 1,
                    explanation: "Quality cutting tool enables dozens of other survival tasks - shelter building, fire prep, food processing, tool making, and material processing. It multiplies ability to accomplish subsequent projects.",
                    difficulty: "easy"
                },
                {
                    question: "When smoking meat for preservation, fire produces too much heat and insufficient smoke. How to modify setup?",
                    options: ["A) Add green hardwood to increase smoke production", "B) Move meat closer to fire for faster processing", "C) Create longer smoke path between fire and meat", "D) Use only dry hardwood split into small pieces"],
                    correct: 2,
                    explanation: "Longer smoke path allows heat to dissipate while maintaining smoke density. Dakota fire pit method or offset fire pit achieves proper temperature control for preservative smoking.",
                    difficulty: "medium"
                },
                {
                    question: "Identifying edible plants using Universal Edibility Test. At which stage should you immediately stop testing?",
                    options: ["A) When plant creates mild burning on lip", "B) When plant sap leaves temporary stain on skin", "C) When you notice any bitter taste during tongue test", "D) When stomach feels mild upset after 8 hours"],
                    correct: 0,
                    explanation: "Any burning during contact tests indicates potentially harmful compounds. Test should be immediately stopped and plant marked as unsafe for consumption.",
                    difficulty: "easy"
                },
                {
                    question: "Debris hut completed but still experiencing condensation problems inside. Most effective solution?",
                    options: ["A) Add more debris to outer walls for thickness", "B) Create small ventilation gaps at top and bottom", "C) Line interior with large leaves as vapor barrier", "D) Dig drainage channels around shelter perimeter"],
                    correct: 1,
                    explanation: "Controlled ventilation allows moisture to escape while retaining heat. Small gaps at different heights create airflow that prevents condensation buildup without significant heat loss.",
                    difficulty: "medium"
                },
                {
                    question: "When creating deadfall trap, trigger mechanism keeps releasing prematurely. Which adjustment improves reliability?",
                    options: ["A) Make trigger stick longer for more stability", "B) Use heavier weight to increase trigger force", "C) Increase friction surface area between trigger components", "D) Position trigger deeper under crushing weight"],
                    correct: 2,
                    explanation: "Increasing friction between trigger components (through notches, roughening surfaces, or better fitting) creates more resistance to accidental triggering while maintaining sensitivity to intentional animal contact.",
                    difficulty: "medium"
                },
                {
                    question: "Using pine resin for waterproofing containers but it's too brittle when cooled. What to add for improved flexibility?",
                    options: ["A) Small amounts of charcoal powder as filler", "B) Heated animal fat or plant oils", "C) Fine sand to create more workable texture", "D) Additional heating to change resin consistency"],
                    correct: 1,
                    explanation: "Adding heated animal fat or plant oils to pine resin creates more flexible, less brittle sealant when cooled. This mixture maintains waterproofing while allowing material movement.",
                    difficulty: "medium"
                },
                {
                    question: "In cold conditions, fire keeps dying overnight despite using large hardwood logs. Most likely cause?",
                    options: ["A) Insufficient initial fire size to ignite large logs", "B) Logs positioned too far apart, losing mutual heating", "C) Wrong wood species that burns too quickly", "D) Lack of proper kindling gradation for sustained burning"],
                    correct: 1,
                    explanation: "Large logs must be positioned close enough for mutual thermal reinforcement. 'Star fire' configuration allows pushing logs inward as they burn, maintaining this critical distance.",
                    difficulty: "medium"
                },
                {
                    question: "Built simple lever for moving heavy logs for shelter construction. Despite proper positioning, can't generate sufficient force. What most improves leverage?",
                    options: ["A) Find harder, more solid fulcrum material", "B) Increase length of lever arm you're pushing on", "C) Position fulcrum closer to load being moved", "D) Apply force at steeper downward angle"],
                    correct: 2,
                    explanation: "Moving fulcrum closer to load increases mechanical advantage. The closer fulcrum is to load, the greater force multiplication, though this reduces distance load moves.",
                    difficulty: "medium"
                },
                {
                    question: "When preserving meat by salt curing, meat develops bad smell after few days. What was most likely done wrong?",
                    options: ["A) Used too little salt for proper preservation", "B) Storing meat at too high temperature", "C) Didn't remove all excess moisture before curing", "D) Used wrong type of salt for curing"],
                    correct: 1,
                    explanation: "Salt curing requires cool temperatures (below 50°F) to prevent spoilage bacteria growth. Warm temperatures allow harmful bacteria to multiply faster than salt can suppress them.",
                    difficulty: "medium"
                },
                {
                    question: "Natural rope keeps breaking at splice points where adding new material. How to improve splice strength?",
                    options: ["A) Overlap new fibers over greater distance during splicing", "B) Twist splice points tighter than rest", "C) Add new material only when previous section completely dry", "D) Use only thinnest fibers for splicing connections"],
                    correct: 0,
                    explanation: "Longer overlap distances distribute stress across more fiber-to-fiber contact points, preventing failure at splice. Minimum overlap should be 4-6 times individual fiber length.",
                    difficulty: "medium"
                },
                {
                    question: "In long-term survival situation need to make activities sustainable. Which approach best embodies 'energy return on investment' principle?",
                    options: ["A) Building multiple backup systems for each critical function", "B) Creating one high-quality tool that enables many other tasks", "C) Focusing only on immediate needs without long-term planning", "D) Using most complex available solution to ensure reliability"],
                    correct: 1,
                    explanation: "One high-quality, multi-purpose tool that enables multiple subsequent tasks provides best energy return. This 'force multiplier' approach maximizes capabilities gained per calorie invested in creation.",
                    difficulty: "hard"
                }
            ],

            medical: [
                {
                    question: "Leading group on hike when member falls and gets obvious leg fracture 8 miles from trail. Patient conscious, vitals stable, but can't bear weight. Evening approaching and temperature dropping. Your immediate priority?",
                    options: ["A) Splint fracture immediately with available materials", "B) First assess neurovascular status of injured limb", "C) Send fastest hiker ahead to organize evacuation", "D) Create shelter and wait for morning before moving"],
                    correct: 1,
                    explanation: "Assessing neurovascular status (pulse, sensation, movement, color) takes priority before any manipulation or splinting. Fracture with compromised circulation requires immediate intervention, while fracture with intact neurovascular function allows time for proper splinting and planning.",
                    difficulty: "medium"
                },
                {
                    question: "Team member found unconscious after climbing fall. No obvious external bleeding, but breathing 6 breaths/min and irregular. Using ABCDE assessment, what's your next action after ensuring scene safety?",
                    options: ["A) Check for spinal injuries by palpating neck", "B) Open airway with head tilt-chin lift maneuver", "C) Begin chest compressions immediately", "D) Use jaw thrust without head tilt to open airway"],
                    correct: 3,
                    explanation: "With potential head injury and altered consciousness, spinal injury must be assumed. Jaw thrust maneuver opens airway without moving neck, addressing life-threatening respiratory rate while protecting spine.",
                    difficulty: "medium"
                },
                {
                    question: "During winter camping, group member shows confusion, slurred speech, and stopped shivering despite continued cold exposure. Skin pale, and he's clumsily performing simple tasks. What hypothermia stage is he experiencing?",
                    options: ["A) Mild hypothermia - needs warm drinks and shelter", "B) Moderate hypothermia - serious emergency requiring immediate rewarming", "C) Severe hypothermia - shivering stopped indicating core temp below 90°F", "D) Normal cold response - these symptoms expected in cold weather"],
                    correct: 1,
                    explanation: "Combination of confusion, slurred speech, and clumsiness ('umbles') with continued shivering indicates moderate hypothermia. This is serious emergency requiring aggressive rewarming, but presence of shivering means they haven't progressed to severe hypothermia where shivering stops.",
                    difficulty: "medium"
                },
                {
                    question: "Treating deep laceration on forearm that's bleeding heavily. Direct pressure doesn't control bleeding. Next appropriate step in bleeding control algorithm?",
                    options: ["A) Apply tourniquet 2-3 inches above wound", "B) Elevate arm and apply pressure to brachial artery", "C) Pack wound tightly with clean gauze or cloth", "D) Apply ice to wound for vasoconstriction"],
                    correct: 2,
                    explanation: "For deep wounds with heavy bleeding not controlled by direct pressure, wound packing is next step. Wound should be tightly packed from bottom up with gauze, then direct pressure applied over packing. Tourniquets reserved for life-threatening bleeding when other methods fail.",
                    difficulty: "medium"
                },
                {
                    question: "Hiking partner stung by multiple wasps and develops facial swelling, difficulty breathing, and hives on chest. He's conscious but anxious. If epinephrine unavailable, your priority action?",
                    options: ["A) Give antihistamines and monitor closely", "B) Evacuate immediately while keeping them sitting upright", "C) Apply cold compresses to reduce swelling", "D) Lay them flat to improve circulation"],
                    correct: 1,
                    explanation: "This is anaphylaxis - life-threatening emergency. Without epinephrine, immediate evacuation is absolute priority. Keep patient upright to help breathing. While antihistamines may help, evacuation cannot be delayed for their administration.",
                    difficulty: "easy"
                },
                {
                    question: "You suspect team member consumed poisonous mushrooms 18 hours ago. They had initial nausea and vomiting that resolved, but now seem normal. What's most concerning about this picture?",
                    options: ["A) Delayed onset suggests serious neurological toxin", "B) Apparent recovery may be false improvement before liver failure", "C) Vomiting indicates poison was eliminated", "D) 18-hour delay means danger has passed"],
                    correct: 1,
                    explanation: "Classic pattern of amatoxin poisoning (death cap mushrooms) includes initial GI symptoms that resolve, creating false hope during asymptomatic period while liver-destroying toxins work. This is followed by potentially fatal liver failure 3-5 days later, making immediate evacuation critical.",
                    difficulty: "hard"
                },
                {
                    question: "Group encounters someone with suspected venomous snake bite on ankle. Bite occurred 30 minutes ago, progressive swelling to mid-calf, and person reports increasing pain. Best approach?",
                    options: ["A) Apply tourniquet above swelling to prevent venom spread", "B) Make small cuts over fang marks to drain venom", "C) Keep limb still below heart level and evacuate immediately", "D) Apply ice packs to slow venom absorption"],
                    correct: 2,
                    explanation: "Modern snakebite management focuses on immobilization below heart level to slow venom circulation and immediate evacuation. Tourniquets, cutting/suction, and ice are all contraindicated as they increase tissue damage without removing significant venom.",
                    difficulty: "medium"
                },
                {
                    question: "During winter expedition need to create improvised shelter for injured team member showing early hypothermia signs. Which principle most important for effective cold protection?",
                    options: ["A) Maximize wind protection above all other factors", "B) Create multiple insulation layers with air spaces between them", "C) Use reflective materials to bounce heat back to body", "D) Ensure shelter is maximum size for comfort"],
                    correct: 1,
                    explanation: "Effective insulation depends on trapping still air in layers. Multiple layers with air spaces provide superior insulation compared to single thick layers. While wind protection is important, proper insulation is foundation of heat retention.",
                    difficulty: "medium"
                },
                {
                    question: "Managing multiple casualties after rockfall. Using triage principles, which patient should receive immediate attention?",
                    options: ["A) Unconscious person with weak pulse and slow breathing", "B) Conscious person with obvious open leg fracture and controlled bleeding", "C) Walking person complaining of severe back pain", "D) Conscious person with rapid breathing and uncontrolled arm bleeding"],
                    correct: 3,
                    explanation: "In triage, 'Immediate' category patients have life-threatening injuries that are salvageable with intervention. Uncontrolled bleeding is immediately life-threatening but treatable. Unconscious person may be too severe (expectant category), while walking wounded and controlled bleeding have lower priority.",
                    difficulty: "hard"
                },
                {
                    question: "Team member falls into cold water (45°F) wearing heavy clothing. They manage to grab boat but can't climb in. What's most critical danger in first 3 minutes?",
                    options: ["A) Rapid onset of hypothermia", "B) Initial cold shock response causing drowning", "C) Clothing becoming waterlogged and pulling them under", "D) Panic leading to poor decision making"],
                    correct: 1,
                    explanation: "Initial cold shock response (0-3 minutes) causes involuntary gasping and hyperventilation, creating highest drowning risk. If this critical period is survived, there's meaningful time before hypothermia becomes life-threatening, even in very cold water.",
                    difficulty: "medium"
                },
                {
                    question: "Treating second-degree burn on hand from camping accident. After cooling with water, which improvised treatment shows best evidence for promoting healing?",
                    options: ["A) Apply oil or cooking fat to moisturize burn", "B) Pop any blisters to prevent infection", "C) Apply raw honey if available and cover with clean cloth", "D) Rub snow on burn to continue cooling"],
                    correct: 2,
                    explanation: "Raw honey has proven antimicrobial properties and creates moist healing environment. It's one of few natural remedies with clinical evidence for burn treatment. Oil/fat retains heat, popping blisters increases infection risk, and continued cooling with snow can cause cold injury.",
                    difficulty: "easy"
                },
                {
                    question: "During multi-day wilderness medical emergency, managing someone with infected wound showing infection signs. Antibiotic supply limited. Which approach best balances treatment with resource conservation?",
                    options: ["A) Use full standard antibiotic course immediately", "B) Give half doses to make supplies last longer", "C) Wait until infection becomes severe before starting antibiotics", "D) Use antibiotics 3 days, then reassess before continuing"],
                    correct: 0,
                    explanation: "Incomplete antibiotic courses risk creating resistant bacteria and treatment failure. While resource conservation important, proper antibiotic use with clear indications maximizes effectiveness. Half doses or shortened courses often fail to clear infections.",
                    difficulty: "hard"
                },
                {
                    question: "Team member reports severe abdominal pain that started around navel and now moved to right lower abdomen. They have fever and refuse to walk due to pain. You're 2 days from evacuation. Primary concern?",
                    options: ["A) Food poisoning from contaminated water", "B) Appendicitis requiring immediate evacuation attempt", "C) Kidney stones that will pass naturally", "D) Muscle strain from carrying heavy pack"],
                    correct: 1,
                    explanation: "Classic appendicitis presentation (periumbilical pain migrating to right lower quadrant with fever and inability to walk) requires immediate evacuation. Appendix can rupture within 48-72 hours, dramatically increasing mortality without surgical intervention.",
                    difficulty: "medium"
                },
                {
                    question: "When crossing fast stream, team member falls and appears to have shoulder dislocation. Arm in abnormal position and they can't move it. Evacuation timeline uncertain. Best approach?",
                    options: ["A) Attempt immediate reduction using gentle traction", "B) Immobilize in position found and arrange evacuation", "C) Give pain medication then attempt reduction", "D) Attempt reduction only if you have previous medical training"],
                    correct: 1,
                    explanation: "Without proper training and in uncertain evacuation circumstances, attempting joint reduction risks serious neurovascular damage. Immobilization in position found with rapid evacuation is safest. Pain control while maintaining immobilization appropriate.",
                    difficulty: "medium"
                },
                {
                    question: "Leading group through hot desert terrain when someone develops hot, dry skin, confusion, and rapid pulse. Their core temperature feels extremely elevated. Immediate priority?",
                    options: ["A) Give them cold water to drink immediately", "B) Move them to shade and begin aggressive cooling measures", "C) Continue slow hiking to reach help faster", "D) Give salt tablets to replace lost electrolytes"],
                    correct: 1,
                    explanation: "This is heat stroke - true medical emergency with high mortality. Aggressive cooling takes absolute priority over everything else, including evacuation preparation. Every minute of core temperature above 105°F increases organ damage risk.",
                    difficulty: "easy"
                },
                {
                    question: "Team member stepped on nail that penetrated through their boot. Nail went completely through sole into their foot. Nail no longer in wound. Primary concern with this injury?",
                    options: ["A) Stopping bleeding which is likely severe", "B) High infection risk from deep tissue inoculation", "C) Tetanus infection from rusty metal", "D) Possible broken bones in foot"],
                    correct: 1,
                    explanation: "Puncture wounds, especially through footwear, carry extremely high infection risk due to deep tissue inoculation with bacteria. Wound looks minor externally but creates perfect conditions for anaerobic infections. Bleeding usually minimal with puncture wounds.",
                    difficulty: "medium"
                },
                {
                    question: "When treating fracture in wilderness need to improvise splint. Which principle most important for effective splinting?",
                    options: ["A) Make splint as tight as possible to prevent movement", "B) Immobilize joints above and below fracture site", "C) Use only rigid materials for proper support", "D) Extend splint past fingers or toes"],
                    correct: 1,
                    explanation: "Effective splinting requires immobilizing joints above and below fracture to prevent movement at injury site. This principle applies regardless of materials used. Over-tightening can compromise circulation, and soft materials can be effective when properly applied.",
                    difficulty: "easy"
                },
                {
                    question: "Group caught in severe weather and must shelter for extended time. One member showing mild hypothermia symptoms. Which rewarming method most appropriate for field conditions?",
                    options: ["A) Place them directly by fire for rapid warming", "B) Give them alcohol for vasodilation and warmth", "C) Use skin-to-skin contact in shared sleeping system", "D) Make them exercise vigorously to generate heat"],
                    correct: 2,
                    explanation: "For mild hypothermia, gradual rewarming with shared body heat is safe and effective. Direct heat sources risk burns due to impaired sensation, alcohol accelerates heat loss, and vigorous exercise can worsen hypothermia by shunting warm blood to extremities.",
                    difficulty: "medium"
                },
                {
                    question: "Encounter unconscious person who appears to have no pulse or breathing. They're cold to touch and skin is blue-gray. In wilderness conditions, what should guide decision about starting CPR?",
                    options: ["A) Begin CPR immediately - time is critical", "B) Don't start CPR - they're obviously dead", "C) Check for signs of life up to 60 seconds before deciding", "D) Warm them first, then reassess for signs of life"],
                    correct: 2,
                    explanation: "In hypothermic patients, pulse and breathing may be so slow as undetectable. The saying applies: 'no one is dead until warm and dead.' Check for signs of life up to 60 seconds, as severely hypothermic patients have survived without detectable vital signs.",
                    difficulty: "hard"
                },
                {
                    question: "Team member reports tick bite 2 days ago. Tick was properly removed but now there's expanding red rash around bite site with clear center, resembling 'bull's eye' pattern. Primary concern?",
                    options: ["A) Local allergic reaction to tick bite", "B) Possible Lyme disease requiring antibiotic treatment", "C) Normal healing response to tick saliva", "D) Secondary bacterial infection from scratching"],
                    correct: 1,
                    explanation: "Expanding 'bull's eye' rash (erythema migrans) is pathognomonic for early Lyme disease. Early antibiotic treatment is highly effective, while delayed treatment can lead to serious complications including cardiac and neurological problems.",
                    difficulty: "easy"
                }
            ]
        };

        let currentQuiz = null;
        let currentQuestionIndex = 0;
        let selectedAnswer = null;
        let score = 0;
        let answeredQuestions = [];

        function startQuiz(quizType) {
            currentQuiz = [];
            currentQuestionIndex = 0;
            score = 0;
            answeredQuestions = [];
            
            // Collect questions based on type
            if (quizType === 'all') {
                currentQuiz = [...questionsData.basic, ...questionsData.offgrid, ...questionsData.medical];
                document.getElementById('quizTitle').textContent = 'Complete Preparedness Assessment';
            } else if (quizType === 'basic') {
                currentQuiz = [...questionsData.basic];
                document.getElementById('quizTitle').textContent = 'Basic Survival Skills';
            } else if (quizType === 'offgrid') {
                currentQuiz = [...questionsData.offgrid];
                document.getElementById('quizTitle').textContent = 'Life Without Electricity';
            } else if (quizType === 'medical') {
                currentQuiz = [...questionsData.medical];
                document.getElementById('quizTitle').textContent = 'Wilderness Medicine';
            }

            // Shuffle questions
            shuffleArray(currentQuiz);
            
            document.getElementById('mainMenu').style.display = 'none';
            document.getElementById('quizContainer').style.display = 'block';
            document.getElementById('resultsContainer').style.display = 'none';
            
            showQuestion();
        }

        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
        }

        function showQuestion() {
            if (currentQuestionIndex >= currentQuiz.length) {
                showResults();
                return;
            }

            const question = currentQuiz[currentQuestionIndex];
            document.getElementById('questionText').textContent = question.question;
            document.getElementById('questionCounter').textContent = `${currentQuestionIndex + 1}/${currentQuiz.length}`;
            
            const progressPercent = ((currentQuestionIndex) / currentQuiz.length) * 100;
            document.getElementById('progressBar').style.width = progressPercent + '%';

            const optionsContainer = document.getElementById('optionsContainer');
            optionsContainer.innerHTML = '';
            
            question.options.forEach((option, index) => {
                const optionDiv = document.createElement('div');
                optionDiv.className = 'option';
                optionDiv.textContent = option;
                optionDiv.onclick = () => selectOption(index);
                optionsContainer.appendChild(optionDiv);
            });

            document.getElementById('explanation').style.display = 'none';
            document.getElementById('nextButton').disabled = true;
            selectedAnswer = null;
        }

        function selectOption(index) {
            selectedAnswer = index;
            
            const options = document.querySelectorAll('.option');
            options.forEach(option => option.classList.remove('selected'));
            options[index].classList.add('selected');
            
            document.getElementById('nextButton').disabled = false;
        }

        function nextQuestion() {
            const question = currentQuiz[currentQuestionIndex];
            const isCorrect = selectedAnswer === question.correct;
            
            if (isCorrect) {
                score++;
            }

            answeredQuestions.push({
                question: question.question,
                selectedAnswer: selectedAnswer,
                correctAnswer: question.correct,
                isCorrect: isCorrect,
                explanation: question.explanation,
                difficulty: question.difficulty
            });

            // Show correct answer
            const options = document.querySelectorAll('.option');
            options.forEach((option, index) => {
                if (index === question.correct) {
                    option.classList.add('correct');
                } else if (index === selectedAnswer && !isCorrect) {
                    option.classList.add('incorrect');
                }
                option.onclick = null; // Disable clicks
            });

            // Show explanation
            const explanationDiv = document.getElementById('explanation');
            explanationDiv.innerHTML = `
                <h4>${isCorrect ? '✅ Correct!' : '❌ Incorrect'}</h4>
                <p>${question.explanation}</p>
            `;
            explanationDiv.style.display = 'block';

            // Change button
            const nextButton = document.getElementById('nextButton');
            nextButton.textContent = currentQuestionIndex === currentQuiz.length - 1 ? 'Finish Test' : 'Next Question';
            nextButton.onclick = () => {
                currentQuestionIndex++;
                nextButton.textContent = 'Next';
                nextButton.onclick = nextQuestion;
                showQuestion();
            };
        }

        function showResults() {
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'block';

            const percentage = Math.round((score / currentQuiz.length) * 100);
            document.getElementById('scoreText').textContent = `${score}/${currentQuiz.length}`;

            const scoreCircle = document.getElementById('scoreCircle');
            const resultTitle = document.getElementById('resultTitle');
            const resultDescription = document.getElementById('resultDescription');

            if (percentage >= 90) {
                scoreCircle.className = 'score-circle score-excellent';
                resultTitle.textContent = 'Excellent Preparedness! 🏆';
                resultDescription.textContent = 'You have outstanding survival knowledge. You\'re ready for most extreme situations.';
            } else if (percentage >= 70) {
                scoreCircle.className = 'score-circle score-good';
                resultTitle.textContent = 'Good Preparedness 👍';
                resultDescription.textContent = 'Your knowledge is at a good level, but there are areas for improvement. Continue studying and practicing.';
            } else if (percentage >= 50) {
                scoreCircle.className = 'score-circle score-basic';
                resultTitle.textContent = 'Basic Knowledge ⚠️';
                resultDescription.textContent = 'You have the basics, but need to seriously improve preparation. We recommend studying books and taking training.';
            } else {
                scoreCircle.className = 'score-circle score-critical';
                resultTitle.textContent = 'Critical Gap! 🚨';
                resultDescription.textContent = 'Your knowledge is insufficient for safety. You urgently need to study survival basics.';
            }

            // Calculate category-specific scores for recommendations
            const categoryScores = calculateCategoryScores();
            
            // Add detailed statistics
            const difficultyStats = answeredQuestions.reduce((acc, q) => {
                if (!acc[q.difficulty]) acc[q.difficulty] = { correct: 0, total: 0 };
                acc[q.difficulty].total++;
                if (q.isCorrect) acc[q.difficulty].correct++;
                return acc;
            }, {});

            let statsHtml = '<div style="margin-top: 20px; text-align: left; background: #f8f9fa; padding: 20px; border-radius: 12px; border-left: 4px solid #7dae42;"><h3 style="color: #2d5016; margin-bottom: 16px;">Detailed Statistics:</h3>';
            
            Object.keys(difficultyStats).forEach(difficulty => {
                const stats = difficultyStats[difficulty];
                const percent = Math.round((stats.correct / stats.total) * 100);
                const difficultyNames = {
                    'easy': 'Easy',
                    'medium': 'Medium', 
                    'intermediate': 'Medium',
                    'hard': 'Hard',
                    'complex': 'Hard'
                };
                
                const color = percent >= 70 ? '#28a745' : percent >= 50 ? '#ffc107' : '#dc3545';
                statsHtml += `<p style="margin: 8px 0; color: #333;"><strong>${difficultyNames[difficulty] || difficulty}:</strong> <span style="color: ${color}; font-weight: bold;">${stats.correct}/${stats.total} (${percent}%)</span></p>`;
            });
            
            statsHtml += '</div>';
            
            // Add book recommendations
            const recommendations = generateBookRecommendations(percentage, categoryScores);
            statsHtml += recommendations;
            
            resultDescription.innerHTML += statsHtml;
        }

        function calculateCategoryScores() {
            // Get original question data to categorize answers
            const basicQuestions = questionsData.basic;
            const offgridQuestions = questionsData.offgrid;
            const medicalQuestions = questionsData.medical;
            
            const scores = {
                basic: { correct: 0, total: 0 },
                offgrid: { correct: 0, total: 0 },
                medical: { correct: 0, total: 0 }
            };
            
            answeredQuestions.forEach(answer => {
                // Find which category this question belongs to
                const questionText = answer.question;
                
                if (basicQuestions.some(q => q.question === questionText)) {
                    scores.basic.total++;
                    if (answer.isCorrect) scores.basic.correct++;
                } else if (offgridQuestions.some(q => q.question === questionText)) {
                    scores.offgrid.total++;
                    if (answer.isCorrect) scores.offgrid.correct++;
                } else if (medicalQuestions.some(q => q.question === questionText)) {
                    scores.medical.total++;
                    if (answer.isCorrect) scores.medical.correct++;
                }
            });
            
            return scores;
        }

        function generateBookRecommendations(overallPercentage, categoryScores) {
            let recommendationsHtml = '<div style="margin-top: 24px; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%); border-radius: 12px; border: 2px solid #7dae42;">';
            
            // Perfect score - recommend author exploration
            if (overallPercentage === 100) {
                recommendationsHtml += `
                    <h3 style="color: #2d5016; margin-bottom: 16px; text-align: center;">🎯 Master Level Achieved!</h3>
                    <p style="color: #333; margin-bottom: 16px; text-align: center;">You've mastered all survival fundamentals! Ready to explore advanced topics?</p>
                    <div style="text-align: center;">
                        <button onclick="window.open('AUTHOR_LINK_PLACEHOLDER', '_blank')" style="background: linear-gradient(135deg, #28a745, #20c997); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer; margin: 8px;">
                            📚 Explore More Books by Caleb North
                        </button>
                    </div>
                `;
            }
            // Excellent performance (90-99%) - recommend all books or specific areas
            else if (overallPercentage >= 90) {
                const weakestAreas = findWeakestAreas(categoryScores);
                recommendationsHtml += `
                    <h3 style="color: #2d5016; margin-bottom: 16px;">📖 Recommended Reading for Excellence</h3>
                    <p style="color: #333; margin-bottom: 16px;">You're almost there! Focus on these areas to reach mastery:</p>
                `;
                recommendationsHtml += generateSpecificBookRecommendations(weakestAreas);
            }
            // Good performance (70-89%) - recommend books based on weak areas
            else if (overallPercentage >= 70) {
                const weakestAreas = findWeakestAreas(categoryScores);
                recommendationsHtml += `
                    <h3 style="color: #2d5016; margin-bottom: 16px;">📚 Strengthen Your Knowledge</h3>
                    <p style="color: #333; margin-bottom: 16px;">Good foundation! These books will help you improve in key areas:</p>
                `;
                recommendationsHtml += generateSpecificBookRecommendations(weakestAreas);
            }
            // Basic or Critical - recommend comprehensive approach
            else {
                recommendationsHtml += `
                    <h3 style="color: #2d5016; margin-bottom: 16px;">🎯 Essential Learning Path</h3>
                    <p style="color: #333; margin-bottom: 20px;">Start with the fundamentals and build comprehensive survival skills:</p>
                    
                    <div style="background: white; border-radius: 12px; padding: 20px; margin-bottom: 20px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <div style="display: flex; gap: 20px; align-items: center;">
                            <div style="flex-shrink: 0;">
                                <img src="./images/basic-survival-cover.jpg" alt="Basic Survival Skills Book" style="width: 120px; height: 160px; object-fit: cover; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                            </div>
                            <div style="flex: 1;">
                                <h4 style="color: #2d5016; margin-bottom: 12px; font-size: 1.2rem;">🎒 Start Here: Basic Survival Skills</h4>
                                <p style="color: #666; margin-bottom: 16px; line-height: 1.5;">Perfect foundation for beginners. Master the essential mindset, first aid, communication, and fitness fundamentals.</p>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <button onclick="window.open('BASIC_BOOK_LINK_PLACEHOLDER', '_blank')" style="background: linear-gradient(135deg, #7dae42, #5d8234); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer;">
                                        📖 Get This Book
                                    </button>
                                    <span style="color: #28a745; font-weight: bold; font-size: 1.1rem;">$19.99</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div style="text-align: center; padding: 20px; background: linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%); border-radius: 12px; border: 2px solid #17a2b8;">
                        <h4 style="color: #2d5016; margin-bottom: 16px;">💡 Pro Tip: Complete Survival Mastery</h4>
                        <div style="display: flex; justify-content: center; gap: 16px; margin-bottom: 16px;">
                            <img src="./images/basic-survival-cover.jpg" alt="Basic Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                            <img src="./images/offgrid-survival-cover.jpg" alt="Off-Grid Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                            <img src="./images/medical-survival-cover.jpg" alt="Medical Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                        </div>
                        <p style="color: #666; margin-bottom: 16px;">Get all three books for complete survival knowledge!</p>
                        <button onclick="window.open('ALL_BOOKS_LINK_PLACEHOLDER', '_blank')" style="background: linear-gradient(135deg, #17a2b8, #007bff); color: white; border: none; padding: 16px 32px; border-radius: 8px; font-size: 1.1rem; cursor: pointer; box-shadow: 0 4px 16px rgba(23, 162, 184, 0.3);">
                            📚 Get Complete Collection
                        </button>
                    </div>
                `;
            }
            
            recommendationsHtml += '</div>';
            return recommendationsHtml;
        }

        function findWeakestAreas(categoryScores) {
            const areas = [];
            
            Object.keys(categoryScores).forEach(category => {
                const score = categoryScores[category];
                if (score.total > 0) {
                    const percentage = (score.correct / score.total) * 100;
                    areas.push({
                        category: category,
                        percentage: percentage,
                        score: score
                    });
                }
            });
            
            // Sort by percentage (worst first)
            areas.sort((a, b) => a.percentage - b.percentage);
            return areas;
        }

        function generateSpecificBookRecommendations(areas) {
            let html = '';
            
            areas.forEach((area, index) => {
                const bookInfo = getBookInfo(area.category);
                const percentage = Math.round(area.percentage);
                const color = percentage < 50 ? '#dc3545' : percentage < 70 ? '#ffc107' : '#28a745';
                
                html += `
                    <div style="margin-bottom: 20px; padding: 20px; background: white; border-radius: 12px; border-left: 4px solid ${color}; box-shadow: 0 4px 12px rgba(0,0,0,0.1);">
                        <div style="display: flex; gap: 20px; align-items: flex-start;">
                            <div style="flex-shrink: 0;">
                                <img src="${bookInfo.coverImage}" alt="${bookInfo.title}" style="width: 120px; height: 160px; object-fit: cover; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.2);">
                            </div>
                            <div style="flex: 1;">
                                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 12px;">
                                    <h4 style="color: #2d5016; margin: 0; font-size: 1.2rem;">${bookInfo.emoji} ${bookInfo.title}</h4>
                                    <span style="color: ${color}; font-weight: bold; font-size: 1.1rem; background: ${color}20; padding: 4px 12px; border-radius: 20px;">${area.score.correct}/${area.score.total} (${percentage}%)</span>
                                </div>
                                <p style="color: #666; margin-bottom: 16px; font-size: 0.95rem; line-height: 1.5;">${bookInfo.description}</p>
                                <div style="display: flex; gap: 12px; align-items: center;">
                                    <button onclick="window.open('${bookInfo.link}', '_blank')" style="background: linear-gradient(135deg, #7dae42, #5d8234); color: white; border: none; padding: 12px 24px; border-radius: 8px; font-size: 1rem; cursor: pointer; transition: all 0.3s ease; flex: 1; max-width: 200px;">
                                        📖 Get This Book
                                    </button>
                                    <span style="color: #28a745; font-weight: bold; font-size: 1.1rem;">${bookInfo.price}</span>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            // Add bundle option if multiple books recommended
            if (areas.length > 1) {
                html += `
                    <div style="margin-top: 24px; padding: 24px; background: linear-gradient(135deg, #f8f9fa 0%, #e3f2fd 100%); border-radius: 12px; border: 2px solid #17a2b8; text-align: center;">
                        <h4 style="color: #2d5016; margin-bottom: 16px;">📚 Complete Your Knowledge</h4>
                        <div style="display: flex; justify-content: center; gap: 16px; margin-bottom: 16px;">
                            <img src="./images/basic-survival-cover.jpg" alt="Basic Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                            <img src="./images/offgrid-survival-cover.jpg" alt="Off-Grid Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                            <img src="./images/medical-survival-cover.jpg" alt="Medical Book" style="width: 80px; height: 106px; object-fit: cover; border-radius: 6px; box-shadow: 0 2px 8px rgba(0,0,0,0.2);">
                        </div>
                        <p style="color: #666; margin-bottom: 16px;">Get all three books for complete survival knowledge across all scenarios!</p>
                        <button onclick="window.open('ALL_BOOKS_LINK_PLACEHOLDER', '_blank')" style="background: linear-gradient(135deg, #17a2b8, #007bff); color: white; border: none; padding: 16px 32px; border-radius: 8px; font-size: 1.1rem; cursor: pointer; box-shadow: 0 4px 16px rgba(23, 162, 184, 0.3);">
                            📚 Get Complete Collection
                        </button>
                    </div>
                `;
            }
            
            return html;
        }

        function getBookInfo(category) {
            const books = {
                basic: {
                    emoji: '🎒',
                    title: 'Basic Survival Skills',
                    shortTitle: 'Basic Survival Skills Book',
                    description: 'Master the fundamentals: mindset, first aid, communication, and physical preparedness for any emergency situation.',
                    link: 'BASIC_BOOK_LINK_PLACEHOLDER',
                    coverImage: './images/basic-survival-cover.jpg',
                    price: '$19.99'
                },
                offgrid: {
                    emoji: '🔥',
                    title: 'Off-Grid Survival',
                    shortTitle: 'Live Free Off The Grid',
                    description: 'Learn practical skills for living without electricity: shelter building, fire making, water purification, and food procurement.',
                    link: 'OFFGRID_BOOK_LINK_PLACEHOLDER',
                    coverImage: './images/offgrid-survival-cover.jpg',
                    price: '$22.99'
                },
                medical: {
                    emoji: '🏥',
                    title: 'Wilderness Medicine',
                    shortTitle: 'Off-Grid Medicine Handbook',
                    description: 'Essential first aid and medical skills for extreme conditions without hospitals or modern medical facilities.',
                    link: 'MEDICAL_BOOK_LINK_PLACEHOLDER',
                    coverImage: './images/medical-survival-cover.jpg',
                    price: '$24.99'
                }
            };
            
            return books[category] || books.basic;
        }

        function showMainMenu() {
            document.getElementById('mainMenu').style.display = 'grid';
            document.getElementById('quizContainer').style.display = 'none';
            document.getElementById('resultsContainer').style.display = 'none';
        }

        // PWA Service Worker Registration
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                const swCode = `
                    const CACHE_NAME = 'survival-quiz-v1';
                    const urlsToCache = ['/'];
                    
                    self.addEventListener('install', event => {
                        event.waitUntil(
                            caches.open(CACHE_NAME)
                                .then(cache => cache.addAll(urlsToCache))
                        );
                    });
                    
                    self.addEventListener('fetch', event => {
                        event.respondWith(
                            caches.match(event.request)
                                .then(response => response || fetch(event.request))
                        );
                    });
                `;
                
                const blob = new Blob([swCode], { type: 'application/javascript' });
                const swUrl = URL.createObjectURL(blob);
                
                navigator.serviceWorker.register(swUrl)
                    .then(registration => console.log('SW registered'))
                    .catch(error => console.log('SW registration failed'));
            });
        }
    </script>
</body>
</html>
